Local Max-Entropy and Free Energy Principles,
Belief Diffusions and their Singularities
Olivier Peltre
Univ. Artois, CNRS, CRIL, F-62300 Lens, France
Abstract
A comprehensive picture of three Bethe-Kikuchi
variational principles including their relationship
to belief propagation (BP) algorithms on hyper-
graphs is given. The structure of BP equations is
generalized to define continuous-time diffusions,
solving localized versions of the max-entropy prin-
ciple (A), the variational free energy principle (B),
and a less usual equilibrium free energy princi-
ple (C), Legendre dual to A. Both critical points of
Bethe-Kikuchi functionals and stationary beliefs are
shown to lie at the non-linear intersection of two
constraint surfaces, enforcing energy conservation
and marginal consistency respectively. The hyper-
surface of singular beliefs, accross which equilib-
ria become unstable as the constraint surfaces meet
tangentially, is described by polynomial equations
in the convex polytope of consistent beliefs. This
polynomial is expressed by a loop series expansion
for graphs of binary variables.
I. INTRODUCTION
Boltzmann-Gibbs principles describe the equilibrium
state pΩ = 1
ZΩ
e−HΩ of a statistical sytem, given its hamil-
tonian or energy function HΩ : EΩ → R, as solution to
a collection of variational problems [1, 2]. Each one cor-
responds to a different set of external constraints (energy
or temperature, volume or pressure...) yet they are all re-
lated by Legendre transforms on the constraint parame-
ters. However, evaluating the partition functionZΩ is im-
possible for large configuration spacesEΩ, and the design
of efficient algorithms for estimating pΩ or a subset of its
marginals is a challenge with countless applications.
Given a hypergraph K ⊆ P(Ω) with vertices in the set
of variables Ω, the Bethe-Kikuchi principles A, B and C
below yield tractable variational problems, where instead
of the global distribution pΩ, one optimizes over a field
of consistent local beliefs (pa)a∈K. Controlling the range
of interactions independently of the size of the system,
they exploit the asymptotic additivity of extensive ther-
modynamic functionals. The free energy principle B, also
known as the cluster variation method (CVM) [3, 4, 5],
was notably shown to have exponential convergence on
the Ising model when K grows coarse [6], the choice of
K thus offers a compromise between precision and com-
plexity. It was already known that CVM solutions may
be found by the Generalized Belief Propagation (GBP)
algorithm of Yedidia, Freeman and Weiss [7, 8, 9] (and
known for even longer when K is a graph [11]). This algo-
rithm is however far from being optimal, and there lacked
a comprehensive understanding of their correspondence
including the relationship with a Bethe-Kikuchi max-
entropy principle (A) and its Legendre-dual free energy
principle (C).
We here describe continuous-time diffusion equations
on belief networks which smooth out most convergence
issues of GBP , recovered as a time-step 1 Euler integrator.
We then show that they solve the three different Bethe-
Kikuchi variational problems, A, B and C, whose criti-
cal points are shown to lie at the intersection of two con-
straint manifolds, enforcing energy conservation and belief
consistency respectively. The former consists of homology
classes in a chain complex of local observables(C•, δ), the
latter consists of cohomology classes in the dual cochain
complex of local measures (C∗•, d), but these two are re-
lated by the non-linear correspondence mapping energy
functions to local Gibbs states. While solutions to the
max-entropy principle A are stationary states of adiabatic
diffusion algorithms, preserving the mean energy E[HΩ],
the variational free energy principle B (CVM) is solved
by isothermal diffusions, preserving the inverse tempera-
ture β = 1/T. The equilibrium free energy principle C is
dual to the other two, as it optimizes over fibers of gauge-
transformed energy functions, and not over consistent be-
liefs. Its solutions retract onto those of B and are also be
found by isothermal diffusions.
From a physical perspective, Bethe-Kikuchi principles
could be viewed as mere tools to approximate the global
and exact Boltzmann-Gibbs principles, although precise
and powerful. The possible coexistence of multiple en-
ergy values at a fixed temperature still reminds counter-
intuitive yet physical phenomena, such as surfusion and
metastable equilibria. Recently, free energy principles,
Bethe-Kikuchi approximations and BP algorithms also
1
arXiv:2310.02946v1  [math-ph]  4 Oct 2023
made their way to neuroscience [12, 13, 14, 15], a context
where it is not very clear what a global probability distri-
bution pΩ ought to describe. The locality of interactions
is yet somehow materialized by neuron dendrites and
larger scale brain connectivity. Message-passing in search
of consensus is an interesting and working metaphor of
neuronal behaviours, which might in this case hold more
reality than global variational principles. The remarkable
success of BP algorithms in decoding and stereovision ap-
plications demonstrates the potential of message-passing
schemes on graphs to solve difficult problems. However
the success of BP algorithms on loopy networks is often
presented as an empirical coincidence, and a deeper un-
derstanding of their different regimes could provide the
missing theoretical guarantees.
Whatever the perspective, singularities of Bethe-
Kikuchi functionals and belief diffusions (in finite size)
are an important and interesting feature. They happen
when the two constraint manifolds meet tangentially. A
stationary state crossing the singular surface will generi-
cally become unstable, attracted towards a different sheet
of the intersection. This would appear as a discontinu-
ous jump in the convex polytope Γ0 of consistent beliefs.
We show that the singular stratification ¯Σ1 = F
k≥1 Σk is
described by polynomial equations in Γ0. They compute
the corank k of linearized diffusion, restricted to the sub-
space of infinitesimal gauge transformations. For graphs
of binary variables, this polynomial is written explicitly in
terms of a loop series expansion.
A Related work
The first occurence of BP as an approximate bayesian in-
ference scheme dates back to Gallager’s 1962 thesis [16]
on decoding, although it is often attributed to Pearl’s 1982
article on bayesian trees [17], where it is exact. BP has re-
ceived a lot of attention and new applications since then
although it is still mostly famous in the decoding con-
text, on this see for instance [18, 19, 20, 21, 22] and [20]
for an excellent review. In telecommunications, BP is thus
used to reconstruct a parity-check encoded signal by iter-
atively updating beliefs until all the local constraints are
satisfied. Although the associated factor graph has loops,
BP works surprisingly well at reconstructing the signal.
See [23] for a numerical study of loopy BP and its sin-
gularities. As a marginal estimation algorithm, usecases
for BP and its generalizations to hypergraphs are quite
universal. Other interesting applications for instance in-
clude (but are not limited to) computer stereovision [24]
and conditional Boltzmann machines [25]. Gaussian ver-
sions of BP also exist [26], from which one could for in-
stance recover the well known K ´alm´an filter on a hidden
Markov chain [20].
The relationship with Bethe-Kikuchi approximations
is covered in the reference works [21, 11, 27] in the case
of graphs, yet a true correspondence with the CVM on
hypergraphs K ⊆ P(Ω) could bot be stated before the
GBP algorithm of Yedidia, Freeman and Weiss in 2005 [7],
whose work bridged two subjects with a long history. The
idea to replace the partition function ZΩ by a sum of local
terms ∑a∈K caZa, where coefficients ca ∈ Z take care of
eliminating redundancies, was first introduced by Bethe
in 1935, and generalized by Kikuchi in 1951 [4]. The trun-
cated M ¨obius inversion formula was only recognized by
Morita in 1957 [5], laying the CVM on systematic com-
binatorial foundations. Among recent references, see [28]
for a general introduction to the CVM. The convex regions
of Bethe-Kikuchi free energies and loopy BP stability are
studied in [29, 30], while very interesting loop series ex-
pansions may be found in [31] and [32]. For applications
of Bethe-Kikuchi free energies to neuroscience and active
bayesian learning, see also [12, 13, 14].
The unifying notion of graphical model describes
Markov random fields by their factorization properties,
which are in general stronger than their conditional in-
dependence properties obtained by the Hammersley-
Clifford theorem [33]. This work sheds a different light
from the usual probabilistic interpretation, so as to make
the most of the local structure of observation. The
mathematical constructions below thus mostly borrow
from algebraic topology and combinatorics. The refer-
ence on combinatorics is Rota [34], and the general con-
struction for the cochain complex (C∗•, d) dates back to
Grothendieck and Verdier [35]. It has been given a very
nice description by Moerdijk in his short book [36]. When
specializing the theory to localized statistical systems, one
quickly arrives at the so-called pseudo-marginal extension
problem [37, 38, 39] whose solution is closely related to the
interaction decomposition theorem [37, 40]. This fundamen-
tal result yields direct sum decompositions for the functor
of local observables, used in the proof of theorem 3 below.
B Methods and Results
This work brings together concepts and methods from
algebraic topology, combinatorics, statistical physics and
information theory. It should particularly interest users of
belief propagation algorithms, although we hope it will
also motivate a broader use of Bethe-Kikuchi information
functionals beyond their proven decoding applications. It
is intended as a comprehensive but high-level reference
on the subject for a pluridisciplinary audience. We expect
some readers might lack specific vocabulary from homo-
logical algebra, although we do not believe it necessary
for understanding the correspondence theorems. We pro-
vide specific references to theory and applications where
needed, and longer proofs are laid in appendix to avoid
burdening the main text for readers mostly interested by
the results.
The main object of theory here consists in what we call
2
the combinatorial chain complex (C•, δ, ζ). This is a graded
vector space L
r≥0 Cr, a codifferential δ : Cr → Cr−1, and
a combinatorial automorphism ζ : Cr → Cr, attached to
any hypergraph K with vertices in the set of variables Ω.
The operators ζ and δ acting on C0 and C1 generate belief
propagation equations, and an efficient implementation is
made available at github.com/opeltre/topos. Although
deeper numerical experiments are not in the scope of this
article, this library was used to produce the level curves
of a Bethe-Kikuchi free energy in figure 6 and the bench-
marks of figure 4.
Initial motivations were to arrive at a concise factor-
ization of GBP algorithms, and at a rigorous proof of the
correspondence between GBP fixed points and CVM so-
lutions. Although described earlier [8, 9, 10], there lacked
their relationship to a Bethe-Kikuchi max-entropy prin-
ciple A and its dual (equilibrium) free energy principle
C. The polynomial description of singular sets Σk ⊆ Γ0
is also new, and their explicit formulas on binary graphs
yield a very satisfying and most expected relationship
with the subject of loop series expansions [30, 31, 32].
The article is structured as follows.
− II. GRAPHICAL MODELS AND GENERALIZED BELIEF
PROPAGATION defines Gibbsian ensembles as positive
Graphical Models (GMs). The factorization property of
the probability density translates as a linear spanning
property of its log-likelihood, called a K-local observ-
able. GBP equations are then provided along with clas-
sical examples.
− III. MAX-ENTROPY AND FREE ENERGY PRINCIPLES
briefly reviews Boltzmann-Gibbs and Bethe-Kikuchi
principles so as to formulate the variational problems
A, B and C, localized versions of the fundamental prin-
ciples defining thermodynamic equilibrium in statisti-
cal physics.
− IV. LOCAL STATISTICAL SYSTEMS is the core techni-
cal section, where we define the chain complex (C•, δ)
of local observables, its dual complex (C∗•, d) of local
densities, and the combinatorial automorphisms ζ and
µ = ζ−1 acting on all the degrees of C•. These higher
degree combinatorics of Cr for r > 1 were described
previously in [9, chap. 3]. We here propose an inte-
gral notation for the zeta transform making the analogy
with geometry more intuitive, in the spirit of Rota [34].
− V. BELIEF DIFFUSIONS uses the codifferential δ and its
conjugate under ζ to generate diffusion equations on
the complex (C•, δ, ζ). We explain under which condi-
tions a flux functional Φ : C0 → C1 yields solutions
to problems A, B and C as stationary states of the dif-
fusion dv
dt = δΦ(v) on C0. Its purpose is to explore a
homology class [v] (energy conservation ) until meeting
the preimage Mβ ⊆ C0 of cohomology classes under
the Gibbs state map at inverse temperature β (marginal
consistency).
− VI. MESSAGE-PASSING EQUILIBRIA states the rigorous
correspondence between critical points and stationary
beliefs with theorems A, B and C. Singular subsets
Σk ⊆ Γ0 are defined by computing the dimension of the
intersection of the two tangent constraint manifolds, al-
most everywhere transverse. The fact that it may be
described by polynomial equations allows for numeri-
cal exploration of singularities, and motivate a deeper
study relating them to the topology of K.
C Notations
Let Ω denote a finite set of indices, which we may call the
base space. We view the partial order of regions (P(Ω), ⊆)
as a category with a unique arrow b→ a whenever b ⊆ a.
We write b ⊂ a only when b is a strict subset of a, and use
consistent alphabetical order in notations as possible. The
opposite category, denoted P(Ω)op , has arrows a → b for
b ⊆ a.
A free sheaf of microstates E : P(Ω)op → Set will then
map every region a ⊆ Ω to a finite local configuration
space Ea = ∏i∈a Ei. In other words, the sections of Ea are
vertex colourings xa = (xi)i∈a of a subset a ⊆ Ω, with
colours xi ∈ Ei for i ∈ a (called local microstates or con-
figurations in physical terminology). As a contravariant
functor, E maps every inclusion b ⊆ a to the canonical
restriction πa→b, projecting Ea onto Eb. Given a local sec-
tion xa ∈ Ea, we write xa|b = πa→b(xa).
For every region a ⊆ Ω, we will write REa for the fi-
nite dimensional algebra of real observables on Ea, write
REa∗ for its linear dual, and write ¯∆a = Prob(Ea) ⊂ REa∗
for the topological simplex of probability measures onEa,
also called states of the algebra REa . The open simplex of
positive states will be denoted ∆a ⊂ ¯∆a.
II. GRAPHICAL MODELS AND GENERALIZED
BELIEF PROPAGATION
A Graphical Models
In this paper, our main object of study is a special class of
Markov Random Fields (MRFs), called Gibbsian ensem-
bles in [33] although they are now more commonly called
Graphical Models (GMs) in the decoding and machine
learning contexts. Given a set of vertices Ω and a random
colouring xΩ = (xi)i∈Ω, a GM essentially captures the lo-
cality of interactions by a hypergraph K ⊆ P(Ω) over
which the density of xΩ should factorize. This property is
in general stronger than the Markov properties obtained
by the Hammersley-Clifford theorem (as conditional in-
dependence of separated regions only ensures factoriza-
tion over cliques [33]).
3
Definition 1. Given K ⊆ P(Ω) and a collection of factors
fa : Ea → R for a ∈ K, the graphical model parameterized
by ( fa)a∈K is the probability distribution
pΩ(xΩ) = 1
ZΩ
∏
a∈K
fa(xΩ|a), (1)
where Z Ω = ∑EΩ ∏a fa is an (unknown) integral over E Ω,
called the partition function.
It is common to represent GMs by their factor graph
(figure 1.b), a bipartite graph where variable nodes i ∈ Ω
carry variables xi ∈ Ei, and factor nodes a ∈ K carry local
functions fa : Ea → R. Factors a ∈ K are then linked to all
nodes i ∈ a ⊆ Ω. However, this graph structure should
not be confused with the partial order structure we use
for message-passing (figures 1.c and 1.d).
In statistical physics, where the notion of graphical
model originates from, it is more common to writepΩ as a
normalized exponential density 1
ZΩ
e−βHΩ called the Gibbs
density. The function HΩ : EΩ → R is called hamiltonian
or total energy and the scalar parameter β = 1/T is called
inverse temperature. This variable energy scale is often set
to 1 and omitted. We recommend references [1] and [2]
for deeper thermodynamic background.
Assuming positivity of pΩ, the factorization property
of a graphical model pΩ translates to a linear spanning
property on the global hamiltonian HΩ = ∑a −ln fa.
Definition 2. We say that a global observable HΩ : EΩ → R
is K- local with respect to the hypergraph K ⊆ P(Ω), when
there exists a family of interaction potentials ha : Ea → R
such that for all xΩ ∈ EΩ,
HΩ(xΩ) = ∑
a∈K
ha(xΩ|a). (2)
The Gibbs state of the hamiltonian HΩ at inverse temperature
β > 0 is the positive probability distribution
pΩ(xΩ) = 1
ZΩ
e−βHΩ(xΩ), (3)
and we denote the surjective Lie group morphism from global
observables to Gibbs states by
ρβ
Ω : REΩ → ∆Ω. (4)
The K-local Gibbsian ensemble is the image of K-local observ-
ables under ρβ
Ω (for any β).
The notions of Gibbsian ensembles [33] and graphical
models are only equivalent up to a positivity assumption
on pΩ. We always assume positivity of pΩ, although this
is not always the case in decoding applications.
Let C0(K) =∏a∈K REa denote the space of interaction
potentials, and write C0 = C0(K) by assuming K ⊆ P(Ω)
to be fixed. In general, the map from (ha) ∈ C0 to the
global hamiltonian HΩ ∈ REΩ has a low-dimensional
source space, but fails to be injective. In section IV we con-
struct a chain complex (C•, δ), i.e. a graded vector space
C• = Ln
r=0 Cr and a degree -1 square-null operator δ,
REΩ C0 C1 . . . Cn,
ζΩ δ δ δ (5)
We showed that this complex is acyclic is an exact se-
quence in previous work [8, 9]. In other words, Ker (δ) =
Im(δ) and Ker (ζΩ) = δC1. Degree-0 homology classes
[h] ∈ C0/δC1 thus yield a bijective parameterization of K-
local observables, this is the statement of theorem 3. The
complex structure moreover underlies belief propagation
algorithms, which explore a homology classh + δC1 ⊆ C0
of interaction potentials, and GBP is generalized by diffu-
sion equations of the form ˙v = δΦ(v) in section V.
B Generalized Belief Propagation
The purpose of Belief Propagation (BP) or sum-product
algorithms is to estimate the marginals (pa)a∈K of a GM
pΩ ∈ ∆Ω. Let us precise what is meant by beliefs early:
this terminology distinguishes them from true marginals
of a global distribution pΩ, which would admit a gen-
uine probabilistic interpretation, were they practically
computable by partial integration. Consistent beliefs are
also called fields of pseudo-marginals, because they satisfy
the same gluing axioms as true marginals. Their exten-
sion to a global measure on EΩ may not always be cho-
sen positive: this is known as the pseudo-marginal exten-
sion problem (see [38, 37] and [39] for a modern approach
with sheaves). Beliefs relax the consistency constraint, al-
though being purposed to reach a consensual state.
Definition 3. Beliefs (over K) are collection of local positive
probability densities q ∈ ∆0 = ∏a∈K ∆a.
Beliefs are saidconsistent, written q ∈ Γ0, if qb is the push-
forward of qa under πa→b : Ea → Eb for all b ⊂ a in K.
The Generalized Belief Propagation (GBP) algorithm
of Yedidia et al. [7] is an important generalization of BP
equations to hypergraphs K ⊆ P(Ω) (region graphs in
their terminology). Unlike BP on factor graphs, where
messages Ma→i(xi) respect the bipartite structure and
flow only from factors nodes to vertices, GBP iterates
upon messages Ma→b(xb) between any two regions such
that a ⊃ b, see figure 1.
Definition 4. Given positive factors f ∈ C0 (the model pa-
rameters, representing conditional kernels and local priors) and
positive initial messages M (0) ∈ C1 (which may be set to 1 or
absorbed in f ), the GBP equations
q(t)
b (xb) = 1
Zb
∏
c⊆b
fc(xb|c) ∏
a⊇c
a̸⊆b
M(t)
a→c(xb|c), (6)
4
Figure 1: Different representations ofK ⊆ P(Ω). Here K is a 2-dimensional simplicial complex (a). The factor graph (b) is constructed
by joining every factor node a ∈ K (squares) to its variables i ∈ a (dots). The region graph (c) instead inserts a directed edge between
any two region nodes a, b ∈ K such that a ⊇ b. The partial order structure is equivalently represented by (d), where height gives a
better impression of the ordering. In (c) and (d), non-primitive arrows (i.e. having a non-trivial factorization) are in orange, and the
terminal region ∅ is not represented.
M(t+1)
a→c (xc) =M(t)
a→c(xc) ·
∑
xa|c=xc
q(t)
a (xa)
q(t)
c (xc)
(7)
define a sequence (q, M) ∈ (∆0 × C1)N.
The evolution of q(t) only depends on the geometric
increment of messages M(t+1)/M(t). Setting M(0) = 1,
GBP equations therefore also define a dynamical system
GBP : ∆0 → ∆0, such that q(n) = GBPn(q(0)). It is clear
from (7) that consistency of beliefs q ∈ Γ0 is equivalent to
stationarity of messages. However it is not obvious that sta-
tionarity of beliefsimplies stationarity of messages, and this
explains why GBP is usually viewed as a dynamical sys-
tem on messages.
We showed that stationarity of beliefs does imply con-
sistency and stationarity of messages [8, 9], and called this
property faithfulness of the GBP diffusion flux (see defini-
tion 13 and proposition 30 below). This property is crucial
to retrieve the consistent polytope Γ0 ⊆ ∆0 as stationary
states of the dynamical system on beliefs, and thus prop-
erly draw the analogy between GBP and diffusion.
C Examples
1. Markov chains and trees
A length-n Markov chain on Ω = {0, . . . ,n} is local with
respect to the 1-graph K = K0 ⊔ K1 ⊆ P(Ω) linking
every vertex 0 ≤ i < n to its successor i + 1. Indi-
vidual states of the Markov chain are denoted xi ∈ Ei
for i ∈ Ω. This data extends to a contravariant functor
E : (K, ⊆)op → Set mapping edges ij ∈ K to pairwise
joint states Eij = Ei × Ej, and with canonical projections
as arrows.
Given an input prior f0(x0) := P(x0) and Markov
transition kernels fj,j−1(xj, xj−1) := P(xj|xj−1) for 1 ≤
j ≤ n, set other factors and messages to 1. BP and GBP
then coincide to exactly compute in n-steps the output
and hidden posteriors qj(xj) =P(xj) for j ≤ n as:
P(xj) = ∑
xj−1∈Ej−1
P(xj|xj−1) P(xj−1). (8)
In this particular case, the sum-product update rule thus
simply consists in a recurrence of matrix-vector multipli-
cations for Mj−1,j→j(xj) =qj(xj) =P(xj). The integrand
5
of (8) also yields the exact pairwise probabilityP(xj−1, xj)
by the Bayes rule.
The situation is very much similar for Markov trees ,
i.e. when K is an acyclic graph. In this case, choosing
any leaf node x0 as root, BP recursively computes the
bayesian posteriors P(xj) exactly, by integrating the prod-
uct P(xj|xi) P(xi) over the parent state xi ∈ Ei when com-
puting the message Mij→j(xj) by (7). This is the content
of Pearl’s original article on Bayesian trees [17].
A famous particular class of Markov trees consists of
hidden Markov chain models, for instance used by Fris-
ton in neuroscience [12], and of which the K´alm´an filter is
a continuous-valued gaussian version [20].
2. Spin glasses and Hopfield networks
A spin glass is a 1-graph K ⊆ P(Ω) whose vertices carry
a binary variable xi ∈ {−1, +1} = Ei. In this case, any
K-local hamiltonian HΩ : EΩ → R may be uniquely de-
composed as:
HΩ(xΩ) =h∅ + ∑
i∈K0
bixi + ∑
ij∈K1
wij xixj (9)
Uniqueness of this decomposition is a consequence of the
interaction decomposition theorem, see [37] and [40]. One of-
ten drops the constant factor h∅ for its irrelevance in the
Gibbs state definition.
Spin glasses are formally equivalent to the Ising model
of ferromagnetism, the only conceptual differences resid-
ing in a random sampling of biases bi ∼ P(bi) and weights
wij ∼ P(wij ), and in allowing for other graphs than cu-
bic lattices which describe homogeneous crystals. Bethe
produced his now famous combinatorial approximation
scheme in 1935 [3] to estimate the Ising model free energy.
BP works surprisingly well at estimating the true like-
lihoods P(xj) and P(xi, xj) by consistent beliefs qi(xi) and
qij (xi, xj) even on loopy graphs. It may however show
converge issues and increased errors as the temperature
decreases when K has loops, while the number of station-
ary states grows quickly with the number of loops. In the
cyclic case, each belief aggregates a product of messages
∏i Mij→j(xj) according to (6) before being summed over
in the computation of messages (7), and therefore does
not reduce to a simple matrix-vector multiplication. See
[18, 19, 23] for more information on loopy BP behaviour.
Spin glasses are also called Boltzmann machines [41]
in the context of generative machine learning. It is well
known that bipartite spin glasses, also called restricted
Boltzmann machines (RBMs), are equivalent to the Hop-
field model of associative memory whose phase transi-
tions [42, 43] have received a lot of attention. These phase
diagrams are generally obtained by the replica method
of Javanmard and Montanari [44] in the thermodynamic
limit. We believe a broader understanding of such phase
transitions in neural networks would be highly beneficial
for artificial intelligence, and a bayesian framework seems
more suitable for such a program than one-way parame-
terized functions and feed-forward neural networks.
3. Higher-order relations
When K ⊆ P(Ω) is a general hypergraph, we may write
K = F
r Kr by grading hyperedges a = {i0, . . . ,ir} accord-
ing to their dimension r, and write K−1 = {∅} when
K contains the empty region (which we usually assume
along with the ∩-closure of K). We call dimension of K the
greatest n such that Kn ̸= ∅, and call K an n-graph.
Working with a coarse n-graph K with n ≥ 2 is use-
ful even when the hamiltonian is local with respect to a
1-subgraph K′ ⊆ K. This is done by simply extending
K′-local factors ( fb)b∈K′ by fa = 1 for all a ∈ K ∖ K′. The
dimension of the coarser hypergraphK used for message-
passing thus provides greater precision at the cost of local
complexity, which is the cost of partial integrals on Ea for
maximal a ∈ K. From a physical perspective, this cor-
responds to applying Kikuchi’s Cluster Variation Method
(CVM) [4, 5] to a spin glass hamiltonian HΩ, given by (9).
There is also greater opportunity in considering higher
order interactions ha(xa) = hi0,...,ir (xi0 , . . . ,xir ) for r ≥ 2
to capture more subtle relations. Taking r = 2 with bi-
nary variables, the interaction terms wijk xixjxk mimics at-
tention in transformer networks. In a continuous-valued
case, where xi ∈ R3 for instance describes atomic posi-
tions in a molecule or crystal, energy couldn’t be made de-
pendent on bond angles without third-order interactions
hijk (xi, xj, xk) [45]. Continuous variables are outside the
scope of this article but we refer the reader to [46, 47, 26]
the Gaussian version of BP algorithms. See also [48] on
third-order Boltzmann machines and [49, 50] for more re-
cent higher-order attention network architectures.
III. ENTROPY AND FREE ENERGY PRINCIPLES
A Boltzmann-Gibbs variational principles
In classical thermodynamics, a statistical system Ω is de-
scribed by a configuration space E (assumed finite in the
following) and a hamiltonian H : E → R measuring the
energy level of each configuration. Thermal equilibrium
with a reservoir at inverse temperature β = 1/T defines the
so-called Gibbs state p β ∈ Prob(E) by renormalization of
the Boltzmann-Gibbs density e−βH:
pβ(x) = 1
Z e−βH(x) where Z = ∑
x∈E
e−βH(x) . (10)
Two different kinds of variational principles characterise
the equilibrium state pβ:
• the max-entropy principle asserts that the Shannon
entropy S(p) = − ∑E p ln(p) is maximal under an
internal energy constraint Ep[H] = U at equilib-
rium;
6
• the free energy principle asserts that the variational
free energy Fβ(p, H) = Ep[H] − TS(p) is minimal
under the temperature constraint T = 1/β at equi-
librium; it is then equal to the free energy Fβ(H) =
−ln ∑E e−βH.
Although equation (10) gives the solution to both optimi-
sation problems, computing Z naively is usually impossi-
ble for the size of E grows exponentially with the number
of microscopic variables in interaction.
The Legendre duality relating Shannon entropy and
free energies is illustrated by theorems 1 and 2 below, im-
plying the equivalence between entropy and free energy
Boltzmann-Gibbs principles [1, 2]. Properties of thermo-
dynamic functionals may be abstracted from the global
notion of physical equilibrium, and stated for every re-
gion a ⊆ Ω as below. Local functionals will then be
recombined following the Bethe-Kikuchi approximation
scheme in the next subsection.
Definition 5. For every a ⊆ Ω and β > 0, define:
• the Shannon entropy Sa : ∆a → R by
Sa(pa) =− ∑pa ln(pa), (11)
• the variational free energy Fβ
a : ∆a × REa → R by
Fβ
a (pa, Ha) =Epa [Ha] − 1
βSa(pa), (12)
• the free energy Fβ
a : REa → R by
Fβ
a (Ha) =−1
β ln ∑e−βHa . (13)
Legendre transforms may be carried with respect
to local observables and beliefs directly, instead of the
usual one-dimensional temperature or energy parame-
ters. To do so, one should describe tangent fibers of ∆a
as T pa ∆a ≃ REa mod R, so that additive energy con-
stants span Lagrange multipliers for the normalisation
constraint ⟨pa, 1a⟩ = 1. For a more detailed study of ther-
modynamic functionals, we refer the reader to [9, chap. 4]
and [2].
Theorem 1. Under the mean energy constraint⟨pa, Ha⟩ = U,
the maximum of Shannon entropy is reached on a Gibbs state
p∗
a = 1
Za e−βHa ,
Sa(p∗
a ) = max
pa∈∆a
⟨pa,Ha⟩=U
Sa(pa), (14)
for some univocal value of the Lagrange multiplier β ∈ R,
called inverse temperature.
Theorem 2. Under the temperature constraint T = 1/β,
given a hamiltonian H a ∈ REa , the minimum of variational
free energy is reached on the Gibbs state p∗
a = 1
Za e−βHa ,
Fβ
a (p∗
a, Ha) = min
pa∈∆a
Fβ
a (pa, Ha). (15)
It moreover coincides with the equilibrium free energy Fβ
a (Ha),
Fβ
a (Ha) = min
pa∈∆a
Fβ
a (pa, Ha) (16)
Although stated for every region a ⊆ Ω, theorem 2
only makes sense physically when applied to the global
region Ω. Indeed, local free energy principles (15) on re-
gions a ⊆ Ω totally neglect interactions with their sur-
roundings. The local beliefs (pa)a∈K they define thus have
very little chance of being consistent.
B Bethe-Kikuchi variational principles
We now proceed to define localised versions of the max-
entropy and free energy variational principles 1 and 2, at-
tached to any hypergraph K ⊆ P(Ω). We recall that C0
stands for the space of interaction potentials ∏a∈K REa ,
and that Γ0 ⊆ ∆0 ⊆ REa∗ denotes the convex polytope
of consistent beliefs (definition 3). Bethe-Kikuchi princi-
ples will characterise finite sets of consistent local beliefs
{p1, . . . ,pm} ⊆Γ0, in contrast with their global counter-
parts defining the true global Gibbs state pΩ ∈ ∆Ω.
Extensive thermodynamic functionals such as entropy
and free energies satisfy an asymptotic additivity property,
e.g. the entropy of a large piece of matter is the sum
of entropies associated to any division into large enough
constituents. Bethe-Kikuchi approximations thus consist
of computing only local terms (that is, restricted to a
tractable number of variables) before cumulating them in
a large weighted sum over regions a ∈ K where integral
coefficients ca ∈ Z take care of eliminating redundan-
cies. The coefficients ca are uniquely determined by the
inclusion-exclusion principle ∑a⊇b ca = 1 for all b ∈ K
(corollary 5). For a recent introduction to the CVM [4, 5],
we refer to Pelizzola’s article [28].
Let us first introduce the local max-entropy principle
we shall be concerned with. As in the exact global case,
the max-entropy principle (problem A) describes an iso-
lated system. It therefore takes place with constraints on
the Bethe-Kikuchi mean energy ˇU : ∆0 × C0 → R, given
for all p ∈ ∆0 and all H ∈ C0 by:
ˇU(p, H) = ∑
a∈K
ca Epa [Ha] (17)
Problem A. Let H ∈ C0 denote local hamiltonians and choose
a mean energy U ∈R.
Find beliefs p ∈ ∆0 critical for the Bethe-Kikuchi entropy
ˇS : ∆0 → R given by:
ˇS(p) = ∑
a∈K
ca Sa(pa), (18)
7
under the consistency constraint p ∈ Γ0 and the mean energy
constraint ˇU(p, H) =U.
The Bethe-Kikuchi variational free energy principle,
problem B below, instead serves as a sound local substi-
tute for describing a thermostated system at temperature
T = 1/β.
Problem B. Let H ∈ C0 denote local hamiltonians and choose
an inverse temperature β > 0.
Find beliefs p ∈ ∆0 critical for the Bethe-Kikuchi variational
free energy ˇF : ∆0 × C0 → R given by:
ˇFβ(p, H) = ∑
a∈K
ca Fβ
a (pa, Ha), (19)
under the consistency constraint p ∈ Γ0.
Problems A and B are both variational principles on
p ∈ Γ0 with the consistency constraint in common, but
with dual temperature and energy constraints respec-
tively. In contrast, the following free energy principle
(problem C) explores a subspace of local hamiltonians
V ∈ C0, satisfying what we shall view as a global energy
conservation constraint in the next section. Let us write
V ˇ∼H if and only if ∑a caVa = ∑a ca Ha as global observ-
ables on EΩ.
Problem C also describes a system at equilibrium with
a thermostat at fixed temperature T = 1/β.
Problem C. Let H ∈ C0 denote local hamiltonians and choose
an inverse temperature β > 0.
Find local hamiltonians V ∈ C0 critical for the Bethe-Kikuchi
free energy ˇFβ : C0 → R given by:
ˇFβ(V) = ∑
a∈K
ca Fβ
a (Va), (20)
under the energy conservation constraint V ˇ∼H.
In contrast with the convex optimisation problems of
theorems 1 and 2, note that the concavity or convexity
of information functionals is broken by the Bethe-Kikuchi
coefficients ca ∈ Z. This explains why multiple solutions
to problems A, B and C might coexist, and why they can-
not be found by simple convex optimisation algorithms.
We will instead introduce continuous-time ordinary dif-
ferential equations in section V. Their structure is remark-
ably similar to diffusion or heat equations, although com-
binatorial transformations may again break stability and
uniqueness of stationary states.
On the Ising model, Schlijper showed that the CVM
error decays exponentially as K ⊆ P(Zd) grows coarse
with respect to the range of interactions [6]. This result
confirms the heuristic argument on the extensivity of en-
tropy, and reflects the fast decay of high-order mutual in-
formations that are omitted in the Bethe-Kikuchi entropy
[9, chap. 4].
IV. LOCAL STATISTICAL SYSTEMS
In the following, we let K ⊆ P(Ω) denote a fixed hyper-
graph with vertices in Ω = {1, . . . ,N}, and moreover as-
sume that (K, ⊆, ∩) forms a semi-lattice. The following
constructions could be carried without the ∩-closure as-
sumption, but theorem 3 and the correspondence theo-
rems of section VI would become one-way.
This section carries the construction of what we may
call a combinatorial chain complex (C•, δ, ζ) of local observ-
ables, recalling the necessary definitions and theorems
from [9]. The first ingredient is the codifferential δ, sat-
isfying δ2 = δδ = 0 and of degree -1:
C0
δ←−C1
δ←− . . . δ←−Cn. (21)
The first homology [C0] =H0(C•, δ) will yield a bijective
parameterization of K-local observables in REΩ , this is the
statement of the Gauss theorem 3. On the other hand, the
dual cochain complex
C∗
0
d−→C∗
1
d−→ . . . d−→C∗
n (22)
will allow us to describe consistent beliefs p ∈ Γ0 by the
cocycle equation dp = 0, living in the dual cohomology
[C∗
0 ] = H0(C∗•, d). The construction of (C∗•, d) may be
traced back to Grothendieck and Verdier [35, 36], yet we
believe the interaction of algebraic topology with combi-
natorics presented here to be quite original.
The zeta transform is here defined as a homogeneous
linear automorphism ζ : C• → C•, and plays a role very
similar to that of a discrete spatial integration, confirming
an intuition of Rota. It satisfies remarkable commutation
relations with δ, the Gauss/Greene formulas (44) and (45).
Its inverse µ is called the M¨ obius transformand the recip-
rocal pair (ζ, µ) extends the famous M¨obius inversion for-
mulas [34] to degrees higher than 1 in the nerve of K. All
these operators will come into play when factorizing the
GBP algorithm and defining Bethe-Kikuchi diffusions in
section V.
Our localization procedure could be summarized as
follows. First, we restrict the sheaf E to a contravariant
functor EK over K; then, we define a simplicial set N•EK
extending EK to the categorical 1 nerve N•K by mapping
every strictly ordered chain a 0 ⊃ · · · ⊃ap to its terminal
configuration space Ea0...ap := Eap . In particular, the set
N1K describes the support of GBP messages, while higher
order terms provide a projective resolution of K-local ob-
servables.
1Not to be confused with the ˇCech nerve of a covering, often used to define sheaf cohomology. They only differ by a barycentric subdivision so that
the two cohomology theories are isomorphic [51].
8
A Algebraic topology
The functor of local observables RE : P(Ω) → Algc maps
every region a ⊆ Ω to the commutative algebra REa . Its
arrows consist of natural inclusions REb ⊆ REa , when
identifying each local algebra with a low dimensional
subspace of REΩ . We write ˜ha
b : xa 7→ hb(xa|b) when the
extension should be made explicit, and identify ˜ha
b with
hb for all a ⊇ b otherwise.
One may then define a chain complex of local observ-
ables C• = C•(K, RE) indexed by the nerve of K as fol-
lows. Its graded components Cr are defined for 1 ≤ r ≤ n,
where n denotes the maximal length of a strictly ordered
chain in K, by:
Cr = ∏
a0⊃···⊃ar
REar . (23)
For every strict chain⃗a = a0 ⊃ · · · ⊃ar in NrK, and every
0 ≤ j ≤ r, let us denote by ⃗a(j) the j-face of⃗a, obtained by
removing aj.
Definition 6. The chain complex oflocal observables (C•, δ)
is defined by (23) and the degree -1 boundary operator δ, whose
action δ : C1 → C0 is given by
δφb(xb) = ∑
a⊃b
φa→b(xb) − ∑
b⊃c
φb→c(xb|c), (24)
while δ : Cr+1 → Cr acts by
δψ⃗b(xbr ) =
r+1
∑
j=0
(−1)j
∑
⃗c(j)=⃗b
ψ⃗c(xbr|cr+1 ). (25)
Note that br = cr+1 for all j < r + 1 in the first r sums of (25).
The classical identity ¯a(i)(j) = ¯a(j+1)(i) for all i < j,
together with linearity and functoriality of the inclusions
REb ⊆ REa , implies the differential rule δ2 = δ ◦ δ = 0.
One may see in formula (24) an analogy betweenδ and
a discrete graph divergence, or the divergence operator
of geometry : theorem 3 below is a discrete yet statisti-
cal version of the Gauss theorem on a manifold without
boundary. It gives a local criterion for the global equal-
ity of K-local hamiltonians and is proven in appendix A.
The chain complex(C•, δ) can moreover be proven acyclic
(see [9, thm 2.17] and [35, 36]) when K is ∩-closed, the
exact sequence (21) then describes the linear subspace of
K-local energies, through a projective resolution of the quo-
tient C0/δC1.
Theorem 3 (Gauss). Assume K ⊆ P(Ω) is ∩-closed. Then
the following are equivalent for all h, h′ ∈ C0:
(i) the equality ∑a∈K h′
a = ∑a∈K ha holds in REΩ ,
(ii) there exists φ ∈ C1 such that h′ = h + δφ.
In other words h ′ and h are homologous, written h ′ ∼ h or
h′ ∈ [h], if and only if they define the same global hamiltonian.
The functor of local densities RE∗ : P(Ω)op → Vect
is then defined by duality, mapping every a ⊆ Ω to
the vector space of linear forms on REa . Its arrows con-
sist of partial integrations πa→b
∗ : REa∗ → REb∗, also
called marginal projections. This functor generates a dual
cochain complex (C∗•, d) which shall serve to describe
pseudo-marginals (pa)a∈K ∈ Γ0 ⊂ C∗
0 , used as substitute
for global probabilities pΩ ∈ ∆Ω.
Definition 7. The cochain complex of local densities (C∗•, d)
is defined by C ∗
r = L(Cr) and the degree +1 differential d,
whose action d : C∗
0 → C∗
1 is given by
dpa→b(xb) =pb(xb) − ∑
xa|b= xb
pa(xa). (26)
while d : C∗
r → C∗
r+1 acts by
dq⃗a(xar+1 ) =
r
∑
j=0
(−1)j q⃗a(j) (xar+1 )
+ (−1)r+1
∑
xar|ar+1 =xar+1
q⃗a(r+1) (xar )
(27)
Densities satisfying dp = 0 are called consistent. The convex
polytope of consistent beliefs is Γ0 = ∆0 ∩ Ker(d) ⊆ C∗
0 .
The purpose of BP algorithms and their generaliza-
tions is to converge towards consistent beliefsp ∈ Γ0. The
non-linear Gibbs correspondence relating potentials h ∈ C0
to beliefs p ∈ C∗
0 will thus be essential to the dynamic of
GBP:
pa(xa) = 1
Za
e−βHa(xa) with Ha(xa) = ∑
b⊆a
hb(xa|b).
(28)
The mapping h 7→ H above is an invertible Dirichlet con-
volution [34] on C0, analogous to a discrete integration
over cones Ka ⊆ K. Although seemingly simple, this
mapping ζ and its inverse µ surely deserve proper atten-
tion.
B Combinatorics
The combinatorial automorphisms ζ and µ we describe
below generalize well-knownM¨ obius inversion formulason
C0 and C1. The convolution structure in degrees r ≤ 1
originates from works of Dirichlet in number theory, and
was thoroughly described by Rota [34] on general partial
orders; let us also mention the interesting extension [52]
to more general categories.
Heuristically, ζ and µ might be viewed as combina-
torial mappings from intensive to extensive local observ-
ables and reciprocally, which systematically solve what
are known as inclusion-exclusion principles.
9
Figure 2: Schematic pictures of the Gauss and Greene formulas. Left: in degree 0, the red circles represent regions in the cone Ka be-
ing summed over when evaluating ζ(v)a, while blue arrows represent coboundary terms ofdKa being summed over when evaluating
ζ(δφ)a, for v ∈ C0 and φ ∈ C1. Right: in degree 1, red arrows represent flux terms in the 1-cone Kab = Ka
b → Kb summed by ζ(φ)a→b,
while blue triangles represent the coboundary 2-chains of dKab summed by ζ(δψ)a→b, for φ ∈ C1 and ψ ∈ C2.
Definition 8. The zeta transform ζ : C• → C• is the linear
homogeneous morphism acting on C0 by letting ζ : h 7→ H,
Ha(xa) = ∑
b⊆a
hb(xa|b), (29)
and acting on Cr by letting ζ : φ 7→ Φ,
Φ⃗a(xar ) = ∑
br⊆ar
· · ·∑
b0⊆a0
b0̸⊆a1
φ⃗b(xar|br ) (30)
Note that b0 ⊃ · · · ⊃br is also implicitly assumed in (30).
Definition 8 extends to C• the action of ζ on C0. The
action ζ : C1 → C1 defined by (30) should not be con-
fused with the convolution product of the incidence al-
gebra ˜C1(K, Z), obtained by including degenerate chains
(identities) a ⊇ b in ˜N1K ≃ N0K ⊔ N1K, and restricting to
integer coefficients. See for instance Rota [34] for details
on Dirichlet convolution, and [9, chap. 3] for the module
structure considered here.
Remember we assume K ⊆ P(Ω) to be ∩-closed2 for
theorem 3 to hold. This is also necessary to obtain the ex-
plicit M¨obius inversion formula (33) below.
Theorem 4. The M¨obius transform µ = ζ−1 is given in all
degrees by a finite sum:
µ =
n
∑
k=0
(−1)k(ζ − 1)k (31)
The action of µ : C0 → C0 may be written µ : H 7→ h,
ha(xa) = ∑
b⊆a
µa→b Hb(xa|b), (32)
and the action µ : Cr → Cr may be written µ : Φ → φ,
φ⃗a(xar ) = ∑
br⊆ar
µar→br · · ·∑
b0⊆a0
b0̸⊆b1
µa0→b0 Φ⃗b∩ (xar|b∩r ) (33)
where⃗b∩ := b0 ⊃ (b0 ∩ b1) ⊃ · · · ⊃(b0 ∩ · · · ∩br) in (33).
In (31), n is the maximal length of a strict chain in K.
In degree 0, this yields the usual recurrence formulas for
µa→b in terms of all the strict factorisations of a → b.
In practice, the matrix µ can be computed efficiently in
a few steps by using any sparse tensor library. When K
describes a graph, one for instance has (ζ − 1)3 = 0. The
nilpotency of ζ − 1 furthermore ensures that µ = ζ−1 is
given by (31) even without the∩-closure assumption. The
reader is referred to [9, thm 3.11] for the detailed proof
of (33), briefly summarized below.
Sketch of proof. The definitions of ζ and µ both exhibit a
form of recursivity in the degree r. Letting ia : Cr → Cr−1
denote evaluation of the first region on a ∈ K, one for
instance has on Cr for r ≥ 1:
ζ(φ)a0...ar = ∑
b0∈Ka0a1
ζ(ib0 φ)a1...ar . (34)
The above extends toC0 by agreeing to letζ act as identity
on C−1 := REΩ ⊇ REb0 , and letting a1 = ∅ i.e. Ka0
a1 = Ka0 .
On the other hand, the M¨obius transform is recovered
from operators νa : Cr → Cr−1 as µ(Φ)a0...ar = νar . . .νa0 Φ,
where:
νa0 (Φ)a1...ar = ∑
b0∈Ka0a1
µa0→b0 Φb0∩(a1...ar) (35)
2This coincides with the region graph property of Yedidia, Freeman and Weiss [7], when describing the hypergraph K in their language of bipartite
region graphs.
10
The technical part of the proof then consists in proving
νa0 ◦ ζ = ζ ◦ ia0 , using classical M ¨obius inversion formu-
las [9, lemma 3.12]. One concludes thatµ(ζφ )a0...ar is com-
puted as νar . . .νa0 (ζφ ) =ζ(iar . . .ia0 φ) =φa0...ar .
Corollary 5. Bethe-Kikuchi coefficients are equivalently de-
fined by the inclusion-exclusion principle (36) and the explicit
M¨ obius inversion formula(37):
∑
a⊇b
ca = 1 for all b ∈ K, (36)
cb = ∑
a⊇b
µa→b for all b ∈ K. (37)
Proof. This classical result is just ζ∗(c) =1 ⇔ c = µ∗(1),
denoting by ζ∗ and µ∗ the dual automorphisms obtained
by reversing the partial order on K. See [34].
For every H ∈ C0 given by H = ζh ⇔ h = µH, a con-
sequence of (37) is that for all xΩ ∈ EΩ, the total energy is
exactly computed by the Bethe-Kikuchi approximation:
∑
a∈K
ha(xΩ|a) = ∑
b∈K
cb Hb(xΩ|b). (38)
Including the maximal region Ω in ˜K = {Ω} ∪K yields
the total energy of (38) as HΩ = ζ(h)Ω, while hΩ = 0 en-
sures the exactness of the Bethe-Kikuchi energy by (37).
In contrast, writing S = ζs ∈ RK for the M ¨obius inver-
sion of local entropies, the total entropy ∑ cbSb computed
by problems A and B neglects a global mutual informa-
tion summand sΩ = ∑ µΩ→aSa, which does not cancel
on loopy hypergraphs3. This relationship between Bethe-
Kikuchi approximations and a truncated M ¨obius inver-
sion formula was first recognized by Morita in [5].
Let us now describe the remarkable commutation re-
lations satisfied by ζ and δ. Reminiscent of Greene formu-
las, they confirm the intuition of Rota who saw in M¨obius
inversion formulas a discrete analogy with the fundamen-
tal theorem of calculus [34]. They also strengthen the re-
semblence of GBP with Poincar´e’s balayage algorithm [53],
used to find harmonic forms on Riemannian manifolds,
by solving local harmonic problems on subdomains and
iteratively updating boundary conditions.
The Gauss formula (39) below has been particularly
useful to factorize the GBP algorithm through ζ ◦ δ in [8].
Its simple proof will help understand the more general
Greene formula (44) below.
Proposition 9 (Gauss formula). For all φ ∈ C1 we have:
∑
c⊆b
δφc = ∑
c⊆b
∑
a⊃c
a̸⊆b
φa→c (39)
When Ω ∈ K, both sides of (39) involve the action of ζ:
ζ(δφ)b = ζ(φ)Ω→b (40)
Proof. Note that inclusions REc ⊆ REb are implicit in (39)
and below. By definition of ζ : C0 → C0 and δ : C1 → C0,
ζ(δφ)b = ∑
c⊆b

∑
a⊃c
φa→c − ∑
d⊂c
φc→d

. (41)
Inbound flux terms φa→c such that a ⊆ b compensate all
outbound flux terms φc→d, which always satisfy c ⊆ b.
Therefore only inbound flux terms φa→c such that a ̸⊆ b
and c ⊆ b remain.
For every K0, . . . ,Kr ⊆ K, let us write K0 → · · · →Kr
for the subset NrK ∩ (K0 × · · · ×Kr) of strictly ordered
chains. We then define the following subsets of N•K to
strengthen the analogy with geometry. They are depicted
in figure 2.
Definition 10. For all a, b in K let us define:
(a) K b = {c ∈ K |c ⊆ b} ⊆C0 the cone below b,
(b) K a
b = Ka ∖Kb the intercone from a to b,
(c) dK b = S
a∈K(Ka
b → Kb) the coboundary of Kb
Then Kb, Ka
b ⊆ N0K and dK b ⊆ N1K. Given ⃗a = a0 . . . ar in
NrK and ⃗b = b1 . . . br in Nr−1K, we then recursively define
the following subsets of NrK for r ≥ 1:
(d) K a0...ar = Ka0
a1 → Ka1...ar the r-hypercone below⃗a,
(e) dK b1...br = S
b0∈K Kb0b1...br the coboundary of Kb1...br .
Following Rota, we want to think of ζ as a combinato-
rial form of spatial integration. For every r-field φ ∈ Cr
and integration domain Σ ⊆ NrK, let us introduce the fol-
lowing notation:
Z
Σ
φ = ∑
⃗a∈Σ
jΣ←⃗a(φ⃗a) (42)
where jΣ←⃗a embeds REar into the linear colimit S
b∈Σ REbr
of the local observables functor over Σ, here a linear sub-
space of the algebra REΩ .
It follows that
R
Ka0...ar defines a map Cr → REar , which
coincides with the evaluation of ζ : Cr → Cr on a0 . . . ar,
Z
Ka0...ar
φ = ζ(φ)a0...ar . (43)
The Gauss formula (39) may then be generalized to all the
degrees of C• by the pleasant form below, which is only a
rewriting of [9, thm 3.14].
Theorem 6 (Greene formula). For all φ ∈ Cr we have:
Z
Kb0...br
δφ =
Z
dKb0...br
φ (44)
3Generalizing a classical result on trees, we proved that sΩ also vanishes on acyclic or retractable hypergraphs [9, chap. 6], although a deeper
topological understanding of this unusual notion of acyclicity in degrees n ≥ 2 is called for.
11
Theorem 6 is proved in appendix A. When Ω is in K,
remark that the coboundary dKb of Kb coincides with KΩ
b
by definition 10. More generally, dKa0...ar then coincides
with KΩa0...ar and the Greene formula (44) takes the very
succinct form ζ ◦ δ = iΩ ◦ ζ, where iΩ denotes evaluation
of the first region on Ω.
Let us finally express the conjugate of δ by the graded
automorphism ζ in terms of Bethe-Kikuchi numbers. The
following proposition will yield a concise and efficient ex-
pression for the Bethe-Kikuchi diffusion algorithm in sec-
tion V.
Theorem 7. Let ˇδ = ζ ◦ δ ◦ µ and Φ ∈ Cr such that Φ = ζϕ.
Then for all a1 . . . ar in Nr−1K, one has:
ˇδΦa1...ar =
Z
dKa1...ar
ϕ = ˇΦΩa1...ar (45)
where ˇΦΩa1...ar denotes a Bethe-Kikuchi approximation of the
total inbound flux to Ka1...ar , given by
ˇΦΩa1...ar = ∑
a0̸⊆a1
ca0 Φa0(a0∩a1)...(a0∩ar). (46)
Remark that (46) reduces to ˇΦΩa1...ar = ΦΩa1...ar when
Ω ∈ K, as in this case cΩ = 1 and ca = 0 for all a ̸= Ω.
The proof of theorem 7 is carried in appendix A.
V. BELIEF DIFFUSIONS
In this section, we describe dynamical equations that
solve Bethe-Kikuchi variational principles. Their com-
mon structure will shed light on the correspondence theo-
rems A, B and C proven in section VI. Their informal state-
ment is that solutions to free energy principles (problems
B and C) can both be found by conservative or isothermal
transport equations on C0 which we described in [10]. In
contrast, solving the max-entropy principle (problem A)
will require to let temperature vary until equilibrium, so
as to satisfy the mean energy constraint. This calls for a
new kind of adiabatic diffusion equations on C0, satisfying
energy conservation up to scalings only.
To make the most of the available linear structures on
(C•, δ, ζ), evolution is first described either at the level of
potentials v ∈ C0 or at the level of local hamiltonians
V = ζv ∈ C0. We conclude this section by translating
the dynamic on beliefs q = ρ(V) ∈ ∆0, for a clearer com-
parison with GBP . Bethe-Kikuchi diffusion will not only
differ from GBP by an arbitrary choice of time step ε > 0,
but also from a degree-1 M¨obius inversion on messages.
A Isothermal diffusion
The purpose of isothermal diffusion is to solve the local
free energy principles B and C by enforcing two different
types of constraints simultaneously on v ∈ C0:
(i) energy conservation, asking that ∑a∈K va is fixed to a
given global hamiltonian HΩ ∈ REΩ ,
(ii) belief consistency, asking that the local Gibbs states
p = ρβ(ζv) agree and satisfy dp = 0, i.e. p ∈ Γ0.
If a potential h ∈ C0 satisfies (i), theorem 3 implies that
there should always exist a heat flux φ ∈ C1 such that
v = h + δφ, in other words v ∈ [h] is homologous to h.
This naturally led us to generalize GBP update rules by
continuous-time transport equations on C0 [8, 9, 10]:
dv
dt = δΦ(v). (47)
Definition 11. Given a flux functional Φ : C0 → C1 and an
inverse temperature β ∈ R, we call isothermal diffusion the
vector field Xβ
Φ : C0 → C0 defined by:
Xβ
Φ(v) =1
β δΦ(βv) (48)
The analytic submanifold Mβ ⊆ C0 defined below
should be stationary under (47) for diffusion to solve
Bethe-Kikuchi optimisation problems, as the belief consis-
tency constraint (ii) imposes restrictions on the flux func-
tionals Φ : C0 → C1 suited for diffusion. The submanifold
N β ⊆ Mβ describes stronger constraints, by assuming
Gibbs densities normalized to a common mass.
Definition 12. Denote by e−V ∈ C∗
0 the unnormalized Gibbs
densities of V ∈ C0. For every inverse temperature β > 0, we
call consistent manifold the subspace N β ⊆ C0 defined by
N β = {v ∈ C0 | e−β ζv ∈ Ker(d)} (49)
and call projectively consistent manifold the larger space:
Mβ = {v ∈ C0 | ρβ(ζv) ∈ Γ0} (50)
We write N = N1 and M = M1.
Note that Mβ only consists of a thickening of N β by
the action of additive constants, which span a subcomplex
R• ⊆ C•. Also remark that N β = β−1 · N1 is a scaling of
N for all β > 0, and Mβ = β−1 · M1 as well. It is hence
sufficient to study isothermal diffusions at temperature 1,
see appendix B for more details on the consistent mani-
folds.
Definition 13. We say that a flux functional Φ : C0 → C1 is
(a) consistent at β > 0 if:
v ∈ Nβ ⇒ Φ(v) =0 (51)
(b) faithful at β > 0 if moreover:
δΦ(v) =0 ⇔ v ∈ Nβ. (52)
We say that Φ is projectively consistent (resp. faithful) if (a)
(resp. (b)) holds when Mβ replaces N β.
12
Figure 3: Norm of the free energy gradient ||DV|| over 15 time units for Bethe-Kikuchi diffusions (blue) and GBP diffusions (red),
for different values of the time step parameter λ. For λ = 1/4 (solid line), GBP diffusion sometimes converges in spite of oscillations;
for λ = 1/2 (dashed line), GBP diffusion almost never converges; and for λ = 1 (dotted line) GBP diffusion explodes even faster. On
the other hand, λ has very little effect on the fast convergence of Bethe-Kikuchi diffusion. The hypergraph K is the 2-horn – join of
three 2-simplices {(012), (013), (023)} – and coefficients of the initial potential h ∈ C0 are sampled from normal gaussians.
Let us now construct flux functionals Φ : C0 → C1 ad-
missible for diffusion. Although consistency may be eas-
ily enforced via factorization through the following oper-
ator, as the next proposition shows, proving faithfulness
remains a more subtle matter.
Definition 14. (Free energy gradient) Let D : C0 → C1 de-
note the smooth functional defined by:
DVa→b(xb) =Vb(xb) +ln ∑
xa|b=xb
e−Va(xa) (53)
Proposition 15. For all V ∈ C0, let q = e−V ∈ C∗
0 . Then
dq = 0 ⇔ D V = 0. (54)
It follows that the flux functional Φf = f ◦ D ◦ζ is consistent
for any smooth f : C1 → C1.
Proof. For all a ⊃ b in K, it is clear that e−Vb = πa→b
∗ (e−Va )
if and only if Vb = −ln πa→b
∗ (e−Va ).
In section V .C, we recover the discrete dynamic of
GBP by using the flux functional ΦGBP = −D ◦ζ. The
smooth dynamic on potentials integrates the vector field
XGBP = δΦGBP on C0, computed by the diagram:
XGBP : C0 C0
C1
ζ
−D
δ
(55)
The flux functional ΦGBP is faithful (at β = 1). See propo-
sition 30 in appendix for a proof, involving duality and
monotonicity arguments which we already gave in [8]
and [9]. Although seemingly optimal when K is a graph,
we argued in [9, chap. 5] that the heat flux ΦGBP intro-
duces redundancies on higher-order hypergraphs, which
explain the explosion of normalization constants.
The Bethe-Kikuchi diffusion flux ΦBK = −µ ◦ D ◦ζ adds
a degree-1 M ¨obius inversion (33) of GBP messages. The
isothermal vector field XBK = δΦBK is then computed by:
XBK : C0 C0
C1 C1
ζ
−Dδ
µ
(56)
The conjugate codifferential ˇδ = ζ ◦ δ ◦ µ is thus occurring
in (56), and one may substitute the result of theorem 7 to
arrive at a very concise and efficient expression of the con-
jugate vector field ζ ◦ XBK ◦ µ, governing the evolution of
local hamiltonians.
From the perspective of local hamiltonians V = ζv,
first remark that in both cases the evolution ˙v = δϕ under
diffusion reads ˙V = ζ(δϕ), conveniently computed by the
Gauss formula (39) on a cone Kb:
dVb
dt = ζ(δϕ)b =
Z
dKb
ϕ (57)
We argue that the GBP fluxΦ = −D(ζv) =−DV belongs
to the ”extensive” side, and should not be integrated as is
on the coboundary of Kb. In fact, if one were able to com-
pute the global free energy gradient DVΩ→b = −ΦΩ→b
for all b ∈ K, the effective hamiltonians V′
b = Vb + ΦΩ→b
would yield the sought for Gibbs state marginals exactly.
Using the Bethe-Kikuchi flux ϕ = µΦ thus allows to
sum only ”intensive” flux terms entering Kb. Their in-
tegral over dKb yields the Bethe-Kikuchi approximation
ˇΦΩ→b of the global free energy gradient term ΦΩ→b by
theorem 7:
dVb
dt =
Z
dKb
ϕ = ˇΦΩ→b = ∑
a̸⊆b
caΦa→a∩b. (58)
13
Substituting −DV for Φ yields, after small combinatorial
rearrangements, the explicit formula [9, thm 5.33]:
dVb(xb)
dt = ∑
a∈K
ca

− ln ∑
xa|a∩b
=xb|a∩b
e−Va(xa)

− Vb(xb) (59)
In [10], we empirically showed that the Bethe-Kikuchi dif-
fusion flux improves convergence and relaxes the need
to normalize beliefs at each step. Figure 3 also shows
that discrete integrators of XBK quickly converge for large
time steps λ where integrators of XGBP require a value
of λ < 1/4 on the 2-horn K (the simplest 2-complex for
which GBP is not exact). The flux ΦBK may me proven
faithful at least in a neighbourhood of N, see proposition
31 in appendix.
B Adiabatic diffusion
In order to solve the localised max-entropy principle A,
one needs to let temperature vary so as to enforce the
mean energy constraint. Theorem A will describe solu-
tions as dimensionless potentials ¯v ∈ C0, satisfying both
the consistency constraint (ii) at β = 1 and the following
conservation contraint replacing (i):
(i’) projective energy conservation , asking that ∑a∈K ¯va is
fixed to a given line RHΩ ⊆ REΩ .
Fix a reference potential h ∈ C0 and let HΩ = ∑a∈K ha. By
theorem 3, constraint (i’) is equivalent to the existence of
β ∈ R and φ ∈ C1 such that ¯v = βh + δφ. We therefore
equivalently rewrite (i’) as ¯v ∈ R[h] =Rh + δC1. Adding
a radial source term to (47), we may enforce both (i’) and
the mean energy constraint U = E[HΩ] as follows.
Given an energy value U ∈R and a flux functional
Φ : C0 → C1, we call adiabatic diffusion an ordinary differ-
ential equation on C0 of the form
d ¯v
dt = δΦ( ¯v) +
 
U − ⟨p, h⟩

· ¯v
where p = ρ(ζ ¯v).
(60)
It might seem paradoxical that the adiabatic diffusion in-
cludes what looks like an energy source term, when
isothermal diffusion does not. The dynamical variable
¯v ∈ C0 here describes a dimensionless potential ¯v = βv
given v ∈ C0, measuring energies divided by an unknown
temperature scale. The source term ΨU ( ¯v) ∈ R¯v below
therefore describes a variation in temperature rather than
a variation in energy.
Definition 16. Given a flux functional Φ : C0 → C1, a po-
tential h ∈ C0 and a mean energy U ∈R, we call adiabatic
diffusion the vector field YU
Φ : C0 → C0 defined by:
YU
Φ ( ¯v) =δΦ( ¯v) +ΨU ( ¯v) (61)
ΨU ( ¯v) =

U − ⟨ρ(ζ ¯v), h⟩

· ¯v (62)
It follows that YU
Φ = X1
Φ + ΨU relates isothermal and adiabatic
diffusions.
The dependency in h ∈ C0 is implicit in (61) and (62).
It cannot be absorbed in the definition of ΨU as ¯v ∈ C0
is unaware of the reference energy scale, and the pair
(U, h) ∈ R × C0 is in fact necessary to define the mean
energy constraint. One may write ΨU,h and YU,h
Φ when
the dependency in h ought to be made explicit, although
h can be assumed fixed for present purposes.
As in the isothermal case, it is necessary to restrict the
flux functional Φ to enforce the belief consistency con-
straint (ii) at equilbrium. The same flux functionals may
be used for both isothermal and adiabatic diffusions.
Proposition 17. Assume Φ : C0 → C1 is faithful. Then for
all U ∈R, the adiabatic vector field YU
Φ is stationary on ¯v ∈ C0
if and only if p = ρ(ζ ¯v) is consistent and ⟨p, h⟩ = U.
Proof. Note that the r.h.s. of (60) naturally decomposes
into the direct sum δC1 ⊕ R¯v(t) for all t ∈ R, whenever
the initial potential h = ¯v(0) is not a boundary of C• (in
that case, total and mean energies vanish). It follows that
¯v(t) is always homologous to a multiple of h, and that
∑a∈K ¯va(t) is always equal to a multiple of HΩ = ∑a∈K ha
by theorem 3, and that ¯v(t) satisfies the projective energy
conservation constraint (i’). When Φ is projectively faith-
ful, the direct sum decomposition furthermore implies
that adiabatic diffusion is stationary on v ∈ C0 if and only
if local Gibbs states p = ρ(ζv) satisfy both the mean en-
ergy constraint ⟨p, v⟩ = U and the belief consistency con-
straint (ii), dp = 0.
The inverse temperature β = T−1 of the system will
be defined at equilibrium as Lagrange multiplier of the
mean energy constraint, by criticality of entropy (see e.g.
[1, 2] and section VI below). As we shall see, the Bethe-
Kikuchi entropy may have multiple critical points, and
therefore multiple values of temperature may coexist at a
given value of internal energy.
C Dynamic on beliefs
Let us now describe the dynamic on beliefs q ∈ ∆0 in-
duced by isothermal and adiabatic diffusions onC0. They
both regularize and generalize the GBP algorithm of [7].
In the following, we denote by R• ⊆ C• the subcomplex
spanned by local constants.
Starting from a potential h ∈ C0, beliefs are recovered
through a Gibbs state map ρβ ◦ ζ for some β ∈ R+. The
affine subspace [h] = h + δC1 satisfying (i) is therefore
mapped to a smooth submanifold of ∆0,
Bβh := ρβ 
ζ[h]

⊂ ∆0. (63)
On the other hand, the set of consistent beliefs Γ0 ⊆ ∆0
satisfying (ii) is a convex polytope ofC∗
0 (whose preimage
14
under ρβ ◦ ζ is Mβ). Conservation (i) and consistency (ii)
constraints thus describe the intersection Bβh ∩ Γ0 when
viewed in ∆0. The non-linearity has shifted from (ii) to (i)
in this picture.
In order to recover well-defined dynamical systems
on ∆0, trajectories of potentials v ∈ C0 under diffusion
should be assumed to consistently project on the quo-
tient C0/R0, i.e. to not depend on the addition of lo-
cal energy constants λ ∈ R0 ≃ RK. Classes of poten-
tials v + R0 are indeed in one-to-one correspondence with
classes of local hamiltonians ζ(v + R0) = V + R0, them-
selves in one-to-one correspondence with the local Gibbs
states q = ρβ(V) = 1
Z e−βV. Both GBP and Bethe-Kikuchi
diffusions naturally define a dynamic on C0/R0 ≃ ∆0.
inverse temperature
1 2 3 4 5 6
%
0
10
20
30
40
50
60
70
80
90
100
Convergent runs
dt=1 dt=0.5 dt=0.1
Figure 4: Effect of the time step parameter λ on convergence of
diffusions on a 50x50 Ising lattice. For λ = 1 (blue), we recover
the GBP algorithm. Results are very similar for λ = 1/2 (red)
and λ = 1/10 (green). Coefficients of the 100 initial batched
hamiltonians H ∈ C0 are sampled from N(0, 1). Note that
1 − tanh(β) estimates the typical distance to the boundary of ∆0
and 1 − tanh(6) ≃ 10−5 brings numerical instabilities.
Let us first relate the GBP equations (6) and (7) to a dis-
crete integrator of the GBP diffusion flux XGBP , defined
by (55). The isothermal vector field XGBP = δΦGBP can
be approximately integrated by the simple Euler scheme
v(t+λ) = (1 + λXGBP ) · v(t), which yields for q = ρ(ζv)
q(t+λ)
b (xb) ∝ q(t)
b (xb) · ∏
a⊇c
a̸⊆b

m(t)
a→c(xb|c)
λ, (64)
m(t)
a→c(xc) =
∑
xa|c=xc
q(t)
a (xa)
q(t)
c (xc)
(65)
Exponential versions of the Gauss formula (39) should be
recognized in (6) as in (64). Remark that the message term
m(t) = e−ΦGBP (v) = e−DV of (65) is equal to the geomet-
ric increment of messages M(t+1)/M(t) computed by the
GBP update rule (7), so that the two algorithms coincide
for λ = 1. The parameter λ otherwise appears as expo-
nent of messages in (64), leaving (65) unchanged.
Because one is usually only interested in the long-term
behaviour of diffusion and its convergence to stationary
states, the parameter λ usually does not have to be in-
finitesimal. Figure 4 shows the effect of varying λ on a
50x50 Ising lattice. Choosing λ ≃ 1/2 instead of 1 already
greatly improves convergence [10], making belief diffu-
sions suitable for a wider class of initial conditions than
plain GBP . For low temperatures (high β), numerical in-
stabilities occur that are not escaped by values of λ ≃ 0.1,
as q reaches distances of order 10−5 from the boundary of
∆0. Perhaps higher-order integration schemes would be
beneficial in this regime.
On hypergraphs, the Bethe-Kikuchi diffusion flux
ΦBK = µ ◦ ΦGBP also behaves better than ΦGBP (the evo-
lution of beliefs is otherwise identical when K is a graph).
Integrating (59) with a time step λ ≥ 0 yields the follow-
ing dynamic on ∆0:
q(t+λ)
b ∝ q(t)
b · ∏
a∈K
h
m(t)
a→a∩b
iλca
(66)
m(t)
a→c = πa→c
∗ (q(t)
a )
q(t)
c
(67)
Note that M ¨obius inversion of messages allows for con-
vergent unnormalised algorithms. Replacing the propor-
tionality sign ∝ of (66) by an equality assignment, the al-
gorithm will converge to unormalized densities qa whose
masses πa→∅∗ (qa) are all equal to q∅, the empty region
taking care of harmonizing normalization constants.
Adiabatic diffusions, on the other hand, only enforce
the projective energy constraint (i’), so as to fix an internal
energy value U ∈R. Energy scales acting as exponents
in the multiplicative Lie group ∆0, and the simple Eu-
ler scheme of (60) with the Bethe-Kikuchi diffusion flux
yields: ΦBK yields
q(t+λ)
b = 1
Zb
h
q(t)
b
i1+λψ
· ∏
a∈K
h
m(t)
a→a∩b
iλca
where ψ = U − ⟨q(t), h⟩.
(68)
The messages remain given by (67), they still compute the
exponential of the free energy gradient e−D ¯V for ¯V = ζ ¯v.
From a technical perspective, working with beliefs
(bounded between 0 and 1) may help avoiding the nu-
merical instabilities one may encounter with logsumexp
functions. However, optimizing the product of messages
computed by the exponential Gauss formula (64) is not
straightforward. Working with potentials and hamiltoni-
ans instead allows to use sparse matrix-vector products to
15
effectively parallelize diffusion on GPU, as implemented
in the topos library.
VI. MESSAGE-PASSING EQUILIBRIA
Let us now show that problems A, B and C are all equiva-
lent to solving both local consistency constraints and energy
conservation constraints. In other words, given a reference
potential h ∈ C0, all three problems are equivalent to find-
ing v ∈ [h] ∩ Mβ.
It will be more informative to study [h] ∩ Nβ, resolv-
ing the degeneracy of additive constants acting on Mβ.
It may happen that this intersection is everywhere trans-
verse, as is the case on acyclic or retractable hypergraphs,
where true marginals may be computed in a finite number
of steps [9, thm. 6.26]. In general, theorem 8 shows that
the singular subspace ¯S1 ⊆ Nwhere both constraint sur-
faces are tangent can be described by polynomial equa-
tions on the convex polytope Γ0 ⊆ ∆0. This important
step towards a more systematic study of GBP equilibria
suggests the existence of phase transitions, between both
different regimes of diffusion and different free energy
landscapes in Bethe-Kikuchi approximations.
Figure 5: Cuspidal singularity of the Bethe-Kikuchi variational
free energy (red dot). The stationary manifold N is tangent to
the space of gauge transformationsδC1 on the singular subspace
S1 (red line). At the cusp, S1 is tangent to both N and δC1.
A Correspondence theorems
The difference between problems A, B and C mostly con-
sists in which sets of variables are viewed as constraints
and which are viewed as degrees of freedom. The max-
entropy principle A treats β as a free variable and U as
a constraint, while free energy principles B and C treat
β as a constraint and U as a free variable. Solutions to
problems A, B and C still share a common geometric de-
scription, involving intersections of the form [h] ∩ Mβ for
a given potential h ∈ C0.
Another distinction emerges from the local structure
of Bethe-Kikuchi approximations. It will be reflected in
the duality between beliefs p ∈ ∆0 and potentials v ∈ C0,
and between the differential d : C∗
0 → C∗
1 and the cod-
ifferential δ : C1 → C0. Bethe-Kikuchi principles thus
become reminiscent of harmonic problems, yet the non-
linear mapping ρ ◦ ζ : C0 → ∆0 will allow for singular
intersections of the two constraint surfaces, and multiple
numbers of stationary states (see figure 5).
In the statements of theorems A, B and C below, we
assume a projectively faithful flux functional Φ : C0 → C1
(see definition 13) is chosen. The faithful flux ΦGBP will
fix N β instead of Mβ, but enforcing belief normalization
at each step would turn it into a projectively faithful flux.
We spare the reader with these technical details, covered
in more details in [9, chap. 5].
Proofs are found in appendix D. Recall that notations
[h] = h + δC1 and [Rh] = Rh + δC1 stand for (lines of)
homology classes.
Theorem A. Let U ∈R and h ∈ C0. Denoting by A U ⊆ C∗
0
the affine hyperplane where ⟨p, h⟩ = U, problem A is equiva-
lent to:
∂ ˇS(p)
∂p

Tp(Γ0∩ AU )
= 0
⇔ p = ρ1(ζ ¯v) ∈ AU with ¯v ∈ [Rh] ∩ M1
(69)
In particular, critical potentials ¯v ∈ C0 coincide with fixed
points of the adiabatic diffusion YU
Φ restricted to [Rh].
Note that any v ∈ [h] ∩ Mβ yields a reduced potential
¯v = βv lying in [βh] ∩ M1 by lemma 28, and therefore a
solution to problem A of energy U = ⟨ρ(ζ ¯v), h⟩.
The form of theorem A is preferred because it involves
a simpler intersection problem in C0: between the linear
subspace [Rh] = Rh + δC1, the consistent manifold M1
that does not depend on β, and the non-linear mean en-
ergy constraint ⟨ρ1(ζ ¯v), h⟩ = U. The possible multiplicity
of solutions for a given energy constraintU may occur for
different values of the Lagrange multiplier β.
Theorem B. Let β > 0, h ∈ C0. Problem B is equivalent to:
∂ ˇFβ(p, H)
∂p

TpΓ0
= 0
⇔ p = ρβ(ζv) with v ∈ [h] ∩ Mβ
(70)
In particular, critical potentials v ∈ C0 coincide with fixed
points of the isothermal diffusion Xβ
Φ restricted to [h].
Theorem B rigorously states the correspondence of
Yedidia, Freeman and Weiss [7] between stationary states
of GBP and critical points of the CVM, which general-
ized the well-known correspondence on graphs [11]. The
statement above makes the notion of stationary state more
precise and our rigorous proof avoids any division by
Bethe-Kikuchi coefficients thanks to lemma 19.
16
Before formulating the statement of theorem C, let us
denote by c : C0 → C0 the multiplication by Bethe-
Kikuchi coefficients. One may show thatcb = 0 whenever
b is not an intersection of maximal regions a1, . . . , an ∈ K.
However, assuming thatK is the ∩-closure of a set of max-
imal regions does not always imply the invertibility of c.
When c is not invertible, problem C will exhibit an affine
degeneracy along Ker(c).
Definition 18. Let us call Mβ
+ = {v + b | v ∈ Mβ, b ∈
Ker(cζ)} ⊆C0 the weakly consistent manifold. In particu-
lar, Mβ
+ = Mβ when c is invertible.
A linear retraction rβ : Mβ
+ → Mβ will be defined by
equation (126) in the proof of theorem C below. It maps
solutions of problem C onto those of B. From the perspec-
tive of beliefs, this retraction simply consists of filling the
blanks with the partial integration functor.
Theorem C. Let β > 0, h ∈ C0, problem C is equivalent to:
∂ ˇFβ(V)
∂V

TV ζ[h]
= 0
⇔ V = ζw with w ∈ [h] ∩ Mβ
+
(71)
The weakly consistent potentials w ∈ [h] ∩ Mβ
+ can be univo-
cally mapped onto [h] ∩ Mβ by a retraction r β. They coincide
with fixed points of the isothermal diffusion Xβ
Φ restricted to [h]
when c is invertible, and with its preimage under rβ otherwise.
To prove theorems A, B and C we will need the fol-
lowing lemma, which is rather subtle in spite of its appar-
ent simplicity (see [9, Section 4.3.3] for detailed formulas).
The lemma states that multiplication by c is equivalent to
M¨obius inversion up to a boundary term in C0.
Lemma 19. There exists a linear flux map Ψ : C0 → C1 such
that c − µ = δΨ.
Proof of lemma 19. Theorem 3 faithfully characterizes the
homology classes [h] of C0/δC1 by their global hamilto-
nian HΩ = ∑a ha when K is ∩-closed (see [9, cor. 2.14]).
Therefore exactness of Bethe-Kikuchi energy (38), implies
that h = µH and cH are always homologous, so that the
image of c −µ is contained inδC1. One may therefore con-
struct an arbitrary Ψ : C0 → C1 such that c − µ = δΨ by
linearity. The flux values taken by Ψ are only constrained
in C1/δC2, as Ker (δ) and Im(δ) coincide on positive de-
grees i.e. C• is acyclic [9, thm. 2.17].
The proofs of theorems A and B (detailed in appendix)
may then be summarized as follows. Under consistency
constraints on a critical belief p ∈ Γ0 ⊆ C∗
0 , the adjunc-
tion d = δ∗ first implies that the variations cancel on
Ker(d) =Im(δ)⊥. As linear forms onC∗
0 , ∂p ˇS and ∂p ˇF can
therefore lie in δC1 through Lagrange multipliers δψ, and
we write δψ + λ ∈ δC1 + Λ for the general expression of
differentials at a critical point. The space Λ only depends
on the other constraints at hand : Λ = R0 for problem A,
and Λ = Rh + R0 for problem B (additive constants in R0
are dual to normalization constraints, and h ∈ C0 is dual
to the internal energy constraint ⟨p, h⟩ = U).
The form of Bethe-Kikuchi functionals naturally leads
to express ∂p ˇS and ∂p ˇF as cV for some V ∈ C0, through
standard computations of partial derivatives. Writing
V = ζv, the remaining difficulty consists in showing
that cV = δψ + λ is equivalent to v = δφ + λ for some
φ ∈ C1. This difficult step is greatly eased by lemma 19,
which states that [v] = [µV] = [cV] coincide as homology
classes.
In contrast, theorem C works under energy constraints
on the potential w ∈ [h] ⊆ C0, yielding local hamiltonians
V = ζw, but the consistency of p = ρ(V) is not enforced
as a constraint. The linear form ∂V ˇF will be written cp,
which lies in Ker (dζ∗) =Im(ζδ)⊥ when critical, because
of the energy conservation constraint on V ∈ ζ(h + δC1).
This only implies q = ζ∗(cp) ∈ Ker(d) in general, yet we
will conclude that p and q must agree on all the regions
b where cb ̸= 0, so that the affine degeneracy of solu-
tions (absent in A and B) is completely supported by the
non-maximal regions that cancel c. The consistent beliefs
q ∈ Γ0 then solve B.
B Singularities
Let us say that v ∈ Nis singular if TvN ∩δC1 ̸= 0, and
call singular degree of v the number
corkv = dim(TvN ∩δC1). (72)
When p = ρ(ζv), according to (63) corkv coincides with
cork p = dim(Ker(d) ∩ TpBv). (73)
Both numbers measure the singularity of the canonical
projection N →C0/δC1 onto homology classes, a sub-
mersion if and only if corkv = 0 everywhere on N.
Definition 20 (Singular sets). For all k ∈ N, let
(a) Sk := {corkv = k} ⊆ N,
(b) Σk := {cork p = k} ⊆Γ0,
denote the singular stratifications of N and Γ0 respectively.
Figure 5 depicts a situation whereS1 is non-empty. We
refer the reader to Thom [54] and Boardman [55] for more
details on singularity theory.
We show that the singular setsΣk are defined by poly-
nomial equations in Γ0. Singularities will therefore be
located on the completion ¯Σ1 of a smooth hypersurface
Σ1 ⊆ Γ0, which may be possibly empty. In particular the
intersections N ∩[v] and Γ0 ∩ Bv are almost everywhere
transverse.
17
In what follows, we denote byR[∆0] (resp. R(∆0)) the
algebra of polynomials (resp. rational functions) on the
span of ∆0 ⊆ C∗
0 , by R[λ] the algebra of polynomials in
the real variable λ. For a vector space E, the Lie algebra
of its endomorphisms is denoted gl(E).
Theorem 8. There exists a polynomial χ ∈ R[∆0] ⊗ R[λ], of
degree dim(δC1) in λ ∈ R, such that for all p ∈ Γ0:
p ∈ Σk ⇔ χp(λ) has root 1 of multiplicity k (74)
We shall prove theorem 8 by computing the corank of
linearized diffusion restricted to δC1.
Assume given a faithful flux functional Φ : C0 → C1,
satisfying the axioms of definition 13, for instance ΦGBP .
The isothermal diffusion XΦ = δΦ then only fixes N,
defined by Φ = 0, while evolution remains parallel to
δC1. Linearizing XΦ in the neighbourhood of v ∈ N
thus yields an endomorphism TvXΦ on C0, of kernel TvN,
which stabilizes δC1 by construction. The singular degree
of v therefore computes the corank of T vXΦ restricted to
boundaries,
corkv = cork(TvXΦ|δC1 ). (75)
By faithfulness of ΦGBP = −D ◦ζ, one may explicitly
compute corkv via minors of the sparse matrix
TvXGBP = δ ◦ (TζvD) ◦ ζ. (76)
Letting p = ρ(ζv), theorem 8 will easily follow from
lemma 21, stating that cork p = corkv, and from propo-
sition 22, which implies that TvXGBP has rational function
coefficients in p.
Lemma 21. If p = ρ(ζv) ∈ Γ0 then cork p = corkv.
The proofs of lemma 21 and theorem 8 are delayed to
the end of this subsection. Taking a closer look at the lin-
earized structure of TvN before hand will yield an inter-
esting description of singularities by conservation equa-
tions on 1-fields ϕ ∈ C1 (proposition 23) which we shall
use to give an explicit expression for χ on binary graphs
in the next subsection.
Proposition 22. For all V ∈ C0, the map TV D : C0 → C1 is
expressed in terms of p = ρ(V) by
[TV D ·V′]a→b(xb) =V′
b(xb) − Epa [V′
a | xb] (77)
for all V′ ∈ C0, all a ⊃ b in K and all xb ∈ Eb.
Proof. This computation may be found in [9, prop. 4.14].
It consists in differentiating the conditional free energy
term −ln ∑xa|b=xb e−Va(xa) with respect to Va ∈ REa .
Note that any p ∈ Γ0 defines a family of local metrics
(ηpa )a∈K such that ηpa (Ua, Va) := Epa [UaVa], consistent in
the sense that the restriction of ηpa to REb ⊆ REa coin-
cides with ηpb for all a ⊇ b by consistency of p. The direct
sum of the ηpa defines a scalar product ηp on C•, which
we denote by ⟨−, −⟩p.
Denote by Ea→b
p the orthogonal projection REa → REb
with respect to ηpa , for all a ⊇ b. This is the conditional
expectation operator on observables, adjoint of the em-
beddings REb ⊆ REa . Defining ∇p : C0 → C1 by (77):
∇p(V′)a→b = V′
b − Ea→b
p [V′
a], (78)
propositions 15 and 22 imply that for all p = ρ(ζv) ∈ Γ0,
TvN = Ker(∇p ◦ ζ) =Ker(Tv(D ◦ζ)). (79)
The restriction of ηp to tangent fibers T vN for p = ρ(ζv)
moreover makes N a Riemannian manifold.
It is worth mentioning that∇p is the adjoint ofδ for the
metric ηp on C•, and therefore extends to a degree 1 differ-
ential on C• [9, prop 5.8]. This follows from adjunction of
the projections Ea→b
p with the inclusions ja←b, as identify-
ing C• with its dual C∗• through ηp, the operator ∇p then
represents d. However, note that δC1 is the orthogonal of
Ker(∇p) =ζ(TvN) but not of Ker(∇p ◦ ζ) =TvN, which
may intersect δC1.
Proposition 23. For all ϕ ∈ C1 and all p ∈ Γ0, one has:
∇p ζ(δϕ)a→b =
Z
dKb
ϕ − Ea→b
p
Z
dKa
ϕ

=
Z
Kab
ϕ − Ea→b
p
Z
KΩa →Ka
b
ϕ
 (80)
Proof. Substituting the Gauss formula (39) into (78) yields
the first line. We may then partition the coboundary dKb
by source as KΩ
b → Kb = (KΩ
a ⊔ Ka
b) → Kb, and dKa by
target as KΩ
a → Ka = KΩ
a → (Ka
b ⊔ Kb). Also note thatR
dKb ϕ ∈ REb is fixed by Ea→b
p to remove the redundant
terms and obtain the second line (see definition 10 for
notations : KΩ
a here denotes the complement of Ka, and
Kab = KΩ
a → Kb).
Proof of theorem 8. For all V ∈ C0, coefficients of the linear
map TV D = ∇p are rational functions of p = ρ(V) in (77).
The coefficients ofEa→b
p are indeed given according to the
Bayes rule, for all a ⊇ b in K, as
pa(xa|xb) = pa(xa)
∑
ya|b=xb
pa(ya) ∈ R(∆0). (81)
As δ and ζ have integer coefficients, it follows that TvXGBP
given by (76), is obtained by evaluating a rational function
of linear maps L ∈ R(∆0) ⊗ gl(C0) at p = ρ(ζv).
By Im(L) ⊆ δC1, we may define a restricted operator
L′ ∈ R(∆0) ⊗ gl(δC1). The characteristic polynomial map
gl(δC1) → R[λ] then gives an expression
det

λ − 1 + L′
p

δC1
= χ(p, λ)
Q(p) (82)
18
Figure 6: Level curves of the Bethe free energy ˇF accross a cuspidal singularity (red dot), for increasing values of the external mag-
netic field (left to right). On each plot, the horizontal axisU ∈ C0 represents variations in inverse temperature (i.e. a parameter), while
the vertical axis V ∈ ζ(δC1) represents a 1D-fiber of equivalent energies (i.e. an optimization variable). Convexity in the V-axis is lost
when temperature drops as two additional critical points stem from the singularity (right of the dashed line). Also notice ˇF acquires
a sharp step when the magnetic field increases.
It is clear from (81) that the poles ofQ(p) lie on the bound-
ary of Γ0 as pa > 0 for all a ∈ K inside Γ0; furthermore
Q(p) does not depend on λ.
The multiplicity of the root λ = 1 in χp(λ) = χ(p, λ)
therefore computes the dimension of Ker (L′
p), which is
precisely corkv by (75). Lemma 21 finally implies that
χp(1) =0 is a polynomial equation in p of ¯Σ1 = S
k≥1 Σk,
defined by cork p ≥ 1. One may compute cork p by evalu-
ating derivatives ∂jχ/∂λj at λ = 1 to recover the singular
stratification.
Proof of lemma 21. Let us stress that both points of view
(v ∈ Nand p ∈ Γ0) are meant to be identical, were it not
for the action of additive constants. The Gibbs state map
ρ ◦ ζ induces a quotient diffeomorphism ∆0 ≃ C0/R0,
sends N to Γ0 and v + δC1 to Bv by definition.
Note that N ∩R0 = µ(R) is a supplement of δR1
(see appendix B). The existence of a terminal element (by
∩-closure assumption) indeed implies that µ(1) sums to
∑b cb = 1 (corollary 5, see also appendix B) and thatµ(R)
is not a coboundary of δC1 by theorem 3.
This implies that δR1 ⊆ R0 (acting on [v] but triv-
ially on Bv) does not intersect N, and that the intersec-
tion of δC1 with N ∩R0 reduces to zero. The intersections
TvN ∩δC1 and Tp(Γ0 ∩ Bv) must therefore have same di-
mension.
C Loopy Graphs
In the case of graphs, we may give polynomial equations
for the singular strata Σk explicitly. They are obtained as
a loop series expansion by focusing on the action of diffu-
sion on fluxes φ ∈ C1, via the remarkable Kirchhoff for-
mula (83) below. The reader may find in [29, 30, 31, 32]
very similar loop expansions for the Bethe-Kikuchi ap-
proximation error and the analysis of BP stability.
When K ⊆ P(Ω) is a graph, we simply writeij ∈ K for
edges and i ∈ K for vertices (instead of{i, j} and {i}). Our
∩-closure assumption usually implies that ∅ ∈ K and the
nerve of K is then a simplicial set of dimension 2. How-
ever, as N2K only consists of chains ij → i → ∅ and E∅ is
a point (unit for ×), C2 is only spanned by additive con-
stants and coincides with R2.
We denote by K′ = K ∖ {∅} the associated graph in
a more usual sense, whose nerve N•K′ is of dimension 1.
The notation i ⌢ j will indicate that i is a neighbour of j
in K and K′, whenever ij ∈ K.
Proposition 24 (Kirchhoff formula). Given p ∈ Γ0, denote
by Z(p)
1 ⊆ C1 the subspace defined by Epb [ϕa→b] = 0 for all
a → b ∈ N1K and
ϕjk→k = Ejk→k
p

∑
i⌢j
ϕij→j

(83)
for all jk → k ∈ N1K. Then cork p = dim Z(p)
1 .
Proof. First assume that ϕ ∈ C1 is orthogonal to R1 for ηp.
Letting (1a→b) denote the canonical generators of R1, we
then have Epb [ϕa→b] = 0 = ηp(ϕ, 1a→b) for all a → b in
N1K, and in particular ϕa→∅ = 0 for all a ∈ K. Let C′
1
denote the space of such fields orthogonal to R1.
Assume now in addition thatδϕ ∈ Ker(∇p ◦ζ). It then
follows from proposition 23 that for all jk → k ∈ N1K,
Z
K(jk)
(k) →K(k)
ϕ = Ejk→k
p
Z
KΩ
(jk)→K(jk)
(k)
ϕ

(84)
19
Equation (83) is equivalent to cancelling the r.h.s. of (80)
in its second form when ϕ ∈ C′
1, as all the ϕa→∅ vanish.
Its l.h.s. reduces to ϕjk→k while the r.h.s. sums inbound
fluxes ϕij→j over source edges ij ̸⊆ jk, containing the tar-
get j ⊆ jk, j ̸⊆ k (brackets in (84) are used to avoid am-
biguous interpretation of notations in definition 10).
We showed that (83) describes Ker (∇p ◦ ζ ◦ δ) under
the assumption that ϕ ⊥ R1. Recalling that cork p is the
dimension of Ker(∇p ◦ ζ) ∩ δC1, we may compute cork p
as corank of the restriction of ∇p ◦ ζ ◦ δ to a supplement
of Ker(δ). Now as δ = ∇∗
p for the metric ηp, the subspace
∇p C0 ⊆ C1 is such a supplement.
Let us show that ∇pC0 contains C′
1. Given ϕ ∈ C′
1,
the orthogonal projections of ϕij→j ∈ REj and ϕij→i ∈ REi
onto REj ∩ REi = RE∅ = R vanish for every edge ij ∈ K
by the assumption ϕ ⊥ R1. We may thus choose Vij
in REij ≃ REi ⊗ REj ⊃ REi + REj that projects onto
−ϕij→i ∈ REi and −ϕij→j ∈ REj . Letting Vi = 0 for all
vertex i ∈ K and V∅ = 0, we may get V ∈ C0 such that
∇pV = ϕ, as
∇p(V)ij→j = 0 − Eij→j
p [Vij ] =ϕij→j (85)
for all ij → j ∈ N1K, and ∇pVa→∅ = 0 for all a ∈ K. As
C′
1 ⊆ ∇pC0 consists of cocyles, cork p is greater or equal
than the corank of ∇p ◦ ζ ◦ δ restricted to C′
1.
The subspace R′
1 = R1 ∩ ∇pC0 contains the remaining
cocyclic degrees of freedom as
∇pC0 = C′
1
⊥
⊕ R′
1. (86)
However, as we shown in the proof of lemma 21, the sub-
space δR′
1 ⊆ δR1 does not intersect Ker(∇p ◦ζ), while it is
stable under diffusion. Therefore R′
1 does not contribute
to cork p and
cork p = cork(∇p ◦ ζ ◦ δ|C′
1
). (87)
The Kirchhoff formula (83) will allow us to relate the
emergence of singularities to the topology of K. Just like
steady electric currents cannot flow accross open circuits,
it is clear (83) will not admit any non-trivial solutions
when K is a tree. However, unlike electric currents, the
zero-mean constraint excludes scalar fluxes, fixed by con-
ditional expectation operators. Multiple loops will thus
need to collaborate for non-trivial solutions to appear.
Fixing p ∈ Γ0, denote by C′
1 ⊆ C1 the orthogonal of
local constants for ηp as above. Choosing a configuration
oi ∈ Ei and letting E∗
i = Ei ∖ {oi} for each vertex i, one
has an isomorphism:
C′
1 ≃ ∏
ij→j∈N1K′
RE∗
j (88)
Let us also denote by Ep : C′
1 → C′
1 the edge propagator
Ep(ϕ)jk→k = Ejk→k
p

∑
i⌢j
ϕij→j

, (89)
so that (83) is the eigenvalue equation ϕ = Ep(ϕ). One
may recover cork p in the characteristic polynomial of Ep,
which we compute explicitly for binary variables.
Definition 25. Define a directed graph structure G on N1K′,
by including all edges of the form(ij → j) ▷ (jk → k) for i ̸= k.
The edges of G describe all non-vanishing coefficients
of the matrix Ep. However note that coefficients of Ep are
indexed by lifts of an edge (ij → j) ▷ (jk → k) to a pair of
configurations (xj, xk) ∈ E∗
j × E∗
k in general.
Let us now restrict to binary variables for simplicity, so
that the edges of G are in bijection with the non-vanishing
coefficients of Ep ∈ R(∆0) ⊗ gl(C′
1). The coefficient of Ep
attached to an edge (ij → j) ▷ (jk → k) actually does not
depend on i, as it consists in projecting observables onj to
observables on k with the metric induced by pjk by (89). It
may thus be denoted ηjk(p) for now. An explicit form will
be given by (96) below, which is symmetric in j and k.
Definition 26. Denote by SkG ⊂S(N1K′) the set of per-
mutations with exactly m − k fixed points, compatible with G.
Any γ ∈ SkG decomposes as a product of l(γ) disjoint cycles.
Theorem 9. Assume xi ∈ Ei is a binary variable for all i ∈ K.
Then p ∈ ¯Σs if and only if (λ − 1)s divides the polynomial
χp(λ) =
m
∑
k≥0
λm−k
∑
γ∈SkG
(−1)l(γ) Λp[γ], (90)
where Λp[γ] is the product of coefficients of Ep accross γ
Λp[γ] =
γ
∏
ij→j ▷jk→k
ηjk(p), (91)
and where ηjk(p) can be chosen as (96) below, in an orthonor-
mal system of coordinates for ηp.
Note that factorizing γ as γ1 . . .γl(γ), one has:
Λp[γ] =
l(γ)
∏
s=1
Λp[γs]. (92)
We may call Λp[γs] the loop eigenvalue of γs.
Proof of theorem 9. Proposition 24 implies that cork p is the
multiplicity of 1 as eigenvalue of Ep, in other words the
dimension of Ker(1 − Ep) ⊆ C′
1. Let us show that χp(λ)
does compute the characteristic polynomial of Ep.
Consider a matrix M : Rm → Rm, whose diagonal
coefficients all vanish, and write Sk
m ⊆ Sm for the set of
permutations having exactlym −k fixed points. Using the
Leibniz formula, one gets for χM(λ) =det (λ − M):
χM(λ) =
m
∑
k=0
λm−k
∑
σ∈Skm
ε(σ)(−1)k
∏
e̸∈Fix(σ)
Me,σ(e) (93)
20
Figure 7: Computation of χp(1) on the dumbell and theta graphs. The sum of listed monomials sums to 0 when p ∈ ¯Σ1 is singular.
Every edge jk in the base graph K′ gives rise to a pair jk → k and jk → j of vertices in G. This explains why every edge of K′ may
be walked through in both directions, although U-turns are not permitted as jk → j and jk → j are not adjacent in G. The precise
topology of K′ (including its vertices) does not really matter here, as loop eigenvalues Λp[γ] only compute products of coefficients
accross cycles.
The signature of a length- k cycle σ ∈ Sk
m has signature
ε(σ) = (−1)k−1. By multiplicativity of ε(σ), it follows that
for every product of disjoint cycles σ = σ1 . . .σl ∈ Sk
m,
(−1)kε(σ) = (−1)l (94)
Therefore (90) computes the characteristic polynomial of
Ep, whose diagonal coefficients do vanish.
Let us express the ηjk(p) in an orthonormal system of
coordinates, convenient for the symmetry in j and k it in-
duces. The price to pay is that ηjk(p) becomes a rational
function in √p and not in p, but this choice greatly simpli-
fies computations. We write xi ∈ {±}with p±
i = pi(±)
and p±±
ij = pij (±±), etc.
For ϕ ∈ C′
1, each flux term ϕij→j may be constrained
to a 1-dimensional subspace Ruj of REj ≃ R2, chosen so
that Epj [uj] = 0 and Epj [u2
j ] = 1. In the (+, −) coordi-
nates, we thus define uj as:
uj = 1q
p+
j p−
j
·
 
p−
j
−p+
j
!
(95)
Because Ejk→k
p [uj] has zero mean too, it must lie in Ruk.
Hence, Ejk→k
p [uj] =ηjk(p) · uk where ηjk(p) is found as:
ηjk(p) =
p++
jk p−−
jk − p+−
jk p−+
jkq
p+
j p−
j · p+
k p−
k
(96)
The scaling factor ηjk(p) is symmetric in j and k as Ejk→k
p
is a (self-adjoint) projector in REjk ≃ R4. The reader may
check (96) by performing the 2x2 matrix-vector product
pkj · uj and dividing the resulting vector by pk, accord-
ing to the Bayes rule, then substituting for pj and pk the
marginals of pjk when necessary. Again, we stress that the
image of uj must lie in Ruk by the zero-mean constraint
uj, uk ⊥ R.
21
Letting gj =
q
p+
j p−
j denote the geometric mean of pj
and letting ˜uj = gjuj for all j:
Ejk→k
p [ ˜uj] = gj
gk
ηjk(p) ˜uk = ˜ηjk(p) ˜uk (97)
leads to coefficients ˜ηjk(p) that are no longer symmetric,
but are rational functions of p. Note that the products of
the ηjk(p) and ˜ηjk(p) accross a cycleγ ∈ SkG do coincide.
VII. CONCLUSION
Belief propagation algorithms and their relationship to
Bethe-Kikuchi optimization problems were the corner-
stone motivation for this work. We produced the most
comprehensive picture of this vast subject that was in our
power, although loop series expansions [30, 29, 31, 32]
surely would have deserved more attention.
The rich structure owned by the complex(C•, δ, ζ) was
a surprise to uncover, in a field usually dominated by
statistics. We hope the length of this article will be seen
as an effort to motivate the unfriendly ways of M¨obius in-
version formulas and homological algebra, and demon-
strates their reach and expressivity in a localized the-
ory of statistical systems. This intimate relationship be-
tween combinatorics and algebraic topology (culminat-
ing in theorems 3 and 6) has not been described to our
knowledge, although both subjects are classical and well
covered individually.
From a practical perspective, we showed that belief
propagation algorithms are time-step 1 Euler integrators
of continuous-time diffusion equations on (C•, δ, ζ). We
propose to call these ODEsbelief diffusions, as ”diffusions”
suggest (i) a conservation equation of the form˙v = δΦ(v),
while ”belief” recalls (ii) that their purpose is to con-
verge on consistent pseudo-marginals, critical for Bethe-
Kikuchi information functionals. The GBP algorithm of-
fered a spatial compromise between precision and com-
plexity in the choice of the hypergraph K ⊆ P(Ω); our
diffusion equations offer a temporal compromise between
runtime and stability. They thus allow for a wider range
of initial conditions and applications.
Belief diffusions, in their isothermal and adiabatic
form, solve localized versions of the max-entropy (A) and
free energy principles (B and C). The associated Bethe-
Kikuchi functionals have a piecewise constant number of
critical points, whose discontinuities are located on the
projection of ¯S1 ⊆ Non the quotient space of param-
eters C0/δC1. A stationary point in N crossing ¯S1 will
become unstable and forced onto a different sheet of the
intersection with homology classes. This would appear as
a discontinuous jump in the convex polytope Γ0, happen-
ing anytime a consistent belief p ∈ Γ0 crosses the singular
space ¯Σ1.
ACKNOWLEDGEMENTS
This work has benefited from the support of the AI Chair
EXPEKCTATION (ANR-19-CHIA-0005-01) of the French
National Research Agency (ANR).
I am very grateful to Ya ¨el Fr´egier, Pierre Marquis and
Fr´ed´eric Koriche for their support in Lens, and to Daniel
Bennequin, Gr ´egoire Sergeant-Perthuis and Juan-Pablo
Vigneaux for fostering my interest in graphical models.
References
[1] E. T. Jaynes. Information Theory and Statistical Me-
chanics. Physical Review, 106(4):620–630, May 1957.
[2] C.-M. Marle. From Tools in Symplectic and Pois-
son Geometry to Souriau’s Theories of Statistical Me-
chanics and Thermodynamics. Entropy, 18, 07 2016.
[3] H. A. Bethe and W. L. Bragg. Statistical Theory
of Superlattices. Proceedings of the Royal Society of
London. Series A - Mathematical and Physical Sciences ,
150(871):552–575, 1935.
[4] R. Kikuchi. A Theory of Cooperative Phenomena.
Phys. Rev., 81:988–1003, Mar 1951.
[5] T. Morita. Cluster Variation Method of Cooperative
Phenomena and its Generalization I. Journal of the
Physical Society of Japan, 12(7):753–755, 1957.
[6] A. G. Schlijper. Convergence of the cluster-variation
method in the thermodynamic limit. Phys. Rev. B ,
27:6841–6848, Jun 1983.
[7] J. Yedidia, W. Freeman, and Y. Weiss. Constructing
Free Energy Approximations and Generalized Belief
Propagation Algorithms. IEEE Transactions on Infor-
mation Theory, 51(7):2282–2312, Jul 2005.
[8] O. Peltre. A Homological Approach to Belief Propa-
gation and Bethe Approximations. In F. Nielsen and
F. Barbaresco, editors, Geometric Science of Informa-
tion, pages 218–227, Cham, 2019. Springer Interna-
tional Publishing.
[9] O. Peltre. Message-Passing Algorithms and Homology .
Th`eses, Universit´e Paris Cit´e, Dec 2020.
[10] O. Peltre. Belief Propagation as Diffusion. In
F. Nielsen and F. Barbaresco, editors, Geometric Sci-
ence of Information , pages 547–556, Cham, 2021.
Springer International Publishing.
[11] S. Ikeda, T. Tanaka, and S.-i. Amari. Stochastic
Reasoning, Free Energy, and Information Geometry.
Neural Computation, 16(9):1779–1810, 09 2004.
[12] K. J. Friston, T. Parr, and B. de Vries. The Graphical
Brain: Belief Propagation and Active Inference. Net-
works Neuroscience, 1(4):381–414, 2017.
22
[13] T. Parr, D. Markovic, S. J. Kiebel, and K. J. Friston.
Neuronal Message Passing Using Mean-field, Bethe
and Marginal Approximations. Scientific Reports, 9,
2019.
[14] D. Rudrauf, D. Bennequin, I. Granic, G. Landini,
K. Friston, and K. Williford. A Mathematical Model
of Embodied Consciousness. Journal of Theoretical Bi-
ology, 428:106–131, 2017.
[15] J. S ´anchez-Ca˜nizares. The Free Energy Principle:
Good Science and Questionable Philosophy in a
Grand Unifying Theory. Entropy, 23(2), 2021.
[16] R. G. Gallager. Low-Density Parity-Check Codes. MIT
Press, 1963.
[17] J. Pearl. Reverend Bayes on Inference Engines: A
Distributed Hierachical Approach. In AAAI-82 Pro-
ceedings, 1982.
[18] Y. Weiss. Belief Propagation and Revision in Net-
works with Loops. Technical report, MIT, 1997.
[19] K. P . Murphy, Y. Weiss, and M. I. Jordan. Loopy Belief
Propagation for Approximate Inference: An Empiri-
cal Study. In UAI, 1999.
[20] F. Kschischang, B. Frey, and H.-A. Loeliger. Factor
Graphs and the Sum-Product Algorithm.IEEE Trans-
actions on Information Theory, 47(2):498–519, 2001.
[21] J. S. Yedidia, W. T. Freeman, and Y. Weiss. Bethe Free
Energy, Kikuchi Approximations, and Belief Prop-
agation Algorithms. Technical Report TR2001-16,
MERL - Mitsubishi Electric Research Laboratories,
Cambridge, MA 02139, May 2001.
[22] S. Sharifi Tehrani, C. Jego, B. Zhu, and W. J. Gross.
Stochastic Decoding of Linear Block Codes With
High-Density Parity-Check Matrices. IEEE Transac-
tions on Signal Processing, 56(11):5733–5739, 2008.
[23] C. Knoll and F. Pernkopf. On Loopy Belief Propa-
gation – Local Stability Analysis for Non-Vanishing
Fields. In Uncertainty in Artificial Intelligence, 2017.
[24] J. Sun, N.-N. Zheng, and H.-Y. Shum. Stereo Match-
ing Using Belief Propagation. IEEE Transactions on
Pattern Analysis and Machine Intelligence , 25(7):787–
800, 2003.
[25] W. Ping and A. Ihler. Belief Propagation in Condi-
tional RBMs for Structured Prediction. In Proceed-
ings of the 20th International Conference on Artificial In-
telligence and Statistics , volume 54 of Proceedings of
Machine Learning Research , pages 1141–1149. PMLR,
2017.
[26] M. M ´ezard. Mean-Field Message-Passing Equations
in the Hopfield Model and its Generalizations. Phys-
ical Review E, 95(2), Feb 2017.
[27] M. M ´ezard and A. Montanari. Information, Physics
and Computation. Oxford University Press, 2009.
[28] A. Pelizzola. Cluster Variation Method in Statistical
Physics and Probabilistic Graphical Models. ArXiv,
abs/cond-mat/0508216, 2005.
[29] J. M. Mooij and H. J. Kappen. Sufficient Con-
ditions for Convergence of the Sum–Product Al-
gorithm. IEEE Transactions on Information Theory ,
53(12):4422–4437, Dec 2007.
[30] Y. Watanabe and K. Fukumizu. Graph Zeta Func-
tion in the Bethe Free Energy and Loopy Belief Prop-
agation. In Y. Bengio, D. Schuurmans, J. Lafferty,
C. Williams, and A. Culotta, editors,Advances in Neu-
ral Information Processing Systems, volume 22. Curran
Associates, Inc., 2009.
[31] R. Mori. New Understanding of the Bethe Ap-
proximation and the Replica Method. ArXiv,
abs/1303.2168, 2013.
[32] E. B. Sudderth, M. J. Wainwright, and A. S. Willsky.
Loop Series and Bethe Variational Bounds in Attrac-
tive Graphical Models. In NIPS, 2007.
[33] J. M. Hammersley and P . E. Clifford. Markov Ran-
dom Fields on Finite Graphs and Lattices. Unpub-
lished manuscript, 1971.
[34] G.-C. Rota. On the Foundations of Combinato-
rial Theory - I. Theory of M ¨obius Functions. Z.
Warscheinlichkeitstheorie, 2:340–368, 1964.
[35] J.-L. Verdier and A. Grothendieck. V: Cohomologie
dans les Topos. SGA-4, 2, 1972.
[36] I. Moerdijk. Classifying Spaces and Classifying Topoi .
Springer, 1995.
[37] H. G. Kellerer. Maßtheoretische Marginalprobleme.
Mathematische Annalen, 153(3):168–198, Jun 1964.
[38] N. Vorob’ev. Consistent Families of Measures and
their Extensions. Theory of Probability and its Applica-
tions, 7(2):147–164, 1962.
[39] S. Abramsky and A. Brandenburger. The Sheaf-
theoretic Structure of Non-Locality and Contextual-
ity. New Journal of Physics, 13, 2011.
[40] F. Mat ´uˇs. Discrete Marginal Problem for Complex
Measures. Kybernetika, 24:36–46, 1988.
[41] D. H. Ackley, G. E. Hinton, and T. J. Sejnowski. A
Learning Algorithm for Boltzmann Machines. Cog-
nitive Science, 9(1):147–169, 1985.
23
[42] A. Bovier and B. M. Niederhauser. The spin-glass
phase-transition in the hopfield model with p-spin
interactions. Advances in Theoretical and Mathematical
Physics, 5:1001–1046, 2001.
[43] A. Barra, G. Genovese, P . Sollich, and D. Tantari.
Phase Diagram of Restricted Boltzmann Machines
and Generalized Hopfield Networks with arbitrary
priors. Physical Review E, 97(2):022310, 2018.
[44] A. Javanmard and A. Montanari. State Evolution for
General Approximate Message Passing Algorithms,
with Applications to Spatial Coupling. Information
and Inference: A Journal of the IMA, 2(2):115–144, 2013.
[45] A. Klipfel, Z. Bouraoui, O. Peltre, Y. Fregier, N. Har-
rati, and A. Sayede. Equivariant Message Passing
Neural Network for Crystal Material Discovery. Pro-
ceedings of the AAAI Conference on Artificial Intelli-
gence, 37(12):14304–14311, Jun. 2023.
[46] Y. Weiss and W. T. Freeman. Correctness of Belief
Propagation in Gaussian Graphical Models of Ar-
bitrary Topology. Neural Computation , 13(10):2173–
2200, 10 2001.
[47] E. Gouillart, F. Krzakala, M. Mezard, and L. Zde-
borov´a. Belief-Propagation Reconstruction for Dis-
crete Tomography. Inverse Problems , 29(3):035003,
2013.
[48] T. Sejnowski. Higher-order Boltzmann machines. In
Neural Networks for Computing , volume 151 of Amer-
ican Institute of Physics Conference Series , pages 398–
403, August 1987.
[49] C. W. J. Goh, C. Bodnar, and P . Li`o. Simplicial Atten-
tion Networks, 2022.
[50] M. Hajij, G. Zamzmi, T. Papamarkou, N. Miolane,
A. Guzm ´an-S´aenz, K. N. Ramamurthy, T. Birdal,
T. K. Dey, S. Mukherjee, S. N. Samaga, N. Livesay,
R. Walters, P . Rosen, and M. T. Schaub. Topological
Deep Learning: Going Beyond Graph Data, 2023.
[51] D. Bennequin, O. Peltre, G. Sergeant-Perthuis, and J.-
P . Vigneaux. Extrafine Sheaves and Interaction De-
compositions. (preprint). Under revision for Alge-
braic and Geometric Topology., 2023.
[52] T. Leinster. The Euler Characteristic of a Category.
Documenta Mathematica, 13:21–49, 2008.
[53] H. Poincar ´e. Th´ eorie du Potentiel Newtonien, Cours de
la Sorbonne 1894–1895. Carr ´e et Naud, Paris, France,
1899.
[54] R. Thom. Les Singularit ´es des Applications
Diff´erentiables. Annales de l’institut Fourier , 6:43–87,
1956.
[55] J. Boardman et al. Singularities of Differentiable
Maps. Publications Math´ ematiques de l’IH´ES, 33:21–57,
1967.
A. GAUSS-GREENE FORMULAS
Proof of theorem 3. Let us first show (i) ⇒ (ii), stating that
∑a∈K δφa = 0 vanishes for all φ ∈ C1. Recall that the
canonical inclusions REc ⊂ REb ⊂ REΩ are implicit in:
∑
b∈K
δφb = ∑
a⊃b
φa→b − ∑
c⊂b
φb→c (98)
Both sums run over the strict 1-chains of N1K, therefore
(98) vanishes as a K-local observable in REΩ and δC1 is
contained in the kernel of the total energy mapC0 → REΩ .
Showing (ii) ⇒ (i) is more involved, as it relies on the
interaction decomposition theorem (see [37, 40, 51] and
[9, section 2.3.2]) which requires K to be ∩-closed. This
theorem states that one may choose a consistent family of
interaction subspaces Za ⊆ REa such that for all a ∈ K:
REa =
M
b⊆a
Zb (99)
For every a ⊇ b ∈ K, let us denote by Za→b the projection
of REa onto Zb cancelling on every Zc for c ̸= b.
Given h ∈ C0 such that ∑a ha = 0, define φ ∈ C1 by
letting φa→b = −Za→b(ha) for all a ⊃ b in K. Then δφ is
given by:
δφb = − ∑
a⊇b
Za→b(ha) +∑
c⊆b
Zb→c(hb) (100)
The second sum over c ⊆ b reconstructs hb ∈ REb . To see
that the first sum over a ⊇ b vanishes, one should notice
that REb ∩ REb′ = REb∩b′ is a strict subspace of REb when-
ever b′ does not contain b. This implies that its projection
onto Zb vanishes, and that the projection of ∑a∈K ha onto
Zb is given by the first term of (100). Therefore δφ = h by
assumption, and δC1 coincides with the space of zero-sum
potentials.
Proof of theorem 6. Denote by Ej the set of chains ⃗a ∈
Nr+1K such that ⃗a(j) lies in the hypercone Kb0...br , for all
0 ≤ j ≤ r + 1. From definition of δ, the l.h.s. of (44) then
rewrites Z
Kb0...br
δφ =
r+1
∑
j=0
∑
⃗a∈Ej
(−1)j φ⃗a. (101)
Let ⃗c = ⃗a(j) ∈ Kb0...br for j > 0. Let us show that ⃗a also
belongs to eitherEj−1 or Ej+1. By construction of Ej, agree-
ing to let cj+1 = bj+1 = ∅ and b0 = Ω, we have:
(i) a i = ci ∈ Kbi
bi+1
for i < j,
(ii) a j−1 ⊃ aj ⊃ aj+1,
24
(iii) a k+1 = ck ∈ Kbk
bk+1
for k ≥ j.
If aj ⊆ bj, then a j ⊃ aj+1 ̸⊆ bj+1 implies aj ∈ K
bj
bj+1
.
Then⃗a(j−1) ∈ Kb0...br , as (iii) is satisfied for k ≥ j − 1.
If aj ̸⊆ bj, then b j−1 ⊇ aj−1 ⊃ aj implies aj ∈ K
bj−1
bj
.
Then⃗a(j+1) ∈ Kb0...br , as (i) is satisfied for i ≤ j.
We just proved Ej ⊆ Ej−1 ∪ Ej+1 for all 0 < j ≤ r + 1,
and the reader may easily check that (i) and (iii) do also
imply that Ej ∩ Ek = ∅ for |k − j| > 1. There only remains
to determine which chains ⃗a ∈ E0 are not killed by the
alternated sum of (101), i.e. do not lie in E1.
Consider⃗a ∈ E0, so that ⃗a(0) = a1a2 . . . ar+1 ∈ Kb0...br .
Then ⃗a(1) = a0a2 . . . ar+1 ∈ Kb0...br if and only if a 0 ⊆ b0.
It follows that ⃗a ∈ E0 ∖ E1 if and only if a 0 ̸⊆ b0 and
aj+1 ∈ K
bj
bj+1
for all 0 ≤ j ≤ r, which is equivalent to
⃗a ∈ dKb0...br by definition 10.
Proof of theorem 7. Denote by ˜K = K ∪ {Ω} and by ˜C• =
C•( ˜K, RE) the hypergraph and complex obtained by ap-
pending the global region Ω. The complex C• then nat-
urally embeds into ˜C• as a linear subspace, defined by
iΩ = 0 when Ω ̸∈ K. The first equality in (45),
ˇδΦa1...ar =
Z
dKa1...ar
ϕ, (102)
simply consists in a Gauss formula (44) on Ka1...ar for
ˇδΦ = ζ(δµΦ) =ζ(δϕ). Also recall that dKa1...ar = ˜KΩa1...ar
from definition 10.
First assume that K = ˜K contains Ω. Then (46) follows
from ζ = µ−1 as in this case cΩ = 1 and ca = 0 for a ̸= Ω:
ζ(δϕ)a1...ar = ζ(ϕ)Ωa1...ar = ΦΩa1...ar . (103)
Assume now that Ω ̸∈ K. The Gauss formula (102) above
then consists in a truncated M¨obius inversion instead (i.e.
a Bethe-Kikuchi approximation) which we may write
ζ(δϕ)a1...ar = ˜ζ(ϕ)Ωa1...ar = ˜ζ(µΦ)Ωa1...ar (104)
where ˜ζ denotes the zeta automorphism of ˜C•. This is not
the inverse of the M ¨obius automorphism µ of C•, and we
write ˜µ = ˜ζ−1.
By Φ ∈ C• ⊂ ˜C•, remember that the evaluation iΩ of
the first region on Ω cancels Φ. Thus ˜ζ( ˜µΦ)Ωa1...ar = 0 so
that
˜ζ(µΦ)Ωa1...ar = ˜ζ
 
(µ − ˜µ)Φ

Ωa1...ar
. (105)
Let ˜ϕ = ˜µΦ. The M ¨obius transform is local in the sense
that ( ˜µΦ)a0...ar only contains terms Φb0...br with b0 ⊆ a0.
Therefore ˜ϕa0...ar = ϕa0...ar whenever a0 ̸= Ω. From its
definition (33), when a0 = Ω we get:
˜ϕΩa1...ar = ∑
br⊆ar
µar→br · · ·∑
b1⊆a1
b1̸⊆b2
µa1→b1
∑
b0̸⊆b1
µΩ→b0 Φ(b0...br)∩.
(106)
Let us recall that cb0 = − ˜µΩ→b0 (see [34] or check that the
inclusion-exclusion principle is indeed solved by ˜ζ ˜µ = 1
on ˜C0). We now claim that ϕ − ˜ϕ may be expressed as ˜µ ˇΦ,
where ˇΦΩa1...ar is given by (46) for all a 1 . . . ar ∈ Nr−1K,
and ˇΦa0...ar = 0 for all a0 . . . ar ∈ NrK.
By locality of ˜µ, one easily checks that ( ˜µ ˇΦ)a0...ar = 0
when a0 ̸= Ω, as ˇΦ vanishes on NrK by construction. To
see that (− ˜µ ˇΦ)Ωa1...ar is given by (106), first write from
definition of the M¨obius transform:
( ˜µ ˇΦ)Ωa1...ar = ∑
br⊆ar
µar→br · · ·∑
b1⊆a1
b1̸⊆b2
µa1→b1
µΩ→Ω ˇΦ(Ωb1...br)∩,
(107)
then expand ˇΦ(Ωb1...br)∩ as a sum over b 0 ̸⊆ b1 of flux
cumulants c b0
ˇΦ(b0...br)∩ = −µΩ→b0 Φ(b0...br)∩, by substi-
tuting (46) defining ˇΦ. Writing (Ωb1 . . . br)∩ = c0 . . . cr
where c 0 = Ω and c j = bj ∩ cj−1, associativity of the
intersection indeed ensures that Φ(b0...br)∩ coincides with
Φb0∩(b0∩c1)...(b0∩cr).
Having showed that ϕ − ˜ϕ = ˜µ ˇΦ, or equivalently that
˜ζ(ϕ − ˜ϕ) = ˇΦ, we may now conclude the proof using
(104) to get:
ˇδΦa1...ar = ˜ζ(ϕ − ˜ϕ)Ωa1...ar = ˇΦΩa1...ar . (108)
B. CONSISTENT MANIFOLDS
Letting R• ⊆ C• denote the subcomplex spanned by con-
stant local observables, note that the Gibbs state map ρβ
is invariant under the addition of energy constants, and
factorizes through a diffeomorphism C0/R0 → ∆0. It fol-
lows that Mβ ≃ Nβ + R0 coincides with the orbit of N β
under the addition of local constants in R0.
However remark that µ(R) ⊆ R0 acts on N β, as lo-
cal hamiltonians H = ζ(h) are then shifted by a constant
term which rescales all the Gibbs densities e −H to a com-
mon mass. One may decompose R0 as µ(R) ⊕ δR1, as
∑
a⊇b
µa→b = ∑
b⊇∅
cb = 1 (109)
follows from the existence of a terminal element (assumed
here to be the empty set ∅) and corollary 5. The fact that
µ(1) does not sum to zero implies that it generates the
only non-trivial homology class of R0/δR1 by theorem 3.
Hence, Mβ ≃ Nβ × δR1.
The following lemma provides an explicit retraction of
Mβ onto N β.
Lemma 27. Let Fβ : C0 → R0 denote the direct sum ⊕Fβ
a of
local free energy maps (definition 5). Then a natural retraction
rβ : Mβ → Nβ is defined by letting for all v ∈ Mβ:
rβ(v) =v − µ
 
Fβ(ζv)

. (110)
For all v ∈ Mβ, one has v ∈ Nβ if and only if Fβ(ζv) =0.
25
Proof. The result is easily proved by observing that both
ζ and µ are equivariant under the action of R0, and that
Fβ(V)a computes −ln Za, i.e. free energies vanish if and
only if the Gibbs densities e−βVa are normalised.
Lemma 28. For all β > 0, N β is the image of N1 under the
scaling v 7→ β−1v.
Proof. This directly follows from definition 12, as ρβ(v) =
ρ(βv).
Extension to zero or negative inverse temperatures
would describe infinitesimal and reversed interactions re-
spectively. Although not physical, negative temperatures
describe a natural symmetry of∆0 which is diffeomorphic
to the quotient Lie group C0/R0 under ρ, energy scalings
β ∈ R acting as exponents in ∆0.
Proposition 29. Let u = r1(0) ∈ N1 denote the consistent
potentials having uniform Gibbs densities. Then v ∈ TuN1 if
and only if V = ζv satisfies:
Vb(xb) =Eρ(0)[Va|xb] =|Eb|
|Ea| ∑
xa|b=xb
Va(xa) (111)
for all a ⊃ b in K and all xb ∈ Eb.
Equation (111) describes consistency for systems hav-
ing infinitesimal interactions with respect to the energy
scale (high temperature limit). In the non-interacting case,
a canonical choice ofinteraction subspaces Za ⊆ REa , where
Za ⊆

∑
b⊆a
REb
⊥
for ηρ(0) (112)
further allows to describe TuN1 as the set of those v ∈ C0
such that va ∈ Za for all a ∈ K [9, section 5.2.1]. The
metric ηρ(0) is induced by uniform beliefs (see section VI),
so that conditional expectations of (111) are orthogonal
projections for ηρ(0). Note that such an orthogonal de-
composition, compatible with the metric ηp = ηρ(0), is
only possible because all variables are independent in the
high-temperature limit.
C. FAITHFULNESS PROOFS
The faithfulness properties of a diffusion fluxΦ : C0 → C1
(definition 13) relate the stationary potentials under dif-
fusion, for which δΦ(v) = 0, with consistent potentials
which satisfy e −ζv ∈ Ker(d). The latter is equivalent to
D(ζv) = 0 (where D : C0 → C1 is the non-linear free
energy gradient, definition 14).
Although proving that any consistent potential is sta-
tionary is straightforward when Φ is built from D ◦ζ,
proving the converse is more difficult due to the non-
linearity of D. Below we prove that ΦGBP (55) is indeed
faithful, and that ΦBK (56) is locally faithful (i.e. any sta-
tionary potential sufficiently close to the consistent man-
ifold is consistent), although global faithfulness of ΦBK
should be conjectured.
Proposition 30. The GBP diffusion flux ΦGBP = −D ◦ζ is
faithful. Equivalently for all V = ζv ∈ C0 we have:
δ(DV) =0 ⇔ D V = 0. (113)
Proof. By d = δ∗, first recall that we have for all ϕ ∈ C1
and q ∈ C∗
0 the duality (integration by parts) formula:
⟨q|δϕ⟩ = ⟨dq|ϕ⟩. (114)
Assume now that ϕ = DV lies in Ker(δ). Then ⟨dq|ϕ⟩ = 0
for all q ∈ C∗
0 by (114). Choosing local (unnormalized)
Gibbs densities for q = e−V ∈ C∗
0 , let us show that
⟨dq|DV⟩ = 0 implies DV = 0 by a monotonicity argu-
ment.
Expanding the duality bracket of C∗
1 × C1 yields
⟨dq|DV⟩ = ∑
a→b
∑
xb
dqa→b(xb) · DVa→b(xb), (115)
and we claim that the summands of (115) identically van-
ish. Indeed we have from definition
dqa→b(xb) =e−Vb(xb) − ∑
xa|b=xb
e−Va(xa), (116)
DVa→b(xb) =Vb(xb) −

− ln ∑
xa|b=xb
e−Va(xa)

, (117)
and y 7→ −ln y is strictly decreasing. The signs of
dqa→b(xb) and DVa→b(xb) therefore disagree for every
a → b in N1K and every xb ∈ Eb, so that (115) is a vanish-
ing sum of non-positive terms, i.e. a sum of zeroes.
Noticing that dqa→b(xb) =0 is moreover equivalent to
DVa→b(xb) =0, we conclude that DV = dq = 0, i.e. that
Gibbs densities are consistent whenever δ(DV) =0.
Proposition 31. The Bethe-Kikuchi diffusion flux ΦBK =
−µ ◦ D ◦ζ is locally faithful: there exists an open neighbour-
hood V of N such that for all v ∈ V ⊆C0,
δΦBK (v) =0 ⇔ v ∈ N. (118)
Proof. Given v ∈ Nand w ∈ TvC0 ≃ C0, we denote
by p = ρ(ζv) ∈ Γ0 the consistent beliefs defined by v,
and by T vXBK : T vC0 → T0C0 the differential of XBK at
v. Let us show that the linearized stationarity condition
TvXBK (w) =0 implies w ∈ TvN.
Letting W = ζw ∈ ζ(TvN) ⊆ C0, by linearizing
the evolution of local hamiltonians (59), we claim that
TvXBK (w) =0 if and only if for all b ∈ K and all xb ∈ Eb,
Wb(xb) = ∑
a∈K
ca Epa [Wa|xb|a∩b]. (119)
The reader may check that conditional free energies of
(59) linearize to conditional expectations with respect to
p ∈ Γ0 (see [9, prop. 4.14] otherwise).
26
In order to factorize the sum over regions inside a sin-
gle conditional expectation, we choose a global measure
pΩ ∈ REΩ∗ such that pa is the pushforward of pΩ for all
a ∈ K. This is always possible by consistency of p ∈ Γ0
and acyclicity of (C∗•, d) [9, thm. 2.17]. Altough pΩ can-
not always be chosen non-negative, with a slight abuse of
notation let us write
EpΩ [WΩ|xa] = ∑
xΩ|a=xa
pΩ(xΩ)WΩ(xΩ)
pa(xa) . (120)
so that Epa [Wa|xa∩b] = EpΩ [Wa|xa∩b] for all a, b ∈ K, all
Wa ∈ REa ⊆ REΩ , and all xa∩b ∈ Ea∩b. Because Wa does
not depend on the variables outside a we also have
EpΩ [Wa|xb|a∩b] =EpΩ [Wa|xb] (121)
for all xb ∈ Eb, where REa∩b is identified with its image in
REb . This lets us to rewrite the sationarity condition (119)
as
Wb(xb) =EpΩ

∑
a∈K
caWa
xb

= EpΩ [WΩ|xb], (122)
which implies compatibility of W ∈ C0 under the condi-
tional expectation functor, i.e. Epb [Wb|xc] = Wc(xc) for
all c ⊆ b and xc ∈ Ec. The constraint that local hamil-
tonians are conditional expectations of a common global
energy WΩ = ∑a caWa = ∑a wa precisely defines the tan-
gent manifold ζ(TvN) =Ker(TζvD) (see [9, section 5.2.1]
or differentiate D). Therefore w ∈ TvN.
We showed that the stationary fiber Ker (TvXBK ) co-
incides with the consistent tangent fiber T vN, assuming
v ∈ N. The stationary manifold contains N by consis-
tency of ΦBK but we do not know whether it is connected.
The vector field XBK = δΦBK being analytic, one may still
prove that connected components of the stationary mani-
fold are separated to construct the desired neighbourhood
V ⊇ N.
D. CORRESPONDENCE PROOFS
Proof of theorem A. Given U ∈R and h ∈ C0, let p ∈ Γ0
be a solution to problem A, with ⟨p, h⟩ = U. Defining
local energies ¯V = ζ ¯v ∈ C0 by ¯Vb = −ln pb for all b,
the consistency of p implies ¯v ∈ M1 as p = ρ1( ¯V) =
ρ1(ζ ¯v). The same argument holds for any other potential
¯v′ ∈ ¯v + RK, equal to ¯v up to additive energy constants.
This follows from the invariance of Gibbs states under ad-
ditive constants, i.e. ρ1(ζ ¯v′) =ρ1(ζ ¯v) is consistent for all
¯v′ ∈ ¯v + RK, and ¯v′ ∈ M1.
Let us now show that the constraints ⟨p, h⟩ = U and
dp = 0 also imply ¯v ∈ [βh] for some β ∈ R. By du-
ality, recalling that δ = d∗, we know that ⟨q, u⟩ = 0 for
all q ∈ Ker(d) if and only if u ∈ Im(δ). The consis-
tency constraint hence yields Lagrange multipliers of the
form δφ ∈ δC1. The mean energy constraint ⟨p, h⟩ = U,
as usual, yields the inverse temperature β as a Lagrange
multiplier for terms of the form βh ∈ Rh. The normali-
sation constraints ⟨pa, 1a⟩ = 1 for all a ∈ K finally yield
additive constants λ ∈ RK.
A classical computation yields the differential of local
entropies as Tpb Sb = ⟨ ·, −ln(pb)⟩ mod R. They coin-
cide with ⟨ ·, ¯V′
b⟩ for all ¯V′
b ∈ −ln(pb) +R on the tangent
fibers of ∆b = Prob(Eb), due to the tangent normalisation
constraint. Therefore p is critical if and only if there exists
β ∈ R, φ ∈ C1 and λ ∈ RK such that:
ˇS∗(p)a = ca( ¯Va − 1a) =βha + δφa + λa1a. (123)
By lemma 19 we know that c ¯V and ¯v = µ ¯V are homol-
ogous: ¯v = c ¯V − δΨ(c ¯V). Lemma 19 therefore implies
that (123) is equivalent to ¯v ∈ βh + δC1 + λ with λ ∈ RK.
Theorem 3, applied to the subcomplex of constant local
observables R• ⊆ C•, implies that R0 decomposes as
R ⊕ δR1. Up to a boundary term of δR1 ⊆ δC1, the lo-
cal constants λ ∈ RK = R0 can therefore be absorbed
into a single constant λ′ ∈ R so that ¯v ∈ βh + δC1 + R.
Enforcing the constraint ⟨p, ¯v′⟩ = β⟨p, h⟩ = β U, on the
equivalent potentials ¯v′ ∈ ¯v + R, we may finally get
¯v′ ∈ βh + δC1 by ⟨p, δC1⟩ = 0. Each critical p ∈ Γ0
hence defines a unique potential ¯v′ ∈ [βh] ∩ M1 satisfy-
ing p = ρ1(ζ ¯v′) and ⟨p, ¯v′⟩ = β U.
Proof of theorem B. Very similar to that of A above the pre-
cise proof can be found in [9, thm 4.22].
Proof of theorem C. Given H = ζh ∈ C0 and β > 0, let
V = ζv ∈ C0 be a solution to problem C. The energy con-
straint on v ∈ h + δC1 implies ˇFβ
∗ (V)|Im(ζδ) = 0 with the
differential ˇFβ
∗ : C0 → C∗
0 given by:
ˇFβ
∗ (V)a = ca ρβ(Va). (124)
For any subspace B ⊆ C0, let us write B⊥ ⊆ C∗
0 for the
orthogonal dual (or annihilator) of B. Letting p = ρβ(V)
criticality is then equivalent to Fβ
∗ (V) = cp ∈ Im(ζδ)⊥.
Recall that d = δ∗ by definition and denote by ζ∗ : q 7→
q ◦ ζ the adjoint of ζ:
cp ∈ Im(ζδ)⊥ ⇔ ζ∗(cp) ∈ Im(δ)⊥
⇔ ζ∗(cp) ∈ Ker(d).
(125)
Therefore V is critical for ˇFβ
|Im(ζδ) if and only if ζ∗(cp) =
ζ∗(c ρβ(V)) is consistent.
Assume p ∈ Ker(d) is consistent. Then by the dual
form of lemma 19 involving (δΨ)∗ = Ψ∗d which vanishes
on Ker (d), we have cp = µ∗p and ζ∗(cp) = p is con-
sistent as well. This shows that any consistent potential
v ∈ [h] ∩ Mβ yields a critical point V = ζv of the Bethe-
Kikuchi energy ˇFβ(V).
27
Reciprocally assume q = ζ∗(cp) ∈ Ker(d), then
µ∗(q) = cq by lemma 19 and cq = cp, which means that
pb and qb coincide on any b ∈ K such that cb ̸= 0. Let us
define energies W = ζw ∈ C0 by:
Wb = −1
β ln(qb) +Fβ
b (Vb). (126)
Observing that q = ρβ(W) and Fβ
b (Wb) =Fβ
b (Vb) for all b,
one sees that cp = cq implies cV = cW. By lemma 19 we
get µV ∈ µW + δC1 so that the potentials w = µW satisfy
the global energy constraint [w] = [v] = [h]. By the as-
sumption q ∈ Ker(d) this shows that w ∈ [h] ∩ Mβ. The
relation cV = cW implies v − w = µ(V − W) ∈ Ker(cζ),
so that v ∈ [h] ∩ Mβ
+ is weakly consistent by definition of
Mβ
+.
The retraction rβ : Mβ
+ → Mβ is described more suc-
cinctly via its conjugate Rβ = ζ ◦ rβ ◦ µ acting on local
energies V = ζv ∈ C0:
Rβ(V)b = −1
β ln ∑
a⊇b
ca πa→b
∗
 
ρβ
a (Va)

− Fβ
b (Vb), (127)
which amounts to applying the linear projection ζ∗c on
beliefs before choosing energies as (126).
28