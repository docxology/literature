Fault-tolerant Control of Robot Manipulators with Sensory Faults using
Unbiased Active Inference
Mohamed Baioumy1∗, Corrado Pezzato2∗, Riccardo Ferrari2, Carlos Herna´ndez Corbato2 and Nick Hawes1
Abstract—This work presents a novel fault-tolerant control camera images. The detection thresholds were selected to
scheme based on active inference. Specifically, a new formu- minimize the probability of false or missed alarms on the
lation of active inference which, unlike previous solutions,
basis of simulation and experimental data. However, the
provides unbiased state estimation and simplifies the definition
visual subsystem is assumed faultless.
of probabilistically robust thresholds for fault-tolerant control
ofroboticsystemsusingthefree-energy.Theproposedsolution
FDIthroughstaticthresholdscanbeeffective,butstochas-
makes use of the sensory prediction errors in the free-energy
forthegenerationofresidualsandthresholdsforfaultdetection tic decision theory has been shown to outperform these
andisolationofsensoryfaults,anditdoesnotrequireadditional methods. The actual distributions of residuals can be es-
controllers for fault recovery. Results validating the benefits timated such that a user can define thresholds based on
in a simulated 2-DOF manipulator are presented, and future
their acceptable probability of false positives [10]–[13]. The
directions to improve the current fault recovery approach are
work in [14] showed fault-tolerant steering control of an
discussed.
Index Terms—Fault-tolerant control, fault recovery, active agricultural vehicle for bailing, detecting sensory faults and
inference, free-energy principle, robotics, robot manipulator. artefacts in images through statistical learning. The sensors
configuration for control was then decided at run-time.
I. INTRODUCTION
Faulttolerant(FT)controlisofvitalimportanceformany Generally speaking, model-based fault tolerant control
applications such robots working in production lines [1]. In schemes rely on additional supervision blocks that increase
order to guarantee high standards of reliability and security, systemcomplexity.FDIandfaultrecoverypresenttwomain
the area of FT control of robot manipulators increasingly challenges: a) The definition of robust yet sensitive pairs of
gathered importance in recent years [2]. Many approaches residualsandthresholds;b)Thedesignofspecificadditional
have been developed for faults in actuators and sensors [3]– supervisory systems to accommodate large faults.
[7]. Model based fault tolerant techniques are amongst the
The work presented in this paper extends the active infer-
most advanced approaches to tackle the problem of fault
ence controller (AIC) recently developed by the authors in
detection and isolation (FDI) for dynamical systems [8].
[15], [16]. Active inference relies on approximate Bayesian
These methods rely on monitoring system outputs using
inference [17], [18] for prediction errors minimization, and
mathematical models to generate residual signals which are
it allows state estimation and control using a single cost
compared to a threshold. Faults are detected if the threshold
function. This scheme showed remarkable capabilities while
is exceeded, while the actions for fault recovery are usually
dealingwithmissingsensoryinformationorlargeunmodeled
performed through controller re-design or by switching to a
dynamics, see [15], [19] respectively. The authors in [20]
different controller [9].
initially presented a fault tolerant control scheme with an
RegardingFTcontrolforrobotmanipulators,[6]performs
AIC which showed great promise. However, this presented
fault diagnosis in image-based visual servoing. The residual
a few fundamental limitations which will be thoroughly
signal is defined as the root mean squared estimation error
discussed in Sec. II-B. Most importantly, FDI in [20] can
(RMSE) of a Kalman filter, which predicts the values of
be affected by false-positives when target state changes,
a number of features in the camera image. The residual is
and it relies on a static threshold which might be over-
compared against a user-defined static threshold and fault
conservative. In this work, we: improve the state estimation
isolation is achieved via a decision table. The controller
ofastandardAIC;developanunbiasedAIC(u-AIC);reduce
reconfigurationisnotdesignedinthepaper,anditwouldre-
the probability of false-positives and allow to easily define
quireanadditionalelementontopoftheFDIscheme.Visual
a probabilistically robust threshold for fault detection.
information from a camera can also be used to compensate
forlackofobservabilityincaseofsensoryfaults.In[7],three
The paper is organised as follow: Sec. II presents the
different second-order sliding mode observers are used for
background on active inference for fault-tolerant control
generating residuals using independent measurements from
highlighting the limitations of past work. Sec. III presents a
new formulation of the AIC with unbiased state estimation,
*Theseauthorscontributedequallytothiswork.
1 AuthorsarewiththeOxfordRoboticsInstitute,UniversityofOxford. whileSec.IVexplainshowfaulttolerantcontrolisachieved
Forcorrespondence{mohamed,nickh}@robots.ox.ac.uk with this new formulation. Results for a simulated 2-DOF
2 Authors are with Delft University of Technology. For correspondace
robot arm are presented in Sec. V while Sec. VI reports a
{c.pezzato,c.h.corbato,r.ferrari}@tudelft.nl
ThisworkwassupportedbyAholdDelhaize summary and future challenges.
1202
rpA
5
]OR.sc[
1v71810.4012:viXra
II. PRELIMINARIES In order to characterize the free-energy and compute
it, one has to define two generative models, one for the
Thissectionpresentsthebackgroundknowledgeonactive
state dynamics, and one for the observations. The latter
inference for robot control [15], [20] required to understand
is modeled according to [18] as y = g(µ) + z, where
and justify the need for an unbiased AIC.
g(µ) = [g , g , g ] : Rd (cid:55)→ Rd represents the non-linear
q q˙ v
A. Active inference controller (standard AIC) mappingbetweensensorydataandstatesoftheenvironment,
The AIC in [15], [20] is defined for torque control in and z is Gaussian noise z ∼(0,Σ y ). The generative model
jointspaceofagenericrobotmanipulator(Fig.1).Therobot of the state dynamics is defined as [18]:
arm is equipped with encoders and velocity sensors with
dµ
relativesensoryreadingsy , y .Inaddition,theend-effector =µ(cid:48) =f(µ)+w (4)
q q˙ dt
Cartesian position y is made available through a camera.
v where f(µ) : Rn (cid:55)→ Rn is a generative function dependant
The system’s output is represented by y = [y , y , y ] ∈
q q˙ v
Rd. The proprioceptive sensors and the camera are affected on the belief about the states µ and w is Gaussian noise
w ∼(0,Σ ).Asinpreviouswork[16],wedefinef(·)such
byzeromeanGaussiannoiseη =[η ,η ,η ].Thecamerais µ
q q˙ v
that the robot will be steered to a desired joint configuration
affectedbybarreldistortion.TheAICcanbeusedtocontrol
µ followingthedynamicsofafirstorderlinearsystemwith
the robot arm to a desired configuration µ , providing the d
d
control input u ∈ Rm as torques to the single joints. To time constant τ.
this end, the control input is computed on the basis of the f(µ)=(µ −µ)τ−1 (5)
d
so-called free-energy and the generalised motions µ˜ [20].
From equation (5) we can see that the desired state is
encoded in the prior. The time constant τ influences the
generative model of the state dynamics f(·). As explained
Camera
in [16], the AIC has two extremes depending on the value
AIC of τ−1. If τ−1 → 0, the AIC only performs filtering and
State Control no control. On the other hand, if τ−1 → ∞ the AIC is
Robot
Est. Act. equivalent to a PID controller [16], [25]. For any value
in between, there is a compromise between estimation and
control. The estimation and control are thus ‘coupled’ and
Fig.1. GeneralAICcontrolschemeforjointspacetorquecontrol.
state-estimation with the standard AIC results in a bias
towards the desired target, see (7). If all distributions in
Thefree-energyprinciplereliesonBayesianinference[21]
equation (2) are assumed Gaussian, the expression for free-
for state estimation. The goal is to find the posterior over
energy simplifies to (see [15] for complete derivations):
states given observations, p(x|y ,y ,y ). This computation
v q q˙
isingeneralintractableusingBayes’ruleandinpracticethe F = 1(cid:88)(cid:0) ε(cid:62)P ε −ln|P | (cid:1) +C, (6)
true posterior distribution is approximated with a variational 2 i i i i
i
distributionQ(x)[22].Themostprobablestateiscomputed
where i∈ {y , y , y , µ, µ(cid:48)}, and P defines a precision
by minimizing the Kullback-Leibler divergence (D ) be- q q˙ v i
KL
(or inverse covariance) matrix. Note that we set τ = 1
tween p(x|y) and Q(x) [18]:
as in [15], [26]. The terms ε with i ∈ {y , y , y }
(cid:90) Q(x) i q q˙ v
D (Q(x)||p(x|y))= Q(x)ln dx are the Sensory Prediction Errors (SPE), representing the
KL p(x|y) differencebetweenobservedsensoryinputandexpectedone.
=F +lnp(y) (1) Ingeneral,theSPEforasensorsaredefinedas(y −g (µ)).
s s
The model prediction errors are instead defined considering
where F represents the free-energy. By minimizing F,
the desired state dynamics as ε =(µ(cid:48)−f(µ)) and ε =
Q(x)approachesthetrueposteriorp(x|y).Theprobabilistic µ µ(cid:48)
(µ(cid:48)(cid:48)−∂f(µ)/∂µµ(cid:48)).Inparticular,fortherobotarmusedinthis
model p(x,y ,y ,y ) is factorized as:
v q q˙ paper,ε =(y −µ),ε =(y −µ(cid:48)),ε =(y −g (µ)),
yq q yq˙ q˙ v v v
p(x,y v ,y q ,y q˙ )=p(y v |x)p(y q |x)p(y q˙ |x)p(x) (2) and ε µ =(µ(cid:48)+µ−µ d ), ε µ(cid:48) =(µ(cid:48)(cid:48)+µ(cid:48)). For more details
(cid:124) (cid:123)(cid:122) (cid:125)(cid:124)(cid:123)(cid:122)(cid:125) on the derivation of equation (6), refer to [15], [16], [18].
observationmodel prior
Toachievestate-estimationagradientdescentonthefree-
If Q(x) is a Gaussian with mean µ and the Laplace energy is used. The variable µ˜ is updated as:
approximation is utilized [23], then F reduces to
∂F
µ˜˙ =Dµ˜−κ , (7)
F =−lnp(µ,y
v
,y
q
,y
q˙
)+C, (3) µ∂µ˜
where C is a constant. Higher order derivatives of the state whereκ isthegradientdescentstepsize,andDisashifting
µ
x ∈ Rn are combined in the term µ˜ (i.e. µ˜ = [µ,µ(cid:48),µ(cid:48)(cid:48)]). operator with ones on the upper diagonal. This form of
This is referred to as generalized motions [18], [24]. The gradient descent is needed due to using generalized motions
number of generalised motions considered will affect the as mentioned earlier [17]. The control actions, are also
update laws for state estimation and control. computed through gradient descent; however, the expression
for F does not include any actions explicitly. The chain sensory prediction errors and we define an unbiased AIC
rule is then used, assuming an implicit dependency between where the SPE are independent from the input, providing
actions and sensory input. more accurate state estimation. With the u-AIC is also
possible to use the sensory prediction error directly for fault
∂F ∂F ∂y
u˙ =−κ u∂u =−κ u∂y ∂u , (8) detectionusingaprobabilisticallyrobustthresholdinsteadof
a static one as in [20].
where κ is the gradient descent’s step size. The term ∂y is
u ∂u III. UNBIASEDACTIVEINFERENCE
often approximated as linear, similarly to [15], [26].
To tackle the problems discussed in the previous section,
B. Limitations of fault-tolerant control with standard AIC the unbiased AIC is developed (u-AIC).
TheAICwasusedin[20]forfaulttolerantcontrol.Inthis
A. Derivation of the u-AIC
subsectionweaimathighlightingthemainlimitationsofthe
AIC, which are addressed in Sec. III through the proposed Consider a probabilistic model with explicit actions
unbiasedactiveinferencescheme.Themainideain[20]was p(x,u,y v ,y q ,y q˙ ), where unlike the AIC, x=[q q˙](cid:62). The
that the SPE in the free-energy could be used as residuals distribution factorizes as:
for fault detection, removing the need for more advanced
p(x,u,y ,y ,y )=p(u|x)p(y |x)p(y |x)p(y |x)p(x)
residual generators. Besides, the precision matrices in the v q q˙ v q q˙
(cid:124) (cid:123)(cid:122) (cid:125)(cid:124) (cid:123)(cid:122) (cid:125)(cid:124)(cid:123)(cid:122)(cid:125)
free-energy could be used for fault accommodation, since control observationmodel prior
(9)
they represent the trust associated to sensory readings. For
Given the sensory data, we then aim to find the posterior
a faulty sensor, the relative precision was decreased to zero
over states and actions p(x,u|y ,y ). We approximate the
to perform fault recovery. Specifically, the residuals in [20] v q
posterior with a variational distribution Q(x,u). We utilize
are generated by considering the quadratic form of the SPE
the mean-field assumption (Q(x,u) = Q(x)Q(u)) and the
ε(cid:62)P ε , where ε = y −g (µ) with s ∈ {q, q˙, v}. A
s ys s s s s Laplace approximation. The posterior over the state x is
static fault detection threshold ψ was chosen as an upper
s assumedGaussianwithmeanµ .Theposterioroveractions
bound on the quadratic terms. x
u is also assumed Gaussian with mean µ . This results in
TheSPEdependsonthebeliefµ,whichisbiasedtowards u
the following expression for variational free-energy:
a given goal. This means that the SPE in standard AIC can
increase for causes that are not necessarily related to a fault, F =−lnp(µ ,µ ,y ,y ,y )+C (10)
u x v q q˙
i.e. the robot is stuck due to a collision or there is an abrupt
change in the goal µ , for example in a pick-and-place Thisexpressioncanbefactorizedasinequation(9).Assum-
d
application. The residuals are thus dependent on the goal, ing Gaussian model F can be expanded to:
which is problematic. This was not an issue in [20] because 1
F = (ε(cid:62)P ε +ε(cid:62)P ε +ε(cid:62)P ε
of the over-conservative threshold used for fault detection, 2 yq yq yq yq˙ yq˙ yq˙ yv yv yv
but it becomes apparent when the SPE are closely analysed. +ε(cid:62)P ε +ε(cid:62)P ε −ln|P P P P P |)+C,
x x x u u u u yq yq˙ yv x
Fig. 2 reports the absolute value of the SPE for the joint of (11)
a robot arm controlled using an AIC, during a point to point
where ε , ε , ε are the sensory prediction errors of
motion with three via-points µ d1 , µ d2 , µ d3 .
position
y
e
q
ncod
yq
e
˙
r, v
y
e
v
locity encoder, and the visual sensor
respectively.Furthermore,ε andε arethepredictionerrors
x u
for the prior on the state and the control action respectively.
The prediction error on the state prior ε is computed
x
considering a prediction of the state xˆ at the current time-
step, which is a deterministic value. It follows that ε =
x
(µ −xˆ).Thepredictionxˆ =[qˆqˆ˙](cid:62) canbecomputedinthe
x
samefashionasthepredictionstepof,forinstance,aKalman
filter or of a Luenberger observer. While in such cases the
prediction computation would require the knowledge of an
accurate dynamic model, in this paper we assume we do not
have access to that. Instead, we will propagate forward in
time the current state belief using the following simplified
discrete time model:
Fig.2. EffectofabruptchangeingoalontheSPEinstandardAIC.The (cid:20) I I∆t (cid:21)
SPEincreasessharplywithoutthepresenceofanysensoryfaults. xˆ k+1 = 0 I µ x,k (12)
Using a tighter threshold to detect faults of small entity where I represents an unitary matrix of suitable size. This
by using the approach proposed in [20] would lead to many form assumes that the velocities of the joints will remain
false positives. In this work we tackle the problem of biased roughly constant and the position of each joint is thus
computed as the discrete time integral of the velocity, using where κ and κ are the gradient descent step sizes. The
u µ
a first-order Euler scheme. As mentioned, if one has access gradient on control can be computed as:
to a better dynamic model, that can be used instead.
∂F
Finally, the state prior now does not encode information =P (µ −f∗(µ ,µ )) (16)
∂µ u u x d
about the target µ (unlike in the standard AIC). The u
d
information about the target is encoded in the distribution Settingthistozeroresultsinthecontrolactionbeingequal
p(u|x). We choose this distribution to be Gaussian as well to f∗(µ ,µ ). If this function is chosen similar to a PID
x d
withameanoff∗(µ ,µ ),whichisafunctionthatsteersthe controller, then the control law of our system will converge
x d
systems toward the target. This then results in ε = (µ − towards that. This can be extended to richer control by
u u
f∗(µ ,µ )).Thefunctionf∗(µ ,µ )canbeanycontroller, modifying the probabilistic model in eq. (9). The only term
x d x d
for instance a P controller: f∗(µ ,µ )) = P(µ −µ ). In depending on the control action now is p(u|x); however, a
x d d x
thispaper wechoose thefunction suchthat itconvergesto a prior p(u) can be also added. In that case the generative
PID controller; however, other choices can be made without model would be:
loss of generality. For state and actions update, first-order 1
Euler integration is used to obtain discrete time equations. α p(u)p(u|x)p(y v |x)p(y q |x)p(y q˙ |x)p(x) (17)
B. Definition of the observation model where α is a normalization constant. This prior can then
The sensory prediction errors are as in the AIC, that is encodeafeed-forwardsignal(open-loopcontrollaw).When
ε =(y −µ), ε =(y −µ(cid:48)) and ε =(y −g (µ)) but computing the u that minimizes F in that case, it would
q q q˙ q˙ v v v
µ is not biased anymore towards the target µ d . The relation be a combination of the feed-forward signal and f∗(µ x ,µ d )
between µ and y is expressed through the generative model depending on the value of Σ u . This is employed in [28].
of the sensory input g =[g q , g q˙ , g v ]. Position and velocity Since µ u converges to f∗(µ x ,µ d ), we can achieve unbi-
encodersdirectlymeasurethestate.Thusg q andg q˙ arelinear ased state estimation. In fact, this would result in ε u = 0
mappings between µ and y. and thus the current target would not affect the the beliefs
To define g (µ), instead, we use a Gaussian Process about the states. In u-AIC, the belief about the states is only
v
Regression (GPR) as in [19]. This is particularly useful affected by the predicted values and the observations from
because we can model the noisy and distorted sensory input various sensor, exactly as in a Kalman filter [29].
from the camera, and at the same time we can compute a
D. Key differences between AIC and u-AIC
closed form for the derivative of the process with respect to
thebeliefsµ,requiredforthestateupdatelaws.Thetraining The AIC considers the relationship between states and
data is composed by a set of observations of the (planar) observationswithoutexplicitlymodellingthecontrolactions.
camera output [y¯ , y¯ ](cid:62) in several robot configurations The prior over state p(x) in equation (2) thus encodes the
vx vz
y¯ . We use a squared exponential kernel k of the form: target/goals state. In filters, such as the Kalman filter, the
q
k(y ,y ) =σ2exp (cid:0) −1(y −y )(cid:62)Θ(y −y ) (cid:1) priorcomesfromapredictionstepthatreliesontheprevious
qi qj f 2 qi qj qi qj state and action. In case of the AIC, the beliefs update law
+σ2d (13)
n ij is essentially a filter where the prediction step is biased
wherey , y ∈y¯ ,andd istheKroneckerdeltafunction. towards the goals state i.e. the agent normally predicts to
Θ is a qi diag q o j nal m q atrix i o j f hyperparameters that are fit move linearly towards the target (see eq. (5)).
according to the training data to obtain accurate predictions. Intheu-AIC,actionsareexplicitlymodelledandthetarget
Thehyperparametersareoptimizedinordertomaximizethe state is encoded in the term p(u|x). This has two implica-
marginal likelihood, see [27]. The predictions are then [19]: tions. First, the state is not biased towards the target since
its prior p(x) is not. A prior encoding a prediction step will
(cid:20) k(y ,y¯ )K−1y¯ (cid:21)
g (y )= q∗ q vx alsoimprovetheoverallstate-estimationaccuracy.Secondly,
v q∗ k(y ,y¯ )K−1y¯
q∗ q vz (14) explicitactionsallowustodirectlyperformgradientdescent
g (y )(cid:48) = (cid:20) −Θ−1(y q∗ −y¯ q )(cid:62)[k(y q∗ ,y¯ q )(cid:62)·α x ] (cid:21) on F with respect to u. This is not possible in the general
v q∗ −Θ−1(y q∗ −y¯ q )(cid:62)[k(y q∗ ,y¯ q )(cid:62)·α z ] AIC case and the chain rule had to be utilized (see eq. (8)).
where · means element-wise multiplication, K is the Finally, the u-AIC has guarantees regarding the stability
covariance matrix, α =K−1y¯ and α =K−1y¯ . ofthecontrollerwhiletheAICdoesnot.Thisisoutofscope
x vx z vz
of this paper and will be discussed in future work.
C. Estimation and control using the u-AIC
Similar to the AIC, performing both state-estimation and IV. FAULTDETECTION,ISOLATION,ANDRECOVERY
control can be achieved using gradient descent on F. This In this section we describe how the SPE from the u-AIC
is simpler in the case of the u-AIC since there is no need to can be used as residual signals, and how to perform FDI.
use the chain rule when computing the control actions (see Without loss of generality, for these derivations we will
eq. (8)) or to consider generalized motion (7): consider only the proprioceptive sensors and we discretize
∂F ∂F the continuous dynamics with first order Euler integration.
µ˙ =−κ , µ˙ =−κ , (15)
u u∂µ x µ∂µ According to the approximated system’s dynamics in (12),
u x
andexpandingthesecondtermin(15)whereF iscomputed thisset,thusnumericalapproximationsareusedinstead.The
as in (11), the state estimation law can be rewritten as: residual r can be seen as a random variable in the same
k+1
probability space of δ [12].
µ =γ(µ ,u )+Λ(g(µ )−y ) (18) k
k+1 k k k k
Equation (18) represents the dynamics of an estimator
where stability results from the value that we obtain for
diagonal matrix Λ. In [29] it has been shown how the free-
energyprinciplecanbeusedtoderivestablestateobservers,
for a linear case with coloured noise. It is important to
note that γ and Λ are known expressions resulting from the
partial derivatives of F. The term (y −g(µ )) represents
k k
Fig. 3. Healthy residual set at time k+1 as image obtained from the
the sensory prediction errors. In the u-AIC, the states of the
outputof(20).
system are steered towards the desired goal following the
dynamics imposed by the controller. Therefore, the resulting
The residual set R at the next time step k+1 can be
k+1
system’s dynamics can be represented in general as:
seen as the image obtained by computing the output of (20),
(cid:40) where the total uncertainty δ varies over its domain ∆
x =γ(x ,u )+φ(x ,u ,ρ ) k k
k+1 k k k k k (19) (Fig. 3). Note that the healthy residuals can be characterized
y k =x k +z k by setting ρ k =0.
where x ∈ Rn and u ∈ Rm are the state and input Remark 1: While the system dynamics γ and the fault
k k
variables, while γ(x ,u ) : Rn × Rm (cid:55)→ Rn represents function φ have been introduced for analysis purposes, they
k k
the dynamics of the system in healthy conditions. y ∈ Rn do not correspond to known models of the healthy and
k
is the measurement of the full state which is affected by the faulty behaviours. In particular, γ is obtained via algebraic
presence of measurement noise z ∈ Rn. The expressions manipulations from current free energy framework’s update
k
obtainedsofarforthesystemdynamicswillallowustocast equations. In particular, the residual r for implementing the
easily a model-based fault diagnosis approach in the current detection and isolation logic described next can be directly
framework, even if the knowledge of an a-priori model computed from the current belief and measurement. Indeed,
is not needed. The real system can be affected by faults theproposedfaultdiagnosisapproachbasedontheu-AICis
which are represented by the fault function φ(x ,u ,ρ ) : completely model-free.
k k k
Rn×Rm×Rl (cid:55)→Rn.Theunknownparameterρ determines
k
the fault amplitude and shall be such that φ(x ,u ,0)=0. B. Threshold for fault detection
k k
A. Residual generation Asin[30],weconsideraprobabilisticallyrobustdetection
logic of the form:
Following [12], [30] we rely on two assumptions:
Assumption 1: Nofaultactsonthesystembeforethefault n
d (r )≤ (cid:44)d (22)
time k , thus ρ = 0 for 0 ≤ k < k . In addition, before M k+1 α M
f k f
and and after the occurrence of a fault the variables x and
k
u remain bounded, that is ∃ S = Sx ×Su ⊂ Rn ×Rm where d M is the detection threshold, n is the dimension of
k
the residuals, α is a tuning parameter, and d (·) indicates
such that (x , u )∈S ∀k. M
k k
the Mahalanobis distance of the residuals. In general:
Assumption 2: z is a random variable defined on some
k
probability spaces (Z,B,P ), where Z ⊆ Rn. B(·) indi- (cid:113)
Z d (r)= (r−r¯)(cid:62)C−1(r−r¯) (23)
cates a Borel σ-algebra, and P is the probability measures M r
Z
defined over Z. Furthermore, it is not correlated and are
where r¯ (cid:44) E[r] ∈ Rn and C (cid:44) Cov[r] ∈ Rn×n are
independent from x , u and ρ ∀k. r
k k k
the expected value and covariance matrix of the residuals.
We define the residuals for fault detection as the sensory
According to the Multivariate Chebyshev Inequality [31]:
prediction errors r =y −g(µ ). Thus, according to (19),
k k k
(18)andfollowing[12],[30],theresidualsdynamicswillbe n
Pr[d (r )≥ ]≤α, ∀α∈[0, 1] (24)
given by: M k α
r =Λr +δ +φ(x ,u ,ρ ) (20) This means that, in healthy conditions, the probability of a
k+1 k k k k k
falsealarm,thatisd exceedingthethresholdd¯ ,isupper
M M
bounded by α. The value α can be tuned to achieve the
δ =γ(y −z ,u )−γ(µ ,u )+z (21)
k k k k k k k+1 desiredprobabilisticrobustnessofthethreshold.Thepresent
The stochastic process δ , is the random total uncertainty detection logic is equivalent to check if the residual at time
k
which affects the residuals generation. It follows that δ stepk+1belongstoatimevaryingellipsoidwithmeanr¯
k k+1
is in the probability space (∆ ,B(∆ ),P ) where ∆ is and covariance C . In the general nonlinear case, these
k k δk k rk+1
obtained by letting z and z vary over Z. Apart from momentscanbeapproximatedbytheirsampledcounterparts
k k+1
simple cases, it is not possible to obtain a closed form for obtained in healthy conditions.
C. Fault isolation for encoders and velocity sensors is set to σ =σ =0.001,
q q˙
while the one for the camera to σ =0.01.
The detection policy in (22) results effective to label the v
The simulation consists of controlling the robot arm for a
system as healthy or faulty. However, it is not possible to
double point-to-point motion from the starting configuration
use the same SPE generated through equation (11) for fault
q = [−π/2, 0] (rad) to µ = [−0.2, 0.5] (rad), and
isolation. In fact, the free-energy is computed as a weighted d1
then µ = [−0.6, 0.2] (rad). A fault occurs during the
sumofthesquaredpredictionerrorsfusingdifferentsensory d2
trajectory from µ to µ , i.e. we set k = 8s. The fault
sources. This means that when a fault occurs, its effects will d1 d2 f
can affect either the encoders or the camera. The encoder
propagate to all the SPE in equation (11). We define two
fault is such that the output related to the first joint freezes
additionalfree-energiesandstateestimationprocesseswhich
soy (k)=[q (k ), q (k)](cid:62) fork ≥k .Thefaultdetection
rely on different sensory sources (i.e. either proprioceptive q 1 f 2 f
andrecoveryofsuchafault,aswellasthesystem’sresponse,
or visual).
are reported below in Fig. 4 and Fig. 5:
1
F = (ε(cid:62) P ε +ε(cid:62) P ε +ε(cid:62)P ε
p 2 yq yq yq yq˙ yq˙ yq˙ x x x (25)
−ln|P P P |),
yq yq˙ x
1
F = (ε(cid:62) P ε +ε(cid:62)P ε −ln|P P |) (26)
v 2 yv yv yv x x x yv x
Doing so, we can isolate encoder and camera faults
since state estimation is now done using two independent
measurement sources. F and F are only used for fault
p v
isolation and not control. The thresholds for the SPE from
(25) and (26) are then computed as in Sec. IV-B.
Fig.4. NormaliseddM incaseofencoderfault.Adetectionoccurwhen
thenormalizedvalueexceeds1.
D. Fault recovery
Fault recovery can be performed as in [20]. Once a fault
is detected and isolated, fault recovery is triggered. If a
sensorismarkedasfaulty,itscorrespondingprecisionmatrix
is set to zero. The controller can thus exploit the sensory
redundancy to a) have a better a posteriori approximation of
thestates,andb)tocompensateformissingorwrongsensory
data. Once a fault is detected and isolated, the precision
matrix of the faulty sensor P is reduced to zero:
fs
P =0 (27)
fs
Interestingly, the active inference framework allows also
forhyper-parameters(precision)learning[16],[32].Thebias Fig.5. System’sresponseincaseofencoderfaultwithoutrecovery(fixed
in the standard AIC hindered hyper-parameters learning for
precision matrices) and with recovery (setting Pyq = 0 after detection).
Thefaultoccursafter8s.
fault recovery purposes, but learning meaningful precision
matricesassociatedwithsensoryreadingswithu-AICisnow AscanbeseenfromFig.5,thesystemisnotabletoreach
possible and will be investigated in future work. the set-point after the occurrence of the fault in case of no
recovery. The robot arm reaches a different configuration to
V. SIMULATIONSTUDY
minimise the free-energy, which is built fusing the sensory
In this section we illustrate the fault detection, isolation, information from the (faulty) encoders and the (healthy)
and recovery strategy on a MATLAB simulation using a 2- camera. Recovery happens after 60 (ms), and after that the
DOFroboticmanipulator.Thedynamicalmodeloftherobot faulty reading is discarded by setting zero precision. The
is defined as [33]: robot arm is then able to reach the final configuration.
The other situation that we consider in this work is a
u=M(q)q¨+C(q,q˙)q˙+Dq˙+G(q) (28)
camera fault. This fault is supposed to be a misalignment,
where q = [q , q ](cid:62), u(t) = [u , u ](cid:62), D is the dueforinstancetoacollision.Thisissimulatedbyinjecting
1 2 1 2
friction coefficient matrix, M is the inertia matrix, C is a bias i.e. y (k) = y (k)+0.04 for k ≥ k . Note that the
v v f
the Coriolis matrix, and G models the effects of gravity. entity of this fault is small and comparable with the camera
The dynamic model is only used to simulate the response to noise,i.e.thezeromeanGaussiannoisewithσ =0.01(m).
v
the commanded torques since the u-AIC provides a control The fault detection is reported in Fig. 6. The system’s
law agnostic to the dynamical model. Thus, link’s masses, response with and without recovery is similar to Fig. 5.
friction coefficients, and other dynamical parameters are not The simulation results will be extended to real experi-
part of the controller. The noisy sensory readings have zero- ments,leveragingthescalabilityandadaptabilityoftheactive
mean Gaussian noise. The standard deviation of the noise inference controller [15]. The steady state errors (e ) and
ss
[8] J. Chen and R. J. Patton, Robust model-based fault diagnosis for
dynamicsystems. SpringerScience&BusinessMedia,LLC,1999.
[9] K.S.NarendraandJ.Balakrishnan,“Adaptivecontrolusingmultiple
models,”IEEETransactiononAutomaticControl,1997.
[10] S. Fang, M. Blanke, and B. J. Leira, “Mooring system diagnosis
andstructuralreliabilitycontrolforpositionmooredvessels,”Control
engineeringPractice,vol.36,pp.12–26,2015.
[11] R.Ferrari,H.Dibowski,andS.Baldi,“Amessagepassingalgorithm
for automatic synthesis of probabilistic fault detectors from building
automationontologies,”IFAC-PapersOnLine,vol.50,no.1,pp.4184–
Fig.6. NormaliseddM incaseofcamerafault. 4190,2017.
[12] V.Rostampour,R.Ferrari,andT.Keviczky,“Asetbasedprobabilistic
approachtothresholddesignforoptimalfaultdetection,”Procs.ofthe
AmericanControlConference,pp.5422–5429,2017.
the RMSE between beliefs and actual joint positions for
[13] V. Rostampour, R. M. Ferrari, A. M. Teixeira, and T. Keviczky,
the simulations are reported in Table I. “Privatized distributed anomaly detection for large-scale nonlinear
uncertainsystems,”IEEETransactionsonAutomaticControl,2020.
TABLEI [14] M. R. Blas and M. Blanke, “Stereo vision with texture learning
for fault-tolerant automatic baling,” Computers and electronics in
SUMMARYOFTHERESULTSUSINGU-AIC
agriculture,vol.75,no.1,pp.159–168,2011.
[15] C.Pezzato,R.Ferrari,andC.H.Corbato,“Anoveladaptivecontroller
Metrics EncoderFault CameraFault forrobotmanipulatorsbasedonactiveinference,”IEEERoboticsand
Recovery Norecovery Recovery Norecovery AutomationLetters,vol.5,no.2,pp.2973–2980,2020.
ess,q1 −2.7e−3 0.1674 −2.1e−4 0.0173 [16] M. Baioumy, P. Duckworth, B. Lacerda, and N. Hawes, “Active
ess,q2 −1.5e−3 −0.1176 −2.5e−4 7.0e−3 inferenceforintegratedstate-estimation,control,andlearning,”arXiv
RMSEq1 3.0e−3 0.0896 5.7e−4 0.0112 preprintarXiv:2005.05894,2020.
RMSEq2 2.5e−3 0.0636 3.5e−4 2.1e−3 [17] K. J. Friston, “The free-energy principle: a unified brain theory?”
NatureReviewsNeuroscience,vol.11(2),pp.27–138,2010.
[18] C. L. Buckley, C. S. Kim, S. McGregor, and A. K. Seth, “The free
VI. CONCLUSIONS energy principle for action and perception: A mathematical review,”
JournalofMathematicalPsychology,vol.81,pp.55–79,2017.
In this paper we presented a new formulation of an active [19] P.LanillosandG.Cheng,“Adaptiverobotbodylearningandestima-
inferencecontrollerwherethefree-energydependsexplicitly tionthroughpredictivecoding,”inIROS,2018.
[20] C. Pezzato, M. Baioumy, C. H. Corbato, N. Hawes, M. Wisse, and
on the control actions. This formulation brings two general
R.Ferrari,“Activeinferenceforfaulttolerantcontrolofrobotmanip-
advantages. First, it allows us to remove the bias from ulatorswithsensoryfaults,”in1stInt.WorkshoponActiveInference,
state-estimation which affected the standard active inference ECML PKDD, ser. Communications in Computer and Information
Science,Springer,Ed.,vol.1326,2020.
controller,leadingtomoreaccuratestateestimation.Second,
[21] D.Lindley,“Bayesianstatistics,areview,”SIAM,vol.2,1972.
it simplifies the definition of the control actions since it re- [22] C. W. Fox and S. J. Roberts, “A tutorial on variational bayesian
movestheneedforcomputingpartialderivativesofthefree- inference,” Artificial intelligence review, vol. 38, no. 2, pp. 85–95,
2012.
energy. Next to that, we showed how the new formulation
[23] K.Friston,J.Mattout,N.Trujillo-Barreto,J.Ashburner,andW.Penny,
simplifies the use of established fault detection techniques “VariationalfreeenergyandtheLaplaceapproximation,”Neuroimage,
withprobabilisticrobustness,whichwouldhavecausedmany vol.34(1),pp.220–234,2007.
[24] K. J. Friston, J. Mattout, and J. Kilner, “Action understanding and
falsepositivesusingstandardactiveinference.Theeffective-
activeinference,”Biologicalcybernetics,vol.104(1-2),pp.137–160,
nessoftheapproachisshowcasedinasimulated2-DOFarm 2011.
subject to sensory faults. Future work will investigate fault- [25] M.BaltieriandC.L.Buckley,“AprobabilisticinterpretationofPID
controllers using active inference,” in Int. Conference on Simulation
tolerantcontrolwithstochasticdecisionboundaries,aformal
ofAdaptiveBehavior. Springer,2018,pp.15–26.
stability proof, and experiments on a real robot manipulator. [26] G. Oliver, P. Lanillos, and G. Cheng, “Active inference body
perception and action for humanoid robots,” arXiv preprint
REFERENCES arXiv:1906.03022v2,2019.
[27] C.RasmussenandC.Williams,Eds.,GaussianProcessesforMachine
[1] J.Kru¨ger,T.Lien,andA.Verl,“Cooperationofhumanandmachines Learning. MITPress,2006.
inassemblylines,”CIRPAnnals-ManufacturingTechnology,2009.
[28] M. Baioumy, M. Mattamala, and N. Hawes, “Variational inference
[2] M.Visinsky,J.Cavallaro,andI.Walker,“Roboticfaultdetectionand for predictive and reactive controllers,” in ICRA 2020 Workshop on
faulttolerance:Asurvey,”ReliabilityEngineeringandSystemSafety, NewadvancesinBrain-inspiredPerception,InteractionandLearning,
vol.46,pp.139–158,1994. 2020.
[3] W. Dixon, I. Walker, D. Dawson, and J. Hartranft, “Fault detection [29] A. Meera and M. Wisse, “Free energy principle based state and
forrobotmanipulatorswithparametricuncertainty:Aprediction-error- inputobserverdesignforlinearsystemswithcolorednoise,”in2020
basedapproach,”IEEETrans.onRoboticsandAutomation,vol.16(6), AmericanControlConference(ACC),2020,pp.5052–5058.
pp.689–699,2000. [30] V. Rostampour, R. Ferrari, A. M. Teixeira, and T. Keviczky,
[4] J.ShinandJ.Lee,“Faultdetectionandrobustfaultrecoverycontrol “Differentially-Private Distributed Fault Diagnosis for Large-Scale
for robot manipulators with actuator failures,” in Procs. of the IEEE NonlinearUncertainSystems,”IFAC-PapersOnLine,vol.51,pp.975–
Int.Conf.onRoboticsandAutomation,1999,pp.861–866.
982,2018.
[5] G. Paviglianiti, F. Pierri, F. Caccavale, and M. Mattei, “Robust fault [31] X.Chen,“AnewgeneralizationofChebyshevinequalityforrandom
detectionandisolationforproprioceptivesensorsofrobotmanipula- vectors,”arXivpreprintarXiv:0707.0805,2007.
tors,”Mechatronics,vol.20(1),pp.162–170,2010.
[32] R. Bogacz, “A tutorial on the free-energy framework for modelling
[6] M.Van,D.Wu,S.Ge,andH.Ren,“Faultdiagnosisinimage-based perceptionandlearning,”Journalofmathematicalpsychology,2015.
visualservoingwitheye-in-handconfigurationsusingKalmanfilter,” [33] B.Siciliano,L.Sciavicco,L.Villani,andG.Oriolo,Robotics:Mod-
IEEETrans.IndustrialElectronics,vol.12(6),pp.1998–2007,2016. elling, Planning and Control. Springer Science & Business Media,
[7] M. Capisani, A. Ferrara, and P. Pisu, “Sliding mode observers for 2010.
vision-based fault detection, isolation and identification in robot ma-
nipulators,”inAmericanControlConference,2010.