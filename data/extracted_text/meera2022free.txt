Free Energy Principle for the Noise Smoothness Estimation of
Linear Systems with Colored Noise
Ajith Anil Meera and Martijn Wisse
Abstract— The free energy principle (FEP) from neuroscience
provides a framework called active inference for the joint
estimation and control of state space systems, subjected to
colored noise. However, the active inference community has
been challenged with the critical task of manually tuning
the noise smoothness parameter. To solve this problem, we
introduce a novel online noise smoothness estimator based on
the idea of free energy principle. We mathematically show that
our estimator can converge to the free energy optimum during
smoothness estimation. Using this formulation, we introduce a
joint state and noise smoothness observer design called DEMs.
Through rigorous simulations, we show that DEMs outperforms
state-of-the-art state observers with least state estimation error.
Finally, we provide a proof of concept for DEMs by applying it
on a real life robotics problem - state estimation of a quadrotor
hovering in wind, demonstrating its practical use.
I. INTRODUCTION
The rising demand for autonomous drone delivery systems
has increased the need for accurate state observers that are
robust against uncertain events like strong wind currents.
These unmodelled wind currents induce colored noise to the
system, hindering the safe operation of drones. We take a
step in this direction by using the ideas from computational
neuroscience to introduce a novel state and noise smoothness
observer design for linear systems with colored noise.
The classical linear estimators like Kalman Filter (KF)
assumes the noises to be white. This assumption is often
violated in practice, resulting in a sub-optimal estimation
[1]. Many adaptations on KF have been introduced to over-
come this challenge, including Second Moment Information
Kalman ﬁlter (SMIKF) [2], State Augmentation (SA) [3],
Measurement Differencing (MD) [4] etc. Dynamic Expec-
tation Maximization (DEM) [5], based on Free Energy
Principle (FEP) [6] from neuroscience has recently been
used to design state and input observers [7] that has shown
to outperform the classical methods both in simulation and
in real robot experiments [8]. However, DEM requires the
prior knowledge of the noise smoothness parameter for the
accurate state estimation. To solve this problem, we introduce
a novel online noise smoothness estimator based on FEP, for
linear systems with colored noise. The core contributions of
the paper include:
1) introduction of an online smoothness estimator for the
state estimation of linear systems under colored noise,
2) extensive evaluation of the estimator in simulation and
its validation on a real robot (quadrotor ﬂight) data.
Both authors are with the Department of Cognitive Robotics at TU Delft,
The Netherlands. Corresponding author: ajitham1994@gmail.com
II. RELATED WORK
This section highlights the interdisciplinary nature of FEP
with related works in neuroscience and robotics literature.
A. Neuroscience
FEP posits that all biological systems resist their natural
tendency to disorder by minimizing their free energy [6],
where free energy is an information theoretic measure that
bounds sensory surprisal. FEP emerges as a uniﬁed theory of
the brain by providing a mathematical formalism for brain
functions [9], unifying action and perception [10], explaining
Freudian ideas [11], and connecting memory and attention
[9]. The work closest to our proposed idea is the Generalized
ﬁltering [12] that uses FEP for noise smoothness estimation
during the inversion of dynamic models of the brain (fMRI
data) [13]. We extend this idea into robotics to design an
online state and noise smoothness observer for applications
like quadrotor ﬂights with wind as colored noise.
B. Robotics and control
In control systems literature, numerous approaches are
used to deal with colored noise during state estimation
[1]. SA models the colored process noise as an auto-
regressive (AR) noise and augments the state space equation
to transform it into an equivalent system inﬂuenced by white
noise [3]. SMIKF [2] extends KF for coloured noise by
incorporating the temporal correlations of the AR noise into
the prior covariance calculation of KF. MD [4] approach
deals with handling colored measurement noise. However,
the white noise assumption is prevalent in robotics for the
state estimation of a quadrotor [14], which might not be
effective in outdoor windy conditions [8]. Our work ﬁlls
this research gap by providing an online noise smoothness
estimator.
The brain inspired nature of FEP has already inspired the
development of intelligent agents [15] – body perception of
humanoid robots [16], estimation and control of manipulator
robot [17], system identiﬁcation of a quadrotor [18], SLAM
[19], PID controller [20], KF [8], [21] etc. These active
inference applications can employ our noise estimator for
better estimation and control of robots during colored noise.
III. PROBLEM STATEMENT
Consider the linear plant dynamics given in Equation 1
where A, B and C are constant system matrices, x ∈Rn is
the hidden state, v ∈Rr is the input and y ∈Rm is the output.
˙x = Ax +Bv +w, y = Cx +z. (1)
arXiv:2204.01796v1  [eess.SY]  4 Apr 2022
Here w ∈Rn and z ∈Rm represent the process and measure-
ment noise with noise precision (inverse covariance) Πw and
Πz respectively. Variables of the plant are denoted in bold-
face, while its estimates are denoted in non-boldface. The
noises in this paper are generated through the convolution of
white noise with a Gaussian ﬁlter of kernel width s.
The problem considered in this paper is the state ( x)
and noise smoothness ( s) observer design (DEMs) for the
linear system given in Equation 1, subjected to colored noise.
We show that our observer outperforms state-of-the-art state
observers, both in simulation (Section VIII) and on real robot
data (Section IX).
IV. NOISE COLOR MODELLING
The two key concepts behind the success of DEM in
handling the colored noise are i) the use of generalized co-
ordinates and ii) the noise precision modelling. This section
aims to elaborate on these theoretical concepts.
A. Generalized coordinates
Generalized coordinates is a vector representation of the
trajectory of a time varying quantity (x,v,y) using a collection
of its higher order derivatives. For example, the state vector
in generalized coordinates is written using a tilde operator
as ˜x = [x x′ x′′ ....]T , where the dash operator represents the
derivatives. The key advantage is the capability to track the
trajectory of states, unlike the classical estimators that track
only the point estimates. This provides additional data for
DEM during estimation, resulting in its superior performance
during state estimation under colored noise. Since the noises
are colored, the higher derivatives of the system model can
be written as [5]:
x′= Ax +Bv +w
x′′= Ax′+Bv′+w′
...
y = Cx +z
y′= Cx′+z′
...
(2)
which can be compactly written as:
˙˜x = Dx ˜x = ˜A ˜x + ˜B ˜v + ˜w ˜y = ˜C ˜x + ˜z (3)
where Dx =
[0 1
0 1
. .
0 1
0
]
(p+1)×(p+1)
⊗In×n.
Here, Dx represents the shift matrix, which performs the
derivative operation on the generalized state vector. p and
d represent the embedding order for the hidden states and
the inputs respectively, indicating the number of derivatives
used. The generalized system matrices are given by ˜A =
Ip+1 ⊗A, ˜B = Ip+1 ⊗B, ˜C = Ip+1 ⊗C, where I denotes
the identity matrix and ⊗the Kronecker tensor product.
B. Noise precision modelling
The second key concept is the modelling of generalized
noise precision (inverse covariance) matrix ˜Π. Since the
noises are assumed to be Gaussian convoluted white noise,
the covariance matrix embedding the relation between noise
derivatives take a speciﬁc structure [5]. The smoothness
matrix deﬁning this relation for p = 6 is calculated as [7]:
S =


35
16 0 35
8 s2 0 7
4 s4 0 1
6 s6
0 35
4 s2 0 7 s4 0 s6 0
35
8 s2 0 77
4 s4 0 19
2 s6 0 s8
0 7 s4 0 8 s6 0 4
3 s8 0
7
4 s4 0 19
2 s6 0 17
3 s8 0 2
3 s10
0 s6 0 4
3 s8 0 4
15 s10 0
1
6 s6 0 s8 0 2
3 s10 0 4
45 s12


, (4)
where s is the kernel width of the Gaussian ﬁlter. Since
s < 1 second for practical cases (sensors have high sampling
rate), the ﬁrst elements in S matrix are higher than the
last ones, implying a higher correlation between the ﬁrst
noise derivatives (more smooth) than the last derivatives (less
smooth). The combined (generalized) noise precision matrix
can be written using the S matrix as:
˜Π =
[
S ⊗Πz 0
0 S ⊗Πw
]
. (5)
With the key concepts in place, the next section derives the
free energy formulations that are necessary for the observer
design in Section VI.
V. FREE ENERGY OPTIMIZATION
FEP uses Bayesian Inference to estimate the posterior
probability p(ϑ/y) =p(ϑ,y/
∫
p(ϑ,y)dϑ, where ϑ is the
component to be estimated (ϑ = {˜x,s}), and y is the measure-
ment [22]. The presence of an intractable integral motivates
the use of a variational density q(ϑ), called the recognition
density that approximates the posterior as q(ϑ) ≈p(ϑ/y).
This approximation is achieved by minimizing the Kullback-
Leibler (KL) divergence of the distributions given by
KL(q(ϑ)||p(ϑ/y)) =⟨lnq(ϑ)⟩q(ϑ) −⟨ln p(ϑ/y)⟩q(ϑ), where
⟨.⟩q(ϑ) represents the expectation over q(ϑ). Upon simpliﬁ-
cation using p(ϑ/y) =p(ϑ,y)/p(y), it reduces to [6]:
ln p(y) =F +KL(q(ϑ)||p(ϑ|y)), (6)
where F = ⟨ln p(ϑ,y)⟩q(ϑ) −⟨lnq(ϑ)⟩q(ϑ) is the free energy.
Since ln p(y) is independent of ϑ, minimization of the KL
divergence involves the maximization of free energy. This is
the fundamental idea behind using free energy as the proxy
for brain’s inference through the minimization of its sensory
surprisal [6].
We use this idea from free energy principle for the
joint observer design for ˜x and s through two fundamental
assumptions about q(ϑ) =q(˜x,s): i) Mean ﬁeld assumption
[5] that facilitates a conditional independence between the
subdensities, q(ϑ) =q(˜x)q(s), and ii) Laplace assumption
[23] that facilitates the use of Gaussian distributions with
mean µ and variance Σ over these subdensities, q(˜x) =
N (˜x : µ ˜x, Σ˜x) and q(s) =N (s : µs, Σs). We refer to [24]
for an elaborate read on similar simpliﬁcations. Under these
assumptions, F reduces to the sum of precision weighted
prediction errors and the information entropy as:
F = −1
2 ˜εT ˜Π˜ε + 1
2 ln|˜Π|−1
2εsT Πsεs + 1
2 ln|Πs|, (7)
where ˜ε is the combined prediction error for outputs and
states, and εs is the prediction error for s, given by:
˜ε =
[ ˜y −˜C ˜x
D ˜x −˜A ˜x −˜B ˜v
]
, and εs = s −ηs. (8)
Here ηs and Πs are the prior smoothness and its prior
precision (conﬁdence). For this work, we start the estimation
from a low prior ηs ≈0 with a very low conﬁdence (Πs = 1).
Therefore, Equation 7 reduces to:
F = −1
2 ˜εT ˜Π˜ε + 1
2 ln|˜Π|−1
2s2. (9)
The last term in Equation 9 is the novel term that we have
introduced for optimizing smoothness, and doesn’t appear
in FEP literature. Using this, we propose an online noise
smoothness estimation algorithm which estimates s through
the gradient ascend (maximization) of F, where ∂F
∂s |s=so = 0
and ∂2F
∂s2 |s=so < 0, with so being the smoothness value that
maximizes F. The free energy gradients necessary for this
scheme are obtained by differentiating Equation 9:
∂F
∂s = −1
2 ˜εT ∂ ˜Π
∂s ˜ε + 1
2
∂ ln|˜Π|
∂s −s
∂2F
∂s2 = −1
2 ˜εT ∂2 ˜Π
∂s2 ˜ε + 1
2
∂2 ln|˜Π|
∂s2 −1,
(10)
where the gradients of ln |˜Π| can be computed as (refer
Appendix A) :
∂ ln|˜Π|
∂s = 42(n +m)1
s , ∂2 ln|˜Π|
∂s2 = −42(n +m) 1
s2 . (11)
The usage of a gradient ascent scheme on the free energy
curve for the estimation of s is motivated by the proof for
the existence of a unique maximum for F under practical
bounds as follows.
Proposition V .1.The free energy F deﬁned by Equation 9
has a unique maximum with respect to noise smoothness s,
under the practical range of noise smoothness (0 < s < 1)
and sampling time (dt < s).
Proof. Consider all the smoothness values of s with zero free
energy gradients ( ∂F
∂s |s=so = 0). Substituting Equation 11 in
10 and using ∂F
∂s |s=so = 0 yields the condition satisﬁed by all
maximum and minimum points:
1
2(˜εT ˜Πs ˜ε)|s=so = 21(n +m)
so
−so (12)
where we use the shorthand ˜Πs = ∂ ˜Π
∂s . Since 0 < s < 1, we
have from Equation 12 that:
(˜εT ˜Πs ˜ε)|s=so > 0. (13)
The proof for the existence of a unique maximum is complete
if we prove that ∂2F
∂s2 |s=so < 0, for all so satisfying Equation
13. The curvature of F at s = so is calculated from Equation
10 using Equation 11 as:
Fss|s=so = −1
2
(
(˜εT ˜Πss ˜ε)|s=so +42(n +m) 1
s2o
+1
)
(14)
Since ˜Π ≻0, from deﬁnition ˜εT ˜Π˜ε > 0, and since
(˜εT ˜Πs ˜ε)|s=so > 0, we can conclude that (˜εT ˜Πss ˜ε)|s=so > 0,
even though ˜Πs ⊁0 and ˜Πss ⊁0 (refer Appendix B for
numerical analysis). From Equation 14, (˜εT ˜Πss ˜ε)|s=so >
0 =⇒ Fss|s=so < 0, completing the proof for the existence
of a unique maximum of free energy at s = so.
VI. OBSERVER DESIGN
This section aims to introduce a novel observer design
(DEMs) for the joint state and noise smoothness estimation
of a linear system with colored noise. We formulate the noise
smoothness estimator from the previous section (gradient
ascend on F), using the Newton-Gauss update scheme:
s(t +dt) =s(t)+ ds,
ds = (eFss|t dt −1)(Fss|t )−1Fs|t ,
(15)
where s(t) is the smoothness at time t, and ds is the smooth-
ness increment for a time increment of dt. We combine
this observer design with the standard DEM observer design
for state estimation [7], where the update equation in the
continuous time is given by:
˙˜x = A1 ˜x +B1
[˜y
˜v
]
(16)
where A1 = [Dx −kx ˜CT ˜Πz ˜C −kx(Dx −˜A)T ˜Πw(Dx −˜A)], B1 =
kx [˜CT ˜Πz (Dx −˜A)T ˜Πw ˜B
]
, and kx is the learning rate which
is set to 1 throughout this paper. Since Equation 16 is a linear
differential equation, an exact algebraic discretization can be
performed for the observer as:
˜x(t +dt) =eA1dt ˜x(t)+ A−1
1 (eA1dt −I)B1
[˜y(t)
˜v(t)
]
(17)
Equations 15 and 17 together complete our observer design.
Note that A1 and B1 are nonlinear functions of s because of
the presence of ˜Πw and ˜Πz in it. Therefore, the update equa-
tions of state and noise smoothness observers are coupled.
Since this heavily complicates the stability proof of the joint
estimator, we leave it for future research.
VII. WORKING EXAMPLE
This section aims to provide a working example in sim-
ulation to show the capabilities of our observer design. We
use simulation data at different s levels to show that DEMs
can accurately estimate ˜x and s.
A. Simulation settings
A random system with A =
[
0.0484 0 .7535
−0.7617 −0.2187
]
, B =
[
0.3604
0.0776
]
, and C =


0.2265 −0.4786
0.4066 −0.2641
0.3871 0 .3817
−0.1630 −0.9290

 was used to
generate the synthetic data for a total time of T = 32s
with increments dt = 0.1s, and a Gaussian bump input
v = e−0.25(t−12)2
. The colored noise was generated using
Πw = e6I2 and Πz = e6I4. This simulation setting will be
used throughout the paper, unless mentioned otherwise. We
Fig. 1: The maximization of F successfully estimates s for 8
simulations with different sreal. The colored solid lines represent the
online estimation of s, whereas the dotted lines represent sreal. The
estimation starts from ηs = 0.001 at time t = 0 for all simulations
and converges close to sreal with a bias, within a few samples.
generate eight such time series data using different levels of
noise smoothness s, ranging from 0.1 to 0.8 and use it for
the analysis in this section.
Fig. 2: Free energy vs s plot for 8 different simulations (with 8
different real s values) from Figure 1 at t = 5s. All 8 free energy
curves show a clear maximum around the real s values. This shows
the effectiveness of our noise smoothness observer.
B. Test example
Figure 1 shows the results of our noise smoothness es-
timator for all eight simulations. All simulations start with
the prior ηs = 0.001 and quickly stabilises around the correct
smoothness value (sreal in dashed black), showing the success
of our estimator for a range of noise smoothness values.
Figure 2 shows the free energy vs s curve at t = 5s for all
eight simulations. The clear peaks of the free energy curve
around the correct noise smoothness value ( sreal) shows that
free energy could be used as the objective function for noise
estimation for the operational ranges of s. The importance
of estimating the correct s is shown in Figure 3, where the
minimum state estimation error is achieved when sreal is
known. Therefore, Figure 3, 1 and 2, together demonstrates
the validity of our observer design in simulation. In the next
section, we will benchmark our observer against the state-
of-the-art observers.
VIII. BENCHMARKING
This section aims to benchmark the performance of
our smoothness estimator for a state estimation problem.
Fig. 3: The sum of squared error (SSE) in state estimation of DEM
deteriorates when the noise smoothness s used is different from the
real noise smoothness sreal. The solid and dotted lines denote the
SSE of DEM and KF for different simulated s. The SSE for DEM
takes a minimum when s ≈sreal. For lower s (0.1 for example),
KF outperforms DEM if s is not close to sreal, emphasizing the
importance of an online noise smoothness observer.
Through rigorous simulations, we show that our observer
provides competitive performance during high colored noise
cases.
A. Embedding order of states
In this section, we use rigorous simulations to show that
our observer design can enable state estimation under a
wide range of noises – at different embedding orders and
smoothness levels. We manipulate on the dimension and
component values of the S matrix in Equation 4 through
different p and s values, under the same simulation setup
described in Section VII-A with dt = 0.05s. The size of S
matrix increases with increasing p, whereas the components
inside it increases with increasing s. Figure 4 shows the
results of state estimation using 150 experiments (5 randomly
generated noises each for ﬁve s values and six p values).
The estimation error decreases with increasing p for different
noise smoothness values, highlighting the importance of us-
ing higher order generalized coordination during estimation.
This shows the applicability of our observer for a wide range
of noise smoothness, embedding orders and noises.
Fig. 4: The error in state estimation decreases as the embedding
order of states p increases, for a range of noise smoothness s.
This shows that our smoothness estimation aids an accurate state
estimation till an embedding order of p = 4 for a wide range of s.
B. Benchmark state observer
In this section, we benchmark our observer against other
state-of-the-art observers like KF, SA and SMIKF, to show
its competitiveness. 50 time series data (10 each for 5
smoothness values with dt = 0.05s) were generated using
the simulation setup in Section VII-A and the SSE in state
estimation was computed for KF, SA, SMIFK and DEMs.
The SMIKF and SA implementation accommodated an AR
model of order 1 and 6 respectively for the noise modelling,
whereas the DEM implementation used an embedding order
of p = 6 for states and d = 2 for inputs. Figure 5 shows
the results, clearly indicating the superior performance of
DEMs with minimum error in state estimation for higher
s. DEMs outperforms other observers for a wide range of
s values. However, for low noise color ( s = 0.1), SA and
SMIKF outperforms DEMs. In all cases, DEMs outperforms
KF in the presence of colored noise.
Fig. 5: DEMs outperform KF, SA and SMIKF with minimal
estimation error during state estimation under high colored noise
(s > 0.1). When noises are near white ( s close to dt), DEMs
outperforms KF, but SA and SMIKF performs better. Solutions of
SA is unstable for higher s.
IX. PROOF OF CONCEPT - QUADROTOR FLIGHT
This section aims to provide a proof of concept for our
observer design by employing it for the state estimation of
a real quadrotor ﬂying under wind conditions. We use the
experimental design from [8] to obtain the quadrotor ﬂight
data. The experiment consist of a quadrotor hovering at a
ﬁxed location, under the strong inﬂuence of wind generated
by a blower. The linearized quadrotor model relating the
input motor signals to the output roll angle ( φ) of the
quadcopter, without accounting for the wind dynamics is
given by [8]:
[˙φ
¨φ
]
=
[
0 1
0 0
][φ
˙φ
]
+
[ 0 0 0 0
cBφ
Ixx −
cBφ
Ixx −
cBφ
Ixx
cBφ
Ixx
][
pwm1pwm2pwm3
pwm4
]
,
y =
[
1 0
][φ
˙φ
]
,
(18)
where pwmi is the Pulse Width Modulation signal provided
to the ith motor by the controller for stable hovering, Ixx =
3.4·10−3kgm2 is the quadcopter’s moment of inertia around
the x-axis, and cBφ = 1.274·10−3Nm is the thrust coefﬁcient
that models the relation between the PWM values and the
thrust generated by the quadcopter rotors. φ was recorded
using the Optitrack system, and was used for the state
estimation for a time sequence of T = 15s with dt = 0.0083s.
The inﬂuence of wind dynamics on the quadrotor states
(φ and ˙φ) is unmodelled in Equation 18. Therefore, the
wind dynamics induces strong colored noise ( w) in the
data [18]. The higher process noise ( Πw = e4), and a lower
measurement noise ( Πz = e10) were used to represent high
unmodelled wind noise and low Optitrack noise respectively.
The embedding order of p = 2 and d = 2 were used to capture
the noise color.
Fig. 6: DEMs outperforms other benchmarks in state estimation
on the quadrotor ﬂight data where it hovers under the inﬂuence of
wind, introducing colored noise into the system. DEMs (in red) is
closer to the ground truth Optitrack measurement (ideal in blue),
when compared to other benchmarks. KF, SA and SMIKF shows
coinciding estimation plots.
Fig. 7: The free energy vs s plot for different time instances during
the quadrotor ﬂight (data from Figure 6). The curves show a clear
maximum, similar to the simulation results from Figure 2. This
provides an experimental validation for using the gradient ascend
over free energy for smoothness estimation.
Figure 6 shows the superior state estimation capabilities
of DEMs. DEMs (in red) is closer to the ground truth (in
blue) when compared to other benchmarks. KF, SMIKF and
SA have coinciding state estimation curves. Figure 7 shows
the free energy vs s curve at different time instances t of
the quadrotor ﬂight, showing a clear maximum, similar to
the simulation results in Figure 2, validating the practical
application of our estimator.
X. CONCLUSION
A novel observer (DEMs) for the joint state and noise
smoothness estimation of linear systems with colored noise
was introduced. Through rigorous simulations, DEMs was
shown to outperform the benchmarks like KF, SMIKF and
SA in state estimation under colored noise with minimum
estimation error. The observer was face validated by applying
it on a practical robotics application - the state estimation of a
quadrotor hovering in unmodelled wind conditions, to show
that DEMs is a competitive observer. The main limitation
of this work is the absence of a stability proof for the joint
state and noise smoothness observer, which can be the focus
of future research. The estimator could be extended to solve
the general active inference problem for the estimation and
control of nonlinear systems with colored noise.
ACKNOWLEDGMENT
We would like to thank Peyman Mohajerin Esfahani for
his valuable insights on joint observer design.
REFERENCES
[1] J. L. Crassidis and J. L. Junkins, Optimal estimation of dynamic
systems. Chapman and Hall/CRC, 2004.
[2] Z. Zhou, J. Wu, Y . Li, C. Fu, and H. Fourati, “Critical issues on kalman
ﬁlter with colored and correlated system noises,” Asian Journal of
Control, vol. 19, no. 6, pp. 1905–1919, 2017.
[3] A. Bryson and D. Johansen, “Linear ﬁltering for time-varying systems
using measurements containing colored noise,” IEEE Transactions on
Automatic Control, vol. 10, no. 1, pp. 4–10, 1965.
[4] A. Bryson Jr and L. Henrikson, “Estimation using sampled data
containing sequentially correlated noise.” Journal of Spacecraft and
Rockets, vol. 5, no. 6, pp. 662–665, 1968.
[5] K. J. Friston, N. Trujillo-Barreto, and J. Daunizeau, “Dem: a varia-
tional treatment of dynamic systems,” Neuroimage, vol. 41, no. 3, pp.
849–885, 2008.
[6] K. Friston, “The free-energy principle: a uniﬁed brain theory?” Nature
reviews neuroscience, vol. 11, no. 2, pp. 127–138, 2010.
[7] A. A. Meera and M. Wisse, “Free energy principle based state and
input observer design for linear systems with colored noise,” in 2020
American Control Conference (ACC) . IEEE, 2020, pp. 5052–5058.
[8] F. Bos, A. A. Meera, D. Benders, and M. Wisse, “Free energy principle
for state and input estimation of a quadcopter ﬂying in wind,” arXiv
preprint arXiv:2109.12052, 2021.
[9] K. Friston, “The free-energy principle: a rough guide to the brain?”
Trends in cognitive sciences , vol. 13, no. 7, pp. 293–301, 2009.
[10] K. J. Friston, J. Daunizeau, J. Kilner, and S. J. Kiebel, “Action and
behavior: a free-energy formulation,” Biological cybernetics, vol. 102,
no. 3, pp. 227–260, 2010.
[11] R. L. Carhart-Harris and K. J. Friston, “The default-mode, ego-
functions and free-energy: a neurobiological account of freudian
ideas,” Brain, vol. 133, no. 4, pp. 1265–1283, 2010.
[12] K. Friston, K. Stephan, B. Li, and J. Daunizeau, “Generalised ﬁlter-
ing,” Mathematical Problems in Engineering , vol. 2010, 2010.
[13] B. Li, J. Daunizeau, K. E. Stephan, W. Penny, D. Hu, and K. Friston,
“Generalised ﬁltering and stochastic dcm for fmri,” neuroimage,
vol. 58, no. 2, pp. 442–457, 2011.
[14] J.-J. Xiong and E.-H. Zheng, “Optimal kalman ﬁlter for state esti-
mation of a quadrotor uav,” Optik, vol. 126, no. 21, pp. 2862–2868,
2015.
[15] P. Lanillos, C. Meo, C. Pezzato, A. A. Meera, M. Baioumy, W. Ohata,
A. Tschantz, B. Millidge, M. Wisse, C. L. Buckley et al. , “Active
inference in robotics and artiﬁcial agents: Survey and challenges,”
arXiv preprint arXiv:2112.01871 , 2021.
[16] G. Oliver, P. Lanillos, and G. Cheng, “Active inference body
perception and action for humanoid robots,” arXiv preprint
arXiv:1906.03022, 2019.
[17] M. Baioumy, P. Duckworth, B. Lacerda, and N. Hawes, “Active
inference for integrated state-estimation, control, and learning,” in
2021 IEEE International Conference on Robotics and Automation
(ICRA). IEEE, 2021, pp. 4665–4671.
[18] A. A. Meera and M. Wisse, “A brain inspired learning algorithm for the
perception of a quadrotor in wind,” arXiv preprint arXiv:2109.11971,
2021.
[19] O. C ¸ atal, T. Verbelen, T. Van de Maele, B. Dhoedt, and A. Safron,
“Robot navigation as hierarchical active inference,” Neural Networks,
vol. 142, pp. 192–204, 2021.
[20] M. Baltieri and C. L. Buckley, “Pid control as a process of active
inference with linear generative models,” Entropy, vol. 21, no. 3, p.
257, 2019.
[21] M. Baltieri and T. Isomura, “Kalman ﬁlters as the steady-state so-
lution of gradient descent on variational free energy,” arXiv preprint
arXiv:2111.10530, 2021.
[22] C. L. Buckley, C. S. Kim, S. McGregor, and A. K. Seth, “The free
energy principle for action and perception: A mathematical review,”
Journal of Mathematical Psychology , vol. 81, pp. 55–79, 2017.
[23] K. Friston, J. Mattout, N. Trujillo-Barreto, J. Ashburner, and W. Penny,
“Variational free energy and the laplace approximation,” Neuroimage,
vol. 34, no. 1, pp. 220–234, 2007.
[24] A. Anil Meera and M. Wisse, “Dynamic expectation maximization al-
gorithm for estimation of linear systems with colored noise,” Entropy,
vol. 23, no. 10, p. 1306, 2021.
APPENDIX
A. Gradients of ln|˜Π|
The log determinant of generalized precision can be calculated using
Equations 4 and 5 as:
ln|˜Π|=ln|S ⊗Πz|+ln|S ⊗Πw|
=ln(|S|m|Πz|(p+1))+ ln(|S|n|Πw|(p+1))
=(p +1)(ln|Πz|+ln|Πw|)+( n +m)ln|S|.
(19)
The derivative of ln |˜Π|with respect to s becomes:
∂ ln|˜Π|
∂s = (n +m) ∂ ln|S|
∂s , ∂2 ln|˜Π|
∂s2 = (n +m) ∂2 ln|S|
∂s2 . (20)
From Equation 4, |S|= 512
6075 s42, resulting in ∂ ln|S|
∂s = 42
s and ∂2 ln|S|
∂s2 = −42
s2 .
This simpliﬁes Equation 20 to:
∂ ln|˜Π|
∂s = 42(n +m) 1
s , ∂2 ln|˜Π|
∂s2 = −42(n +m) 1
s2 . (21)
B. Numerical analysis on the nature of ˜εT ˜Π˜ε
We recorded the ﬁrst two gradients of the polynomial ˜εT ˜Π˜ε with respect
to s for 20,000 combinations of randomly sampled ˜ε and s such that
|˜ε|< 1 and s ∈(0,1]. From the results shown in Figure 8, the data points
predominantly lie on the ﬁrst quadrant, suggesting that the function has
positive gradients, which is a sign of monotonically increasing function.
The absence of any points on the fourth quadrant motivates the conclusion:
if ˜εT ˜Πs ˜ε > 0 then ˜εT ˜Πss ˜ε > 0. The results remain the same for different
norm lengths of ˜ε.
Fig. 8: The plot demonstrating that the function ˜εT ˜Π˜ε is mostly
monotonically increasing with respect to s in the domain (0,1] for
|˜ε|< 1. Moreover, when ˜εT ˜Πs ˜ε > 0, ˜εT ˜Πss ˜ε < 0, since there are
no data points on the fourth quadrant as shown in the zoomed plot.