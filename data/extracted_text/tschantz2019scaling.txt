Scaling active inference
Alexander Tschantz1,2
tschantz.alec@gmail.com
Manuel Baltieri2,3 Anil. K. Seth1,4
Christopher L. Buckley2
1Sackler Centre for Consciousness Science, University of Sussex, Brighton, UK
2Evolutionary and Adaptive Systems Research Group, University of Sussex, Brighton, UK
3RIKEN Centre for Brain Science, Saitama, Japan
4Canadian Institute for Advanced Research, University of Sussex, Brighton, UK
Abstract
In reinforcement learning (RL), agents often operate in partially observed and
uncertain environments. Model-based RL suggests that this is best achieved by
learning and exploiting a probabilistic model of the world. ‘Active inference’ is an
emerging normative framework in cognitive and computational neuroscience that
offers a unifying account of how biological agents achieve this. On this frame-
work, inference, learning and action emerge from a single imperative to maximize
the Bayesian evidence for a niched model of the world. However, implementations
of this process have thus far been restricted to low-dimensional and idealized situ-
ations. Here, we present a working implementation of active inference that applies
to high-dimensional tasks, with proof-of-principle results demonstrating efﬁcient
exploration and an order of magnitude increase in sample efﬁciency over strong
model-free baselines. Our results demonstrate the feasibility of applying active in-
ference at scale and highlight the operational homologies between active inference
and current model-based approaches to RL.
1 Introduction
In model-based reinforcement learning (RL), agents ﬁrst learn a predictive model of the world,
before using this model to determine actions [1]. Encoding a model of the world plausibly affords
several advantages. For instance, such models can be used to perform perceptual inference [2],
implement prospective control [3, 4], quantify and resolve uncertainty [5], and generalize existing
knowledge to new tasks and environments [6]. As such, the use of predictive models has been touted
as a potential solution to the sample inefﬁciencies of modern RL algorithms [7, 8].
At the same time, the theoretical framework of active inference has emerged in cognitive and com-
putational neuroscience as a unifying account of perception, action, and learning [9, 10]. Active
inference suggests that biological systems learn a probabilistic model of their habitable environment
and that the states of the system change to maximize the evidence for this model [11, 12]. The result-
ing scheme casts perception, action and learning as emergent processes of (approximate) Bayesian
inference, thereby offering a potentially unifying theory of adaptive biological systems. Despite
its strong theoretical foundations, existing computational implementations have been restricted to
low-dimensional tasks, often with discrete state spaces and actions [11, 10, 13, 14, 15]. Here, we
establish a formal connection between active inference and model-based RL. In doing so, we extend
practical implementations of active inference so that they work effectively at scale, and we situate
model-based RL within the broad theoretical context offered by active inference.
arXiv:1911.10601v1  [cs.LG]  24 Nov 2019
We present a model of active inference that is applicable in high-dimensional control tasks with
both continuous states and actions. Our model builds upon previous attempts to scale active in-
ference [16, 17, 18] by including an efﬁcient planning algorithm, as well as the quantiﬁcation and
active resolution of model uncertainty. Consistent with the active inference framework, learning and
inference are achieved by maximizing single lower bound on Bayesian model evidence, and policies
are selected to maximize a lower bound on expected Bayesian model evidence [11]. We demonstrate
that this uniﬁed normative scheme enables sample efﬁcient learning, strong performance on difﬁcult
control tasks, and a principled approach to active exploration. Moreover, we establish homologies
between our active inference based model and state-of-the-art approaches to model-based RL.
In what follows, we specify the general mathematical formulation of active inference, before de-
scribing our implementation, which is applicable in both partially-observed and fully-observed en-
vironments. We then present preliminary results in three challenging fully-observed continuous
control benchmarks, leaving the analysis of partially-observed environments (i.e. pixels) to future
work. These results demonstrate that our algorithm facilitates active exploration over long temporal
horizons and signiﬁcantly outperforms a strong model-free RL baseline, in terms of both sample
efﬁciency and performance.
2 Active inference
Following previous work [10, 11], we consider active inference in the context of a partially observed
Markov decision process (POMPD). At each time step t, the true state of the environment ˆ st ∈Rdˆs
evolves according to the stochastic transition dynamics ˆ st ∼ p(ˆ st|ˆ st−1,at−1), where a ∈ Rda
denotes an agent’s actions. Agents do not always have access to the true state of the environment,
but might instead receive observations ot ∈Rdo, which are generated according to ot ∼p(ot|ˆ st).
As such, agents must operate on beliefs st ∈Rds about the true state of the environmentˆ st. In what
follows, we denote the true dynamics with upright letters p(·) and a model of these dynamics (the
agent) with italics p(·).
Active inference proposes that agents implement and update a generative model of their world
p(˜o,˜s,π,θ ), where the tilde notation denotes a sequence of variables through time˜x = {x0,..., xT},
πdenotes a policy, π= {a0,..., aT}, and θ∈Θ denotes parameters of the generative model, which
are themselves random variables. Additionally, agents maintain a recognition distributionq(˜s,π,θ ),
representing an agent’s (approximately optimal) beliefs over states˜s, policies πand model parame-
ters θ.
As new observations are sampled, agents update the parameters of their recognition distribution to
minimize variational free energy F:
F(˜o) = Eq(˜s,π,θ)[ln q(˜s,π,θ ) −ln p(˜o,˜s,π,θ )]
≥−ln p(˜o) (1)
This makes the recognition distribution q(˜s,π,θ ) converge towards an approximation of the (in-
tractable) posterior distributionp(˜s,π,θ |˜o), thereby implementing a tractable form of (approximate)
Bayesian inference [19].
Crucially, active inference also proposes that an agent’s goals and desires are encoded in the genera-
tive model as prior preferences for favourable observations [12, 20], i.e. blood temperature at 37°C.
Free energy then provides a proxy for how surprising (i.e., unlikely) some observations are under the
agent’s model. While minimising Eq. 1 provides an estimate for how surprising some observations
are, it cannot reduce this quantity directly. To achieve this, agents must change their observations
through action. Acting to minimise variational free energy ensures the minimisation of surprisal
−ln p(˜o), or the maximisation of the (Bayesian)model evidence p(˜o), since free energy provides an
upper bound on surprisal. Active inference, therefore, proposes that agent’s select policies in order
to minimize expected free energy G[12], where the expected free energy for a given policy π at
some future time τ is:
G(π,τ) = Eq(oτ,sτ,θ|π)[ln q(sτ,θ|π) −ln p(oτ,sτ,θ|π)]
≥−Eq(oτ|π)
[
ln p(oτ|π)
] (2)
2
Expected free energy provides a bound on expected surprisal, and can be decomposed into extrinsic
value, which quantiﬁes the degree to which expected observations are congruent with an agent’s
prior beliefs, and intrinsic value, which quantiﬁes the amount of information an agent expects to
gain from enacting some policy [13, 11, 10]. This decomposition affords a natural interpretation:
to avoid being surprised, one should sample unsurprising data, but also learn about the world to
make data less surprising per se. Selecting policies that minimize Eq. 2 will, therefore, ensure that
probable (i.e. favourable, given an agent’s normative priors) observations are preferentially sampled,
while also ensuring that agents gather information about their environment.
3 Model
In cognitive and computational neuroscience, implementations of active inference agents generally
follow one of two approaches. The ﬁrst considers the generative model and recognition distribution
to be Gaussian under the Laplace approximation and prescribes gradient-descent updates that recur-
rently minimize free energy with each new observation [21, 22, 20]. While this approach is purported
as biologically plausible and enjoys empirical support under the guise of predictive coding [21, 23],
it is not clear how, or at least not straightforward, to extend this implementation to the prospective
free energy minimization discussed in Sec. 2. The second approach employs discrete distributions
(e.g., Categorical, Dirichlet) that are updated via variational message-passing [11]. While this ap-
proach provides an elegant framework for evaluating expected free energy, it can only be applied in
discrete state and action spaces, meaning it is not directly applicable to the high-dimensional states
and continuous actions considered in RL benchmarks.
In the current paper, we take an alternative approach and employ amortized inference [24], which
utilizes function approximators (i.e., neural networks) to parameterize distributions. Free energy is
then minimized with respect to the parameters of the function approximators, and not the variational
parameters themselves. We detail our generative model and recognition distribution in Sec. 3.1, how
learning and inference are implemented in Sec. 3.2, how policy selection and trajectory sampling
are implemented in Sec. 3.3 & Sec. 3.4, and how to evaluate expected free energy in section Sec.
3.5. Finally, we describe the implementation details for the fully-observed case in Sec. 3.6.
3.1 Generative model & recognition distribution
We consider a generative model p(˜o,˜s,π,θ ) over sequences of observations ˜o, hidden states ˜s,
policies πand parameters θ:
p(˜o,˜s,π,θ ) = p(θ)p(π)
T∏
t=1
p(ot|st)p(st|st−1,πt−1,θ)
p(ot|st) = N(ot; µλ,σ2
λ)
where [µλ,σ2
λ] = fλ(st)
p(st|st−1,πt−1,θ) = N(st; µθ,σ2
θ)
where [µθ,σ2
θ] = fθ(st−1,πt−1)
p(θ) = N(θ; 0,I)
p(π) = σ(−G(π))
(3)
where we have assumed that s0 is ﬁxed. In Eq. 3, we have parametrized both the likelihood dis-
tribution p(ot|st) and the transition distribution p(st|st−1,πt−1,θ) with function approximators.
Speciﬁcally, the likelihood distribution is described by a multivariate Gaussian distribution with a
mean and covariance parameterized by some (potentially non-linear) function approximator fλ(st),
while the prior distribution is described by a Gaussian with mean and variance parameterized by
some function approximator fθ(st−1,πt−1).
Amortizing the inference procedure offers several beneﬁts. For instance, the number of parameters
remains constant with respect to the size of the data and inference can be achieved through a single
forward pass of a network. Moreover, while the amount of information encoded about variables
is ﬁxed, the conditional relationship between variables can be arbitrarily complex. In Eq. 3, the
3
parameters of the transition distribution, θ, are themselves random variables. In the current context,
these parameters are the weights of the neural network fθ(st−1,πt−1). This approach allows the
uncertainty about these parameters to be quantiﬁed and casts learning as a process of (variational)
inference [25]. The prior probability of θ is given by a standard Gaussian, which acts as a regu-
larizer during learning. Although we have only considered distributions over the parameters of the
transition distribution θ, the same scheme could be applied to the parameters of the likelihood dis-
tribution, λ. Finally, the prior probability of policies is a softmax function of the negative expected
free energy of those policies −G(π) [11]. This formalizes the notion that policies are a-priori more
likely if they are expected to minimize free energy in the future [12].
To make active inference applicable to the kinds of tasks considered in RL, we treat reward signals
or as observations in a separate modality. Therefore, we extend the generative model to include an
additional scalar Gaussian over reward observations p(or
t|st) with unit variance and mean fα(st),
where fα(st) is a fully-connected neural network with parameters α.
We consider a recognition distribution q(˜s,π,θ ) over sequences of hidden states st, policies πand
parameters θ:
q(˜s,π,θ ) = q(θ)q(π)
T∏
t=0
q(st|ot)
q(θ) = N(θ; µξ,σ2
ξ)
q(π) = N(π; µψ,σ2
ψ)
q(st|ot) = N(st; µφ,σ2
φ)
where [µφ,σ2
φ] = fφ(ot)
(4)
The distribution q(st|ot) is a diagonal Gaussian with mean and variance parameterized by some
function approximator fφ(ot), while the the variational posterior over parameters θand policies π
are both diagonal Gaussians.
3.2 Learning & Inference
In order to implement learning, we derive the updates for ξ = {µξ,σ2
ξ}, φ, λand αthat minimize
free energy F. Given Eq. 3 and 4, the variational free energy Ffor a given time point t can be
deﬁned as:
Ft(ot,ξ,φ,λ,α ) =
Eθ∼q(θ)
[
Eq(st−1|ot−1)
[
DKL[q(st|ot)||p(st|st−1,πt−1,θ)]
]]
+ DKL
[
q(θ)||p(θ)
]
−Eq(st|ot)[ln p(ot|st)]
(5)
where we have followed [11] and omitted the additional term DKL[q(π)||p(π)] from the optimisa-
tion of ξ,φ,λ,α , allowing us to ignore the dependency between hidden states and (the prior prob-
ability of) policies. We optimise q(π) with respect to Fseparately, as described in the following
section.
Eq. 5 can be minimized with respect to ξ,φ,λ,α using stochastic gradient descent. Given some
observation ot, the negative log-likelihood (third term) can be calculated by mapping the observa-
tion to the variational parameters of q(st|ot), e.g., [µφ,σ2
φ] = fφ(ot). The reparameterization trick
[24] is then utilized to obtain a differentiable sample from q(st|ot)1, which is then passed through
fλ(st), giving the parameters of the likelihood distribution [µλ,σ2
λ]. The negative-log likelihood of
the observations is then calculated under this distribution. Next, the parameter divergence (second
term) is calculated analytically, as both distributions are fully factorized Gaussians. Finally, The
state divergence (ﬁrst term) is calculated by taking Ksamples from q(θ), again using the reparame-
terization trick. For each sample θ(i) in K, a reparameterized sample from the previous beliefs over
hidden states q(st−1|ot−1) is propagated through fθ(i) (st−1,πt−1) (where πt−1 refers to the action
1For a Gaussian N(x; µ,σ2), a reparameterized sample is obtained via x = µ+ σ⊙ϵ, where ϵ∼N(0,1)
4
that was taken at the previous time step), giving the parameters of the transition distribution. The
KL-divergence term is then analytically calculated for each sample in Kand averaged.
This procedure is carried out in batched fashion over the available data set. At test time, inference
can be achieved by directly mapping observations to the variational parameters using fφ(ot). This
approach to inferring hidden states is similar to that of a variational autoencoder [24], but here
the global prior has been replaced with a prior based on the transition distribution. Moreover, the
inference of parameters θ is homologous to the Bayesian neural network approach to parameter
learning [25].
Deriving updates for all parameters through a single (variational) objective function offers several
potential beneﬁts. First, the learned latent space is forced to balance between the compression of ob-
servations and (action-conditioned) temporal transitions. This is in contrast to ‘modular’ approaches,
whereby a latent space is ﬁrst learned to compress observations, and subsequently, a transition model
is learned in this ﬁxed latent space [2]. Moreover, this approach allows the quantiﬁcation of uncer-
tainty in both hidden states and model parameters, thereby quantifying both aleatoric and epistemic
uncertainty [26, 27].
3.3 Policy selection
Under active inference, policy selection is achieved by updating q(π) in order to minimize free
energy F. Given the prior belief that policies minimize expected free energy, i.e.,p(π) = σ(−G(π))
(as speciﬁed in Eq. 3), free energy is minimized when q(π) = σ(−G(π)) [11]. For discrete action
spaces with short temporal horizons, G(π) can be evaluated in full by considering each possible
policy [10]. However, in continuous action spaces, there are inﬁnite policies, meaning an alternative
approach is required.
In the current work, we treat q(π) as a diagonal Gaussian with parameters ψ = {µψ,σ2
ψ}. At each
time step, we optimise ψsuch that q(π) ∝−G(π). While this solution will fail to capture the exact
shape of −G(π), agents need only identify the peak of the landscape to enact the optimal policy. To
optimise the parameters of q(π), we utilise the cross-entropy method (CEM) [6, 3]. At each time
step t, we consider policies of a ﬁxed horizon H, using notation πt:t+H = {at,..., at+H}. The
distribution over policies is initialized as q(πt:t+H) ←N(πt:t+H; 0,I) and optimized as follows:
(i) Sample N policies from q(πt:t+H)
(ii) Evaluate −G(πt:t+H) for each sample πt:t+H (described in the following section), return-
ing a scalar value
(iii) Reﬁt q(πt:t+H) to the top M samples
This procedure is carried out I times, after which the mean of the belief for the current time step
at = E[q(πt:t+H
t )] is returned. Moreover, this procedure is carried out after each new observation.
For the current experiments, H = 12, N = 1000, M = 100 and I = 10.
This process of model predictive control [28] was selected for consistency with previous computa-
tional models of active inference [10], where a distribution over policies is updated after each new
observation. Alternative approaches include optimizing a parametrized policy with respect to past
evaluations of expected free energy [16]. However, this approach is not suited for non-stationary ob-
jective functions or active exploration [5]. Alternatively, a parametrized policy could be optimized
with respect to imagined rollouts from a transition model [6], whichwould enable active exploration
[5]. The effectiveness of these approaches depends on the complexity of the value function relative
to the transition dynamics [29], as well as the stationarity of the value function.
3.4 Trajectory sampling
To evaluate the expected free energy for a given policy −G(π), it is ﬁrst necessary to evaluate the
expected future beliefs conditioned on that policy q(˜st:t+H,˜ot:t+H|π). The fact that the transition
model is probabilistic, and the parameters of the transition model are random variables, induces a
distribution over future trajectories [11]. Several approaches exist to approximate the propagation of
uncertain trajectories [3]. For instance, one can ignore uncertainty entirely and propagate the mean
of the distributions, or one can explicitly propagate the full statistics of the distribution [30]. In the
5
current work, we utilise a particle approach [3, 6], whereby a set of Monte Carlo samples are prop-
agated. In particular, we consider B samples from the parameter distribution θ(i) ∼q(θ), and for
each sample in B, propagate J samples through the transition model s(j)
t ∼p(st|st−1,πt−1,θ(i)).
To infer observations and rewards, we pass all samples through the respective model and average.
3.5 Expected free energy
In this section we describe how to evaluate −G(π), where we have used π = πt:t+H for notational
convenience. The negative expected free energy for a policy is equal to the sum of negative expected
free energies over time, −G(π) = ∑t+H
τ=t −G(π,τ), where
−G(π,τ) ≈Eq(orτ|π)[ln p(or
τ)]
  
Extrinsic value
+ H[q(oτ|π)] −Eq(sτ|π)
[
H[q(oτ|sτ,π)]
]
  
State information gain
+ H[q(sτ|π)] −Eq(θ)
[
H[q(sτ|π,θ)]
]
  
Parameter information gain
(6)
We refer to [10] for a derivation of Eq. 6. The ﬁrst term ( extrinsic value) quantiﬁes the degree
to which the expected observations q(or
τ|π) are congruent with the agent’s prior beliefs (i.e., pref-
erences) p(or
t). Note that in active inference, there is no intrinsic delineation of reward signals -
all observations are assigned some a-priori probability. However, as RL environments specify a
distinct reward signal, we have deﬁned the agent’s prior preferences over reward observations or
only. Moreover, as RL environments are constructed such that agents wish to simply maximize the
sum of rewards (rather than obtain any particular reward observation), we evaluate extrinsic value
as or
τ ∼q(oτ|π), such that extrinsic value increases as larger rewards are predicted. We refer the
reader to [18] for an alternative formulation where agent’slearn a speciﬁc prior distribution.
The second term (state information gain) quantiﬁes the expected reduction in uncertainty in beliefs
over hidden states q(sτ). In other words, it promotes agents to sample data in order to resolve
uncertainty about the hidden state of the environment. This term is formally equivalent to a number
of established quantities, such as (expected) Bayesian surprise, mutual information, and the expected
reduction in posterior entropy [11, 31], and has been used to describe various epistemic foraging
behaviors, such as saccades [32, 33, 34, 35] and sentence comprehension [15]. In the current paper,
we conduct experiments in fully observed environments, and as such, do not consider the state
information gain term in our analysis.
The ﬁnal term ( parameter epistemic value) quantiﬁes the expected reduction in uncertainty in be-
liefs over parameters q(θ), and promotes agents to actively explore the environment in order to
resolve uncertainty in their model [36, 14]. In order to evaluate parameter epistemic value, we use
a nearest neighbor estimate of the entropies [27, 37]. In other words, we estimate the entropy via
spatial properties of samples from the relevant distributions. Speciﬁcally, we estimate the entropy
as H[p(x)] = 1
n
∑n
i=1 ln (nρn,i) + ln 2 +CE, where nis the number of samples from the distribu-
tion, ρn,i is the nearest neighbor distance of a sample xi from other samples xj and CE is the Euler
constant. Alternatively, parameter epistemic value could be rewritten as the (expected) Bayesian sur-
prise of the distribution over parameters and then calculated analytically [38, 39, 34, 35]. However,
this requires doing ﬁctive updates to the parameter distribution, which is computationally expensive
when conducted for each candidate policy at each time step.
3.6 Fully observed model
The model presented in the preceding sections serves as the most general formulation, applicable in
both partially-observed and fully-observed environments. In what follows, we describe an imple-
mentation for the fully-observed case, leaving an analysis of the partially-observed case for future
work.
6
To adapt the generative model for fully-observed environments, we utilise a ﬁxed identity covariance
for the likelihood distribution p(ot|st), and parameterize the mean as µλ = fλ(st) = E[st], thereby
encoding the belief that there is a direct mapping between states and observations. For the transition
distribution p(st|st−1,πt−1,θ), we parameterize the mean as fθ(st−1,πt−1) and utilize a ﬁxed unit
variance. In all experiments, fθ(st−1,πt−1) is a feed-forward network with two fully connected
layers of size 500 with ReLU activations, which deﬁnes the dimensionality of p(θ) and q(θ).
Note that by treating the variance of the transition distribution as ﬁxed, the evaluation of parame-
ter epistemic value is signiﬁcantly simpliﬁed. Speciﬁcally, the second entropy term in parameter
epistemic value becomes constant under policies, such that we need only evaluate the ﬁrst entropy
term H[q(sτ|π)] = H[Eq(θ)[q(sτ|π,θ)]]. We use 5 samples from q(θ) to evaluate the expectation
in this entropy term throughout. Finally, we treat the variance of q(st|ot) as a ﬁxed unit parameter
and parameterize the mean as µφ = fφ(ot) = ot, thereby encoding the belief that there is a direct
mapping between observations and states. Note that this means that the parameters of λand φare
ﬁxed and are thus excluded from the optimisation scheme.
4 Experiments
In this section, we investigate (i) whether the proposed active inference model can successfully
promote exploration in the absence of reward observations (i.e. exploration), and (ii) whether the
model can achieve good performance and high sample efﬁciency on challenging continuous control
tasks (i.e. exploitation). We evaluate these two aspects of the model separately, leaving analysis of
their joint performance (i.e. the exploration-exploitation dilemma) to future work.
We utilise the following learning scheme for both the exploration and exploitation experiments. We
initialize the data set with 5 seed episodes collected under random actions. For each iteration of the
experiment, we train the agent’s model via Eq. 5 with 100 batches randomly sampled from the data
set, using a batch size of 50. Agents then collect data from the environment until the episode ends
(when the maximum number of steps is reached, or when agent the agent reaches a terminal state).
4.1 Exploration
To test whether the active inference model enables efﬁcient exploration, we explore the state space
visited by different algorithms in the continuous MountainCar environment (O∈ R2,A∈ R1). We
compare the active inference model to two algorithms, (i) a ‘reward’ agent which operates via the
same scheme, but only selects actions based on extrinsic value, and (ii) and anϵ-greedy agent which
selects action based on extrinsic value, but additionally adds Gaussian exploration noise (σ2 = 0.3)
to each action. Agents learn and act in the environment for 100 epochs. The cumulative coverage
of state space is plotted in Fig. 1. These results demonstrate that the active inference agent can
effectively explore more of the state space, relative to the other algorithms.
Figure 1: Comparison of exploration strategies. (A) The cumulative state-space coverage after
100 epochs for the reward agent. (B) The cumulative state-space coverage after 100 epochs for the
ϵ-greedy agent. (C) The cumulative state-space coverage after 100 epochs for the active inference
agent. These results demonstrate that the active inference agent explores more of the state space,
relative to the other exploration strategies.
7
4.2 Exploitation
Next, we investigate whether the active inference agent can achieve good performance on continuous
control tasks. We explore performance in the inverted pendulum task ( O∈ R3, A∈ R1) and the
more challenging hopper task (S∈ R15, A∈ R3). The performance of our model is compared to a
strong model-free baseline, DDPG [40].
As both environments have well-shaped rewards, we only consider the exploitation component (ex-
trinsic value) of the expected free energy objective function, ignoring the exploration component
(epistemic value). As such, we utilise a point-estimate version of the model, thus removing the dis-
tributions over parameters. To retain stochasticity in the transition model, we parameterize both the
mean and variance of the transition distribution using a function approximator (as opposed to just the
mean), and ﬁx the variance of the recognition distribution to 0.1. Moreover, following [6], we use
an action repeat of 3 for all algorithms, enabling shorter planning horizons and a more pronounced
learning signal.
In Fig. 2, we plot the performance of both algorithms as a function of the number of epochs. We
show the mean performance over a ﬁxed set of 5 random seeds and the shaded lines shown the
95% interquartile range at each epoch. These results demonstrate that the active inference agent can
achieve strong performance in under 100 epochs on both tasks, demonstrating an order of magnitude
better sample efﬁciency compared to the model-free baseline.
Figure 2: Comparison of Performance on two continuous control tasks. (A) Average returns
over 1500 epochs on the inverted pendulum task for the active inference agent and the model-free
DDPG agent. (B) Average returns over 1500 epochs on the hopper task for the active inference
agent and the model-free DDPG agent. Note that for A & B, we stopped the active inference agent
after 100 epochs due to convergence. (C & D) A zoomed-in view of ﬁgures A & B, showing a
more ﬁne-grained view of the active inference agent’s progression over 100 epochs. For all ﬁgures,
the ﬁlled lines represent the mean of 5 random seeds, whereas the shaded areas denote the 95%
interquartile range. Together, these results demonstrate that the active inference agent can learn
difﬁcult continuous control tasks, with a far greater sample efﬁciency, relative to a strong model-
free baseline.
5 Previous work
Deep active inference Previous work has explored the prospect of scaling active inference using
amortized inference. In [17], the authors parameterized both the generative model and recognition
distribution with function approximators and used evolutionary strategies to optimise the free energy
functional when gradients were not available. Similarly, [16] utilized amortization to parametrize
distributions and also amortized action by learning a parameterized approximation of the expected
free energy bound. Finally, [18] extended previous work to include a speciﬁc planning component
8
based on CEM. The authors focused on the problem of learning the prior distribution over reward
observations p(or) and demonstrated this could be implemented in a learning-from-example frame-
work.
Our work builds upon these previous models by incorporating model uncertainty and its active res-
olution. In other words, we extend the previous point-estimate models to include full distributions
over parameters and update the expected free energy functional such that the uncertainty in these dis-
tributions is actively minimized. This brings our implementation in line with the canonical models of
active inference from the cognitive and computational neuroscience literature [12]. Moreover, it en-
ables us to evaluate the feasibility of active exploration under the scaled active inference framework,
apply the model to more complex control tasks, and obtain increased sample efﬁciency, relative to
previous models.
Model-based RL The model presented in the current work bears a number of resemblances with
model-based approaches to RL. First, variational autoencoders have been used extensively to map
observations into a compressed latent space, thereby simplifying the problem of action selection and
the process of learning a forward transition model [2, 6, 41, 42, 43, 39, 44]. Moreover, the CEM
algorithm is a popular method for implementing planning in model-based RL [6, 3, 45]. Recent
work has additionally highlighted the importance of using a probabilistic dynamics model in order to
capture epistemic uncertainty [3, 6, 7, 46, 47, 48]. The success of these approaches has demonstrated
that deterministic models are prone to model bias, which can lead to overﬁtting in low data regimes.
Most approaches either utilize Bayesian neural networks [27], ensembles of deterministic networks
[3], dropout [46] or Gaussian processes [30] in order to capture uncertainty. In the current work, we
opted for Bayesian neural networks to ensure consistency with the variational principles espoused
by the active inference framework, but note that ensembles can be made explicitly Bayesian with
minor modiﬁcations [49].
Information gain Identifying scalable and efﬁcient exploration strategies remains one of the key
open questions in RL. Model-free methods, such as ϵ-greedy or Boltzmann choice rules [50], utilise
noise in the action selection process or uncertainty in the reward statistics [51, 52].
A more powerful approach [53] is to construct a model of the world, allowing the agent to evaluate
which parts of state space it has (and has not) visited. For instance, [54] construct a pseudo-count
measure for estimating state visitation frequency in continuous state spaces. Alternatively, an ex-
plicit forward model of the transition dynamics can be learned. This allows for measures such as the
amount of prediction error [55, 56, 57, 58] or prediction error improvement [59] to be utilized for
exploration.
If the learned model (implicitly or explicitly) captures probabilistic features then information-
theoretic measures can be used to guide exploration (see [60] for a review). In [61], the authors
derived an information-theoretic measure to maximize the predictive power of the agent, while in
[62], the authors derived an objective function to maximize the mutual information between actions
and future states of the environment (i.e., empowerment).
Of particular relevance to the current work is the use of information gain to promote exploration,
which has been demonstrated to outperform alternative measures such as prediction error [63]. From
a theoretical perspective, information gain helps overcome what is known as the "TV-problem" [34],
where (unpredictable) noise in the environment is mistakenly treated as epistemically valuable. This
is because information gain considers the amount of information provided for beliefs, as opposed to
the amount of information provided by the signal per se.
Information gain can be traced back to [64], who used it to quantify the amount of information
to be gained from some experiment. [65] developed a Bayesian framework in order to maximize
information gain via dynamic programming, however, the experiments were limited to discrete state
spaces using tabular MDPs. In [38], the authors utilized Bayesian neural networks to quantify the
amount of information gained from some (action-conditioned) transition. This work was further
extended in [39], where the amount of information gain was quantiﬁed with respect to a latent
dynamics model.
In parallel with the current work, [5] looked to maximize expected information gain, which entails
an active approach to exploration. This is in contrast to the majority of exploration strategies in RL,
which are reactive, in the sense that they must ﬁrst observe an informative state before being able to
9
gather information [5]. This can lead to problems of over-commitment, whereby informative parts
of state space must be unlearned once the relevant information has been gathered. However, [5]
optimized expected information gain ofﬂine, whereas the current model uses an online approach.
Finally, The use of nearest-neighbour entropy estimators for information gain has been explored in
[66, 27].
6 Discussion & Conclusion
We have presented a model of active inference that can scale to continuous control tasks, complex
dynamics and high-dimensional state spaces. The presented model can be trained via a single ob-
jective function, expected free energy, that captures both epistemic and aleatoric uncertainty, and
prescribes both goal-directed and information-gathering behaviour via a single normative drive.
Our model makes two primary contributions. First, we showed that the full active inference con-
struct can be scaled to the kinds of tasks considered in the RL literature. This involved extending
previous models of deep active inference to include model uncertainty and expected information
gain. Second, we highlighted the overlap between active inference and state-of-the-art approaches to
model-based RL. These include the use of variational inference for the compression of observations,
the use of variational inference for learning distributions over parameters, the use of probabilistic
models of dynamics, the use of prospective planning in latent space, and the active resolution of
uncertainty.
While active inference deﬁned the properties of living systems from ﬁrst principles [12], and model-
based RL has attempted to engineer adaptive agents through the most effective means available,
both perspectives have converged on similar solutions. Our work has exploited this convergence
to show that active inference provides a principled and uniﬁed theoretical framework in which to
contextualize the various developments in model-based RL. This perspective by itself offers little
practical beneﬁt. However, active inference offers two potentially novel perspectives from which
model-based RL can beneﬁt. The ﬁrst is casting reward as (prior) probabilities. This provides
a principled framework for learning reward structure (i.e., reward shaping), for assigning rewards
(i.e., probability) across multiple observation modalities [67], and for learning-from-demonstration
[18]. The second perspective is casting both exploration and exploitation as two components of a
single imperative to maximize expected Bayesian model evidence. This perspective has the potential
to recast the exploration-exploitation dilemma as a problem of optimising parameters in order to
maximise model evidence. We leave a practical investigation of this perspective to future work.
7 Acknowledgements
AT is funded by a PhD studentship from the Dr. Mortimer and Theresa Sackler Foundation and the
School of Engineering and Informatics at the University of Sussex. CLB is supported by BBRSC
grant number BB/P022197/1. MB acknowledges support as an International Research Fellow of
the Japan Society for the Promotion of Science. AT and AKS are grateful to the Dr. Mortimer and
Theresa Sackler Foundation, which supports the Sackler Centre for Consciousness Science. AKS is
additionally grateful to the Canadian Institute for Advanced Research (Azrieli Programme on Brain,
Mind, and Consciousness).
References
[1] Christopher G. Atkeson and Juan Carlos Santamaria. A comparison of direct and model-based
reinforcement learning. In In International Conference on Robotics and Automation , pages
3557–3564. IEEE Press, 1997.
[2] David Ha and Jürgen Schmidhuber. Recurrent world models facilitate policy evolution.
arXiv:1809.01999 [cs, stat], 2018.
[3] Kurtland Chua, Roberto Calandra, Rowan McAllister, and Sergey Levine. Deep reinforcement
learning in a handful of trials using probabilistic dynamics models. arXiv:1805.12114 [cs,
stat], 2018.
[4] Julian Schrittwieser, Ioannis Antonoglou, Thomas Hubert, Karen Simonyan, Laurent Sifre,
Simon Schmitt, Arthur Guez, Edward Lockhart, Demis Hassabis, Thore Graepel, Timothy
10
Lillicrap, and David Silver. Mastering atari, go, chess and shogi by planning with a learned
model. arXiv:1911.08265 [cs, stat], 2019.
[5] Pranav Shyam, Wojciech Ja ´skowski, and Faustino Gomez. Model-based active exploration. In
International Conference on Machine Learning, pages 5779–5788, 2019.
[6] Danijar Hafner, Timothy Lillicrap, Ian Fischer, Ruben Villegas, David Ha, Honglak Lee, and
James Davidson. Learning latent dynamics for planning from pixels. arXiv:1811.04551 [cs,
stat], 2018.
[7] M. P. Deisenroth and C. E. Rasmussen. PILCO: A model-based and data-efﬁcient approach
to policy search. In 28th International Conference on Machine Learning (ICML 2011). IMLS,
2011.
[8] Jürgen Schmidhuber. Making the world differentiable: On using self-supervised fully recurrent
neural networks for dynamic reinforcement learning and planning in non-stationary environ-
ments, 1990.
[9] Karl Friston. The free-energy principle: a uniﬁed brain theory? Nature Reviews Neuroscience,
11(2):127–138, 2010.
[10] Karl Friston, Thomas FitzGerald, Francesco Rigoli, Philipp Schwartenbeck, and Giovanni Pez-
zulo. Active inference: A process theory. Neural Computation, 29(1):1–49, 2017.
[11] Karl Friston, Francesco Rigoli, Dimitri Ognibene, Christoph Mathys, Thomas Fitzgerald, and
Giovanni Pezzulo. Active inference and epistemic value. Cognitive Neuroscience, 6(4):187–
214, 2015.
[12] Karl Friston. A free energy principle for a particular physics. 2019.
[13] Karl J. Friston, Marco Lin, Christopher D. Frith, Giovanni Pezzulo, J. Allan Hobson, and Sasha
Ondobaka. Active inference, curiosity and insight. Neural Computation, 29(10):2633–2683,
2017.
[14] Karl J. Friston, Marco Lin, Christopher D. Frith, Giovanni Pezzulo, J. Allan Hobson, and Sasha
Ondobaka. Active inference, curiosity and insight. Neural Computation, 29(10):2633–2683,
2017.
[15] Karl J. Friston, Richard Rosch, Thomas Parr, Cathy Price, and Howard Bowman. Deep tempo-
ral models and active inference. Neuroscience & Biobehavioral Reviews, 90:486–501, 2018.
[16] Beren Millidge. Deep active inference as variational policy gradients. arXiv:1907.03876 [cs],
2019.
[17] Kai Ueltzhöffer. Deep active inference. Biological Cybernetics, 112(6):547–573, 2018.
[18] Ozan Çatal, Johannes Nauta, Tim Verbelen, Pieter Simoens, and Bart Dhoedt. Bayesian policy
selection using active inference. arXiv:1904.08149 [cs], 2019.
[19] David M. Blei, Alp Kucukelbir, and Jon D. McAuliffe. Variational inference: A review for
statisticians. Journal of the American Statistical Association, 112(518):859–877, 2017.
[20] Manuel Baltieri and Christopher L Buckley. Pid control as a process of active inference with
linear generative models. Entropy, 21(3):257, 2019.
[21] Karl Friston and Stefan Kiebel. Predictive coding under the free-energy principle. Philo-
sophical Transactions of the Royal Society of London. Series B, Biological Sciences ,
364(1521):1211–1221, 2009.
[22] Christopher L. Buckley, Chang Sub Kim, Simon McGregor, and Anil K. Seth. The free en-
ergy principle for action and perception: A mathematical review. Journal of Mathematical
Psychology, 81:55–79, 2017.
[23] Andy Clark. Whatever next? predictive brains, situated agents, and the future of cognitive
science. The Behavioral and Brain Sciences, 36(3):181–204, 2013.
[24] Diederik P. Kingma and Max Welling. Auto-encoding variational bayes. arXiv:1312.6114 [cs,
stat], 2013.
[25] Charles Blundell, Julien Cornebise, Koray Kavukcuoglu, and Daan Wierstra. Weight uncer-
tainty in neural networks. arXiv:1505.05424 [cs, stat], 2015.
11
[26] Stefan Depeweg, José Miguel Hernández-Lobato, Finale Doshi-Velez, and Steffen Udluft. De-
composition of uncertainty in bayesian deep learning for efﬁcient and risk-sensitive learning.
arXiv:1710.07283 [cs, stat], 2017.
[27] Stefan Depeweg, José Hernández-Lobato, Finale Doshi-Velez, and Steffen Udluft. Decom-
position of uncertainty for active learning and reliable reinforcement learning in stochastic
systems. 2017.
[28] Eduardo F. Camacho and Carlos Bordons Alba. Model Predictive Control. Advanced Text-
books in Control and Signal Processing. Springer-Verlag, 2 edition, 2007.
[29] Kefan Dong, Yuping Luo, and Tengyu Ma. Bootstrapping the expressivity with model-based
planning. arXiv:1910.05927 [cs, stat], 2019.
[30] Marc Peter Deisenroth, Dieter Fox, and Carl Edward Rasmussen. Gaussian processes for data-
efﬁcient learning in robotics and control. IEEE Transactions on Pattern Analysis and Machine
Intelligence, 37(2):408–423, 2015.
[31] Alexander Tschantz, Anil K. Seth, and Christopher L. Buckley. Learning action-oriented mod-
els through active inference. bioRxiv, page 764969, 2019.
[32] Thomas Parr and Karl J. Friston. The discrete and continuous brain: From decisions to move-
ment—and back again. Neural Computation, 30(9):2319–2347, 2018.
[33] Scott Cheng-Hsin Yang, Máté Lengyel, and Daniel M Wolpert. Active sensing in the catego-
rization of visual patterns. eLife, 5, 2019.
[34] Laurent Itti and Pierre Baldi. Bayesian surprise attracts human attention. Vision Research,
49(10):1295–1306, 2009.
[35] M. Berk Mirza, Rick A. Adams, Karl Friston, and Thomas Parr. Introducing a bayesian model
of selective attention based on active inference. Scientiﬁc Reports, 9(1):1–22, 2019.
[36] Philipp Schwartenbeck, Johannes Passecker, Tobias U Hauser, Thomas HB FitzGerald, Martin
Kronbichler, and Karl J Friston. Computational mechanisms of curiosity and goal-directed
exploration. eLife, 8:e41703, 2019.
[37] J. Beirlant, E. J. Dudewicz, and L. Györﬁ. Nonparametric entropy estimation: An overview.
International Journal of Mathematical and Statistical Sciences, 6, 1997.
[38] Rein Houthooft, Xi Chen, Yan Duan, John Schulman, Filip De Turck, and Pieter Abbeel.
VIME: Variational information maximizing exploration. arXiv:1605.09674 [cs, stat], 2016.
[39] Trevor Barron, Oliver Obst, and Heni Ben Amor. Information maximizing exploration with a
latent dynamics model. arXiv:1804.01238 [cs, stat], 2018.
[40] Timothy P. Lillicrap, Jonathan J. Hunt, Alexander Pritzel, Nicolas Heess, Tom Erez, Yuval
Tassa, David Silver, and Daan Wierstra. Continuous control with deep reinforcement learning.
arXiv:1509.02971 [cs, stat], 2019.
[41] Maximilian Igl, Luisa Zintgraf, Tuan Anh Le, Frank Wood, and Shimon Whiteson. Deep
variational reinforcement learning for POMDPs. arXiv:1806.02426 [cs, stat], 2018.
[42] Maximilian Karl, Maximilian Soelch, Justin Bayer, and Patrick van der Smagt. Deep
variational bayes ﬁlters: Unsupervised learning of state space models from raw data.
arXiv:1605.06432 [cs, stat], 2016.
[43] Lukasz Kaiser, Mohammad Babaeizadeh, Piotr Milos, Blazej Osinski, Roy H. Campbell, Kon-
rad Czechowski, Dumitru Erhan, Chelsea Finn, Piotr Kozakowski, Sergey Levine, Afroz Mo-
hiuddin, Ryan Sepassi, George Tucker, and Henryk Michalewski. Model-based reinforcement
learning for atari. arXiv:1903.00374 [cs, stat], 2019.
[44] Manuel Watter, Jost Tobias Springenberg, Joschka Boedecker, and Martin Riedmiller. Em-
bed to control: A locally linear latent dynamics model for control from raw images.
arXiv:1506.07365 [cs, stat], 2015.
[45] Anusha Nagabandi, Gregory Kahn, Ronald S. Fearing, and Sergey Levine. Neural net-
work dynamics for model-based deep reinforcement learning with model-free ﬁne-tuning.
arXiv:1708.02596 [cs], 2017.
[46] Yarin Gal, Rowan McAllister, and Carl Edward Rasmussen. Improving PILCO with bayesian
neural network dynamics models. In Data-Efﬁcient Machine Learning workshop, 2016.
12
[47] Gregory Kahn, Adam Villaﬂor, Vitchyr Pong, Pieter Abbeel, and Sergey Levine. Uncertainty-
aware reinforcement learning for collision avoidance. arXiv:1702.01182 [cs], 2017.
[48] Tung-Long Vuong and Kenneth Tran. Uncertainty-aware model-based policy optimization.
arXiv:1906.10717 [cs, math, stat], 2019.
[49] Tim Pearce, Nicolas Anastassacos, Mohamed Zaki, and Andy Neely. Bayesian inference with
anchored ensembles of neural networks, and application to exploration in reinforcement learn-
ing. arXiv:1805.11324 [cs, stat], 2018.
[50] Richard S. Sutton and Andrew G. Barto. Introduction to Reinforcement Learning. MIT Press,
1st edition, 1998.
[51] Shipra Agrawal and Navin Goyal. Analysis of thompson sampling for the multi-armed bandit
problem. arXiv:1111.1797 [cs], 2012.
[52] Maarten Speekenbrink and Emmanouil Konstantinidis. Uncertainty and exploration in a rest-
less bandit problem. Topics in Cognitive Science, 7(2):351–367, 2015.
[53] Ian Osband, Benjamin Van Roy, and Zheng Wen. Generalization and exploration via random-
ized value functions. arXiv:1402.0635 [cs, stat], 2016.
[54] Marc G. Bellemare, Sriram Srinivasan, Georg Ostrovski, Tom Schaul, David Saxton, and Remi
Munos. Unifying count-based exploration and intrinsic motivation. arXiv:1606.01868 [cs,
stat], 2016.
[55] Bradly C. Stadie, Sergey Levine, and Pieter Abbeel. Incentivizing exploration in reinforcement
learning with deep predictive models. arXiv:1507.00814 [cs, stat], 2015.
[56] Sebastian B. Thrun. Efﬁcient exploration in reinforcement learning, 1992.
[57] Nuttapong Chentanez, Andrew G. Barto, and Satinder P. Singh. Intrinsically motivated re-
inforcement learning. In L. K. Saul, Y . Weiss, and L. Bottou, editors, Advances in Neural
Information Processing Systems 17, pages 1281–1288. MIT Press, 2005.
[58] Jean-Arcady Meyer and Stewart W. Wilson. A possibility for implementing curiosity and
boredom in model-building neural controllers. In From Animals to Animats: Proceedings of
the First International Conference on Simulation of Adaptive Behavior. MITP, 1991.
[59] Manuel Lopes, Tobias Lang, Marc Toussaint, and Pierre-yves Oudeyer. Exploration in model-
based reinforcement learning by empirically estimating learning progress. In F. Pereira, C. J. C.
Burges, L. Bottou, and K. Q. Weinberger, editors,Advances in Neural Information Processing
Systems 25, pages 206–214. Curran Associates, Inc., 2012.
[60] Arthur Aubret, Laetitia Matignon, and Salima Hassas. A survey on intrinsic motivation in
reinforcement learning. arXiv:1908.06976 [cs], 2019.
[61] Susanne Still and Doina Precup. An information-theoretic approach to curiosity-driven rein-
forcement learning. Theory in Biosciences = Theorie in Den Biowissenschaften , 131(3):139–
148, 2012.
[62] Shakir Mohamed and Danilo Jimenez Rezende. Variational information maximisation for in-
trinsically motivated reinforcement learning. arXiv:1509.08731 [cs, stat], 2015.
[63] Todd Hester and Peter Stone. Intrinsically motivated model learning for developing curious
robots. Artiﬁcial Intelligence, 247:170–186, 2017.
[64] D. V . Lindley. On a measure of the information provided by an experiment. The Annals of
Mathematical Statistics, 27(4):986–1005, 1956.
[65] Yi Sun, Faustino Gomez, and Juergen Schmidhuber. Planning to be surprised: Optimal
bayesian exploration in dynamic environments. arXiv:1103.5708 [cs, stat], 2011.
[66] Atanas Mirchev, Baris Kayalibay, Maximilian Soelch, Patrick van der Smagt, and Justin Bayer.
Approximate bayesian inference in spatial environments. arXiv:1805.07206 [cs, stat], 2018.
[67] Keno Juechems and Christopher Summerﬁeld. Where does value come from? Trends in
Cognitive Sciences, 23(10):836–850, 2019.
13