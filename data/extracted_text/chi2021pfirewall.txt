PF : Semantics-Aware Customizable Data
IREWALL
Flow Control for Smart Home Privacy Protection
Haotian Chi Qiang Zeng Xiaojiang Du Lannan Luo
Temple University University of South Carolina Temple University University of South Carolina
htchi@temple.edu Zeng1@cse.sc.edu dux@temple.edu lluo@cse.sc.edu
Abstract—Internet of Things (IoT) platforms enable users to To support home automation, many IoT devices continu-
deploy home automation applications. Meanwhile, privacy issues ously stream data, such as sensor events, to an IoT platform,
arise as large amounts of sensitive device data flow out to IoT although most of the data actually do not trigger automation
platforms. Most of the data flowing to a platform actually do actions. This deviates the principle of “data minimisation” in
nottriggerautomationactions,whilehomeownerscurrentlyhave
European General Data Protection Regulation (GDPR) [23].
no control once devices are bound to the platform. We present
We also find that no capabilities are provided for users to
PFIREWALL,acustomizabledata-flowcontrolsystemtoenhance
control the leakage of device data to the platform, failing
the privacy of IoT platform users. PFIREWALL automatically
to realize user-centric authorization. Therefore, we seek a
generates data-minimization policies, which only disclose mini-
mum amount of data to fulfill automation. In addition, PFIRE- privacy-enhancing system that can be used as an “add-on”
WALLprovidesinterfacesforhomeownerstocustomizeindividual into existing systems by privacy-conscious users. This system
privacypreferencesbydefininguser-specifiedpolicies.Toenforce aims to 1) minimize the data sent to the platform and 2)
thesepolicies,PFIREWALLtransparentlyintervenesandmediates allow users to define customizable data-protection policies for
thecommunicationbetweenIoTdevicesandtheplatform,without individual privacy preferences. Multiple challenges arise for
modifyingtheplatform,IoTdevices,orhub.Evaluationresultson attaining these goals.
fourreal-worldtestbedsshowthatPFIREWALLreducesIoTdata
senttotheplatformby97%withoutimpairinghomeautomation,
Challenge 1. Data minimization should not affect home au-
and effectively mitigates user-activity inference/tracking attacks
tomation. We observe that the semantics of home automa-
and other privacy risks.
tion apps can be represented as rules in a trigger-condition-
action programming paradigm (code analysis [24], [25], [10]
I. INTRODUCTION
and natural language processing [10], [26], [27] have proven
With the prosperity of Internet of Things (IoT), smart effective in extracting rules from apps). Our insight is that,
systems (e.g., smart homes, factories, and hospitals) have according to the rule semantics, we could reduce data leakage
become realistic and are expanding with an ever-increasing withoutimpairingautomation.Forexample,givenarule“when
speed [1]. IoT Platforms, such as Samsung SmartThings [2], a motion is detected (trigger), if the indoor temperature is
Amazon Alexa [3], openHAB [4], allow smart home users to higher than 79◦F (condition), turn on the A/C (action),” we
connect heterogeneous IoT devices (e.g., sensors, actuators, could derive data-minimization policies, such that 1) if the
appliances) and install applications on the platform to create temperatureisnothigherthan79◦F,nomotionortemperature
automatic interactions among devices, i.e., home automation. data are sent to the platform; 2) if the A/C is already on (that
As IoT device data flow outside, protecting user privacy is, the rule execution will not change anything), no data need
becomes critical [5], [6]. Existing work protects user privacy to be sent, and 3) otherwise, the temperature and the motion
from malicious application developers [7], [8], [9], [10], [11], datamustbesent,butthetemperaturevaluecanbeobfuscated
[12], [13] or eavesdroppers [14], [15], [16], [17]. However, to a random value larger than 79◦F.
it is surprising that, while a platform receives huge amounts
of privacy-sensitive data from bound IoT devices, few works Challenge 2. Many platforms are closed systems that do
regard the platform as untrustworthy and provide privacy pro- not allow platform-level modifications, and it is probably
tection solutions. In fact, it is baseless to assume the platform unrealistic to expect a platform to cooperate to enforce data
is trustworthy and its data access protection is flawless, and minimization.Thus,howtoenforcedata-protectionpoliciesin
thus we should consider that the rich data may be exposed to closed systems is a challenge. One may propose to avoid this
attackers [18], [19]. Furthermore, many IoT platforms share challenge by building a new purely-local platform, such that
user data with partners (e.g., advertisers) for the expansion no data have to flow out of a home, or one can simply cut the
of businesses [20], [21], [22]; any improper handling may network cable of a local gateway [28] and enforce the home
disclose privacy-sensitive data to third parties. automation locally. However, most of the leading platforms
(IFTTT, SmartThings, Google Home, Amazon Alexa) employ
a cloud-based architecture due to its advantages in many as-
pects such as storage, integrated services, management. Thus,
NetworkandDistributedSystemsSecurity(NDSS)Symposium2021
existing users may not be willing to give up their choice of
21-24February2021
ISBN1-891562-66-5 platforms.
https://dx.doi.org/10.14722/ndss.2021.24464
www.ndss-symposium.org Inspired by the concept of firewalls [29], [30], we design
1202
rpA
7
]RC.sc[
3v22501.1012:viXra
PFIREWALL as a mediator, which sits between IoT devices Cloud-Based Platform
and the hub (or the platform backend cloud) to transparently IoT Devices Hub Core Framework Companion and
filter data based on privacy-protection policies. However, our Third-Party Apps
PFIREWALL is significantly different from the traditional fire-
Internet
walls. First, the “trigger-condition-action” paradigm of IoT Core Framework Messaging/Storage
automation rules is different from that of traditional firewall
rules.Second,PFirewallutilizesapplication-layerdataandper-
Gateway-Based Platform
formssemantics-awaredatafiltering,whiletraditionalfirewalls
do not use application-layer payload data. There is another Fig. 1: Smarthomeplatformarchitecture.
challengeforimplementing PFIREWALL:theoriginalcommu-
nication between IoT devices and the hub (or the platform
according to whether the core framework of a platform is
backendcloud)isencrypted,whichpreventsPFIREWALLfrom
hosted in a remote cloud or a gateway/hub device located at
understanding it and then filtering data. We overcome this
home (as shown in Fig. 1). Note that the gateway running a
challengewithavirtualizationapproach:Ononehand,thedata
core framework at home does not resolve the privacy leakage
mediator acts as a hub to pair with all the IoT devices. On the
threatscompletely,asthegatewayconnectstotheInternetand
other hand, PFIREWALL creates a virtual device (for each real
is under the full control of the platform cloud administrator.
IoTdevice),whichconnectswiththehub(orplatformbackend
We choose a CBP—SmartThings, one of the most popular
cloud). This way, neither the IoT devices nor the platform
and full-fledged platforms, as an example to describe the key
needs to be modified.
components in a smart home system.
We demonstrate the ideas by implementing PFIREWALL
on three representative IoT platforms: SmartThings classic, • Hub. A CBP hub connects IoT devices through distinct
the new SmartThings1 and openHAB, where the former two short/medium-range wireless radios (ZigBee, Z-Wave, etc.).
are cloud-based IoT platforms and the third a gateway-based Thehubplaysakeyroletoensuretheinterconnectivityand
platform.WeevaluatePFIREWALLinfourreal-worldtestbeds. interoperability of heterogeneous IoT devices. A GBP also
The results show that PFIREWALL reduces the amount of has a hub-like device2 which not only connects IoT devices
data sent to the platform by 97%, without affecting home but also hosts the core framework (described below). Note
automation. Our performance evaluation also shows that the thatthehuborgatewaydevice,thoughphysicallylocatedat
data reduction severely impairs the attacker’s ability to infer home, is conceptually regarded as a part of the platform in
andtrackprivacy-sensitivebehaviors,suchasbathroomusage, terms of data privacy protection in that it is under the full
home occupancy, etc. An earlier version of this paper was control of the platform cloud administrator.
posted on arXiv in October 2019 [31]. • Cloud. The backend cloud of a CBP hosts the core frame-
work and provides cloud messaging, storage and other nec-
The contributions of this work are summarized as follows.
essaryservices.ThecloudinaGBPistypicallyresponsible
for messaging and storage. The cloud messaging service
• We design an effective data flow control system to protect
facilitates some critical functionalities, such as notification,
user privacy in home automation. Data-minimization poli-
third-party application integration, remote monitoring and
cies are automatically generated based on automation apps,
control. Many Internet-based services depend on the cloud.
reporting only the needed data for app execution (minimiz-
• Core Framework. The core framework runs major func-
ing data out). Moreover, we provide users an easy-to-use
tionalitiesofaplatform,includinghomeautomation.Smart-
tooltodefineandcustomizetheirownprivacypolicies(e.g.,
Things classic provides a sandboxed runtime environment
“during the sleep mode, no data should be sent out from
forrunningdevicehandlersandSmartApps.Devicehandlers
devices in bedrooms”).
aresoftwarewrappersthatabstractthephysicaldevicesasa
• We overcome the challenges that most IoT platforms and
set of capabilities and they handle the underlying protocol-
IoT devices are closed-systems and cannot be modified
specific communications between the core framework and
to support the proposed data filtering, and implement our
the physical devices. The core framework represents each
solution on the standard wireless communication protocols
physical device as a device instance by instantiating the
including ZigBee, Z-Wave and WiFi.
corresponding device handler. Automation rules can be
• WeimplementaprototypetoworkwithvariousIoTdevices
defined by installing SmartApps or configuring the rule-
and three popular platforms: SmartThings classic, the new
creating interfaces on the companion mobile app.
SmartThings and openHAB. Through the evaluation in
• Companion and Third-Party Apps. To provide a conve-
four real-world testbeds, we demonstrate that our system
nientuserinterface(UI)foruserstomanagetheirhubs,IoT
significantly reduces the privacy risks due to data leakage
devices and apps, a platform usually provides a smartphone
and it causes very small latency to home automation.
companionapp.Forinstance,intheSmartThingscompanion
app, users can install and configure a SmartApp.
II. BACKGROUND:SMARTHOMEPLATFORMS
Smarthomeplatformscanbecategorizedintocloud-based
III. MOTIVATIONANDTHREATMODEL
platforms (CBPs) and gateway/hub-based platforms (GBPs),
In this section, we first discuss two privacy concerns that
1SmartThings supported the two major versions at the time of research. motivate this work, and then present the threat model.
Although the SmartThings classic mobile app was discontinued in October
2020, most features concerned in this paper such as SmartApps are now
includedinthenewsystem. 2Weusegatewayfordistinguishment.
2
A. Privacy Concerns about Platforms exploit vulnerabilities of home IoT devices [36], [37], side
channels [14], [17], [38], or home local networks [39], [40] to
1)TrustByDefault: Insmarthomesystems,theplatforms
steal private data are not within the scope of this work.
are typically fully trusted. After being installed, a platform
gains the access privilege to all connected home IoT devices Malicious IoT apps may request more device data than
technically by design and legally, by claiming a terms and what is needed by the claimed functionality in the app de-
conditionsoraprivacypolicy.Afterthat,IoTplatformsreceive scriptions. Detecting and preventing such malicious apps have
rich data from connected devices, no matter whether the data been well studied, e.g., [41], [10]. In this work, we assume
are required or not for providing services. To demonstrate that this kind of malicious apps have been inspected by an
this fact, we conduct an experiment on an exemplar platform– existingsolutionsuchas[10].Moreover,manyplatforms(e.g.,
SmartThings. SmartThings, Amazon Alexa) allow users to create rules on
mobile app interfaces, largely eliminating such attacks.
Are IoT data continuously flowing out of homes? To
answer this question, we connected four ZigBee devices (a PFIREWALL itself contains a firewall that only allows
multipurpose sensor, a motion sensor, an arrival sensor and traffic from whitelisted sources (attacks targeting PFIREWALL
a smart outlet) and a Z-Wave sensor (Aeotec Multisensor are further discussed in Section VIII).
6) to a SmartThings hub and observe the data received by
the SmartThings cloud on its logging interface [32]. We did
IV. SYSTEMOVERVIEW
not install any automation apps and did not operate any
SmartThings-provided interfaces. We only interacted with the To protect data privacy, IoT data are processed before they
IoT devices physically. We found that the platform cloud kept leave a smart home. In this work, we propose a privacy-
receiving device data (e.g., motion, switch, temperature, etc.) preserving data minimization approach that can guarantee the
from devices, indicating that device data flow out via the hub correctnessandcompletenessofthedesiredhomeautomation,
evenwhentheyarenotneededbyanyautomation.Besidesour satisfy personal privacy preferences, and significantly reduce
experiment,trafficanalysisresearches[33],[34]alsoshowthat the amount of data sent to the platform. In order to achieve
certain traffic patterns for transmitting device events from the these goals, three challenges need to be addressed.
SmartThings hub to the backend cloud can be observed when
First, data protection must not accidentally affect the
the corresponding events are generated by devices, which is
correctness and/or completeness of home automation (Sec-
consistent with our result.
tion V-A1). Second, it is challenging to enforce the data
Reasons for this fact include: (1) to enhance interoperabil- protectionwithoutmodifyingtheIoTdevices,hub,orplatform
ity, IoT devices are designed to simply send out all data to framework which are usually closed systems (Section V-B).
the paired hub or cloud for further processing, but unaware of Third, it is non-trivial to provide user-friendly interfaces for
how the data will be consumed; (2) most platforms support non-expertuserstodefinetheirownprivacy-protectionpolicies
more than one service (e.g., home automation, dashboards (Section V-A2).
for viewing and changing device states), and therefore do
Most IoT devices can be categorized as the following two
not deploy a data filtering component on the hub devices
cases (Section V-B1 presents our survey of commercial IoT
(manufacturedbythem)oratthefront-endtofilteroutdatathat
devices): (1) IoT devices use open-source wireless technolo-
arenotneededforspecificservices.However,wearguethatthe
gies (e.g., ZigBee, Z-Wave, and Bluetooth) to connect with an
system could be improved or patched to enhance user privacy
in-home hub, and (2) IoT devices use WiFi to connect, in an
in different services. In this paper, we focus on enhancing
end-to-end encryption manner, with their vendor cloud, which
userprivacyinthehomeautomationservice,whichiscontext-
then bridges IoT devices to IoT platforms through encrypted
aware and more difficult to address than other services. We
also discuss a possible solution for the dashboard service in
channels. In case (1), PFIREWALL can act as the hub to
directlyconnectwithIoTdevices,andhencecanseethepacket
Section VIII.
contents from the devices. In case (2), PFIREWALL cannot
2)LimitedUserCapabilities: Currently,usershavefew(or act as a hub to directly talk with these devices but instead
no) capabilities to control device data sent to a platform [35]. couldaccessthedevicesviatheREST(REpresentationalState
They only have a binary choice: either connect a device to Transfer [42]) APIs provided by the vendor cloud. With the
the platform or not; once connected, the device continuously above observations, we propose to place a mediator between
reports data to the platform. IoTdevicesandtheplatformtointerveneinthecommunication
between them. The mediator makes it possible to process the
B. Threat Model raw IoT data before forwarding them to the platform. With
thisinsight,wedesign PFIREWALL,asystemthatcanenforce
We consider that a smart home platform may be exploited
strong privacy protection and user privacy preference, while
by attackers for accessing user private data and inferring
not affecting the home automation at all.
userprivacy-sensitivebehaviors.Forexample,anattackermay
find a way to gain access to the data; also the platform AsshowninFig.2, PFIREWALL comprisesthesemodules:
administrators may be curious to mine user privacy. We do
not assume that the platform is attacker-controlled, but aim • Device Connector talks with IoT devices directly via
to handle the concern that the rich data may be exposed to device-dependent protocols such as ZigBee, Z-Wave, or
attackers and exploited for malicious purposes. The platform indirectly via vendor cloud APIs (see Section V-B1). It also
is assumed to be honest, i.e., it faithfully operates all services forwards the raw device data to the policy-based data filter
and does not perform active attacks on users. Attacks that for processing.
3
IoT Devices PFirewall IoT Platform “when[trigger],if[condition],then[action]”[43],[44].Each
ZigBee R D a a w ta R D a a w ta Policy-Based Fi D lte a r ta ed Fi D lte a r ta ed rulerunsreactively,i.e.,itreactswhenitstriggerissatisfiedby
Z-Wave Device Data Filter Platform Automation
WiFi Commands Connector Commands Connector Commands Apps/Rules anewevent(termedastriggerevent)andthenexecutesaction
... if the smart home is under the prescribed condition. Note that
the trigger and condition are different: a trigger describes a
constraintthatchecksagainstthenewevents,whileacondition
Fig. 2: Architecture of PFIREWALL. Solid arrows: device data/command includesasetofconstraintsthatcheckonthestaticstates(e.g.,
flows; dotted arrows: inputs for generating policies. PFIREWALL can auto- currentdevicestates,time,etc.).AnexampleruleR is“when
maticallygeneratepoliciesfromapps,souser-specifiedpoliciesareoptional. 1
apresencesensorps becomespresent(trigger),ifthereading
1
of a temperature sensor ts is higher than 86◦F (condition),
1
• Platform Connector interacts with the platform through thenturnonthefanf 1 (action).”Someautomationrulesfollow
specific connectivity technology supported by the platform, trigger-action, i.e., “when [trigger], then [action]”, which is
on behalf of the physical devices connected to the device a special case of the trigger-condition-action paradigm where
connector (Section V-B2). The device connector and plat- condition is always true.3 For example, a trigger-action rule
form connector collaboratively mediate data between IoT R 2 is defined as “when the reading of a temperature sensor
devices and the platform. ts 1 ishigherthan86◦F,thenturnonthefanf 1 ”.Withoutloss
• Policy-BasedDataFiltersitsbetweenthedeviceconnector of generality, we will use the rule R 1 as a running example
and platform connector to filter the sensitive data (i.e., to present how PFIREWALL filters data.
events)fromIoTdevicesbasedonpolicies.Ithasthreemain
Automation Rule Extraction. Extracting automation rules
components: policy generator, conflict detector and policy
engine.Thepolicygeneratorgeneratesdata-filteringpolicies fromrule-creatinginterfacesisthefirststepforAPgeneration.
in two ways: (1) it takes automation rules as input to gen- Automation rules are generated by installing IoT apps or
erate data-minimization policies (Section V-A1) and (2) it using rule templates on web/mobile app interfaces. The rule
transforms user-specified policies (from the user interfaces) extraction regarding both methods has been widely studied
into executable-formatted policies (Section V-A2). Conflict by state-of-the-art literature. Code analysis has been shown to
detector inspects if a user-specified policy conflicts with be an effective way to extract rule semantics from IoT apps.
existing data-minimization policies and reports conflicts to Forexample,byutilizingAbstractSyntaxTree(AST)analysis
users (Section V-A3). Policy engine interprets and executes on SmartApps, [45] identifies requested and used capabilities
all policies. in SmartApps, [10], [27] break down SmartApps and extract
rule information, [46], [26], [11] build Deterministic Finite
Note that while PFIREWALL filters device events before Automatons (DFAs) from SmartApps. Symbolic execution is
reporting them to the platform, it does not filter commands, a powerful technique to analyze rule semantics from apps
i.e., all commands received from the platform by the platform [24], [25]. Text data crawling and natural language processing
connectorare forwarded tothephysicaldevices viathedevice have been used for rule extraction from mobile apps and web
connector. pages [26], [47]. Rather than develop new tools, in this paper,
we adapt the solution provided in [24] to extract rules from
V. DESIGNANDIMPLEMENTATION SmartThings classic and manually encode rules defined in the
new SmartThings and openHAB for which we are unable to
In this section, we present the design and implementation
find an open-source implementation. We envision that more
details. We first describe the policy-based data filter for con-
rule extraction tools will be developed and made publicly
textually controlling IoT data flows (Section V-A). Then, we
available,whichcaneliminatethemanualeffortsforencoding
present the mediator for enforcing policies in existing IoT
rules.
systems (Section V-B). To demonstrate the applicability of
PFIREWALL, we show how PFIREWALL integrates with three PolicyGeneration.ConsidertheexampleruleR .Bydefault,
1
popular platforms: SmartThings classic, the new SmartThings
the event streams from devices (presence sensor, temperature
and openHAB (Section V-B2).
sensor, fan) are reported to the platform for executing R .
1
However, we observe that these data are not all required for
A. Data Filtering Policies executing R in cases:
1
PFIREWALL filters data based on two types of policies:
(1) The presence sensor ps does not send any event;
1
automation-dependent data-minimization policies (APs) and
(2) ps sends a “not present” event;
1
user-specified policies (UPs). To achieve data minimization, (3) The temperature measured by ts is lower than 86◦F;
1
i.e., only reporting the minimum amount of data that are
(4) The fan f is “ON”;
1
necessaryforhomeautomation,automationrulesareanalyzed
(5) ps sends a “present” event and the last reported tempera-
1
to generate the corresponding APs. UPs are generated from ture by ts is higher than 86◦F.
1
a user interface provided by PFIREWALL and work with
APs simultaneously, which is an important supplement to In cases (1)-(4), there is no need to report any data from
customize privacy preferences that cannot be learned from ps and ts , as well as data from other devices if they
1 1
home automation. are not used in other rules. In case (5), it is unnecessary
to report the temperature data since the temperature value
1)Automation-Dependent Data-Minimization Policies:
Home automation systems run user-customized trigger- 3To avoid confusion, we explicitly use when and if to distinguish trigger
condition-action rules, each of which can be expressed as andcondition,respectively.
4
TRIGGER:{ 1 TABLE I: Summaryofmethodsusedindataflowpolicies
match (:type).(:subject).(:attribute) 2
satisfy (:operator)->(:value) 3
[fetch*] (:type).(:subject).(:attribute*) 4 Method Description
[branch] (:operator1)->(:value) 5
run (:method)(:paras)(:delay) 6 keep() Reporttheoriginalvalue
[else] (:method1)(:paras1)(:delay) } 7 block() Donotreport
CHECK: [{ 8 diffKeep(v) Reportadifferentvalue((cid:54)=v)andthenvaluev
fetch (:type).(:subject).(:attribute) 9 randomize(v1,v2) Reportarandomvalue∈(v1,v2)
satisfy (:operator)->(:value) 10 startTimer(id) Createorresetatimerwithidentityid
[fetch*] (:type).(:subject).(:attribute*) 11 stopTimer(id) Stopandresetatimerwithidentityid
[branch] (:operator)->(:value) 12 fireTimer(id) Fireatimeridandexecuteactionsinitscallbacks
[run] (:method)(:paras) 13 addCallback(id,act) Addanactionacttothecallbacksoftimerid
[else] (:method1)(:paras1) }, ...] 14
Listing 1: Context-aware policy format
an event of a device ps ’s presence) or a state type (e.g., the
1
Data Minimization Policy reading of a device ts ’s temperature). Hence, these fields in
1
TRIGGER TRIGGER indicate that only data of the specific event type
Automation Rule
m sa a ti t s c f h y ( ( ) - > ) . ( ( ) . ( ) ) Trigger s (e im .g i . l , ar p l s y 1 , ’ t s he p s r e es fi e e n ld ce s ) in tr C ig H g E e C r K th i e nd e i x c e a c te ut w io h n at o s f ta t t h e e s( p e o .g li ., cy ts P ’s ;
fetch* ( ).( ).( ) Presence sensor temperature and f ’s switch) P should query for constra 1 int
branch ( ) -> ( ) ( ) == "present " 1
run ( ) ( ) ( ) satisfaction checking. Fields operator and value define a
else ( ) ( ) ( ) constraint to the event (ps ’s presence is “present”) or state
1
CHECK (ts 1 ’s temperature is higher than 86) in the same block. The
fetch ( ).( ).( ) Condition policyPwilltakeactionsonlywhenalltheconstraintsdefined
satisfy ( ) -> ( ) in TRIGGER and CHECK are satisfied; if any constraint is
fetch* ( ).( ).( ) Temperature
branch ( ) -> ( ) sensor ( ) > 86 not satisfied, the policy execution aborts and will not perform
run ( ) ( ) (0) actions. Recall the aforementioned cases (1)-(5). The policy
else ( ) ( ) ( ) in Fig. 3 only needs to report data for ensuring the correct
Action
fetch ( ).( ).( ) executionofR 1 whenanew“present”eventisobservedfrom
Turn on the fan ( )
satisfy ( ) -> ( ) ps and at the same time ts ’s current temperature is higher
1 1
than 86 and f is off.
Fig. 3: Policyderivationfromanautomationrule. 1
Policy actions defined in run or else indicate how to
reportdatatotheplatform.methodandparametersdefine
stored in the platform database (i.e., the last reported value) howtoprocessthecorrespondingrawdataanddelaycontrols
satisfies the rule condition checking. In no cases, the ON/OFF the timing for reporting the processed data to the platform.
state of f 1 is useful for executing R 1 . In addition, we can Table I shows a summary of all the supported methods. In the
report a random temperature value that is higher than 86◦F default setting, binary-value sensors such as the presence sen-
instead of the real one when reporting a temperature value is sor reports binary values alternatively; thus, the platform only
necessary for rule execution. From this example, we can see firesaneventwhenobservingavaluechange.Ourdatafiltering
that only a small portion of the device data are required for mayaffectthealternationof“present”and“notpresent”values
homeautomation,whichmotivatesustorundata-minimization inthedatastreamofps .Whentheplatformreceives“present”
1
policiesthatcansignificantlyreducetheamountofdatagoing but finds the last received value is also “present,” it will not
outwhilenotaffectinganyautomationrules.Giventheunique fire a new “present” event in its framework and thus R
1
trigger-condition-action paradigm, the existing access control cannotbetriggered.ThepolicyusesdiffKeep()toaddress
policy parsers cannot be directly used. Therefore, we develop this issue; diffKeep() reports “not present” followed by
acustomizedcontext-awarepolicyformatandacorresponding “present” with a time delay T, which ensures a “present”
policy engine for the trigger-condition-action paradigm. event is fired on the platform4. However, if the last reported
valueis“notpresent”,thepolicyonlyneedstousethemethod
Formally,wedefineadataflowpolicyasP=(T,C),where
T and C denote the TRIGGER and CHECK section in a
keep()whichreportsthereceivedvalue“present”.Tohandle
policy,respectively,asshowninListing1.Fig.3illustratesan
the above situations in TRIGGER, fetch* is introduced for
the policy to query the last reported value.5 The policy takes
policy instance that is derived from the running rule example
R . TRIGGER defines the incoming event that awakens the
theactiondefinedinruniftheconstraintdefinedbybranch
ex
1
ecution of P and CHECK encapsulates a list of items, each
issatisfied;otherwise,theactioninelseisperformed.Fields
marked with “[ ]” are optional in the policy format.
of which contains a constraint that must be satisfied for the
policy to indeed perform actions. TRIGGER is derived from fetch* and else are also introduced in CHECK items
the Trigger of an automation rule (e.g., R 1 ) and CHECK is to handle similar situations. If the last reported temperature
derived from the Condition and Action of the same rule. value to the platform is higher than 86, the policy does
type indicates that a datum is related to a device or to not need to report the newly queried temperature value to
time; subject is used to identify a specific IoT device (i.e., the platform (using block()) since R 1 ’s condition-checking
device ID); attribute specifies the attribute of a device (a
4We fine-tuned the value of T and found a sweet spot as small as 300
device may have multiple attributes) or a time-related feature
millisecondwithoutcausingfailureinthethreeplatforms.
(e.g., time of day, date, timer). Fields type, subject and 5Differentfromattributewhichrepresentsthecurrentvalueofadevice
attributeareusedtouniquelyidentifyaneventtype(e.g., attribute,attribute∗ denotesthelatestreportedvalueofthisattribute.
5
yields the correct result based on the last reported value. If Algorithm 1: The algorithm for executing a policy
the last reported temperature is equal to or lower than 86,
Input :D←newdatum,P←Aprivacypolicy
the policy must report a temperature event higher than 86◦F DB←NewestDeviceStatusDatabase
before reporting a “present” event to make sure the rule R is DB∗←NewestReportedDataDatabase
1
Output:ReportedDataSetDS
correctly executed. Instead of reporting the real temperature
1 ifmatch(D.source,P.TRIGGER.(type,subject,attribute))and
value, the policy uses randomize(86, MAX) to report satisfy(D.value,P.TRIGGER.(operator,value))then
a random value. In R , the temperature compares with a 2 foreach checkitem∈P.CHECKdo
threshold (86◦F), so a 1 random value between 86◦F and the 3 4 v if a ! l sa ← tisfy fe ( t v c a h l (D , B c , h c e h c e k c i k t i e t m e .( m o . p (t e y r p a e t , o s r u , b v j a e l c u t e , )) at th t e r n ibute))
upperlimitofatemperatureMAXissufficientforthecondition 5 return
checking. MAX/MIN denotes the upper and lower boundary 6 if!checkitem.hasField([run])then
7 continue
valuesofaspecificattribute.6Weobtainsuchinformationfrom 8 if checkitem.hasField([branch])then
SmartThings Capabilities Reference [48]. 9 val∗←fetch(DB∗,
checkitem.(type,subject,attribute))
With the above design, the policy derived from R (see 10
ifsatisfy(val∗,checkitem.(operator,value))then
1 11 DS←runcheckitem.(method,paras)
Figure3)expressesmulti-facetedinformationfor PFIREWALL 12 else
to process data: 13 DS←runcheckitem.(method1,paras1)
14 else
1) Context: when and only when an incoming event of ps is 15 DS←runcheckitem.(method,paras)
“present”, the current reading of ts 1 is higher than 86◦ 1 F, 1 1 6 7 if P.T v R a I l G ∗ G ← ER f . e h t a c s h F ( i D e B ld ∗ ( , [ P b . r T a RI n G c G h E ] R ) .( t t h y en pe,subject,attribute))
andthestateoff 1 isnot“ON,”somedatawillbereported. 18 ifsatisfy(val∗,P.TRIGGER.(operator1,value))then
Otherwise, the policy will be skipped and no data will be 19 DS←runP.TRIGGER.(method,paras)
20 else
reported at all. 21 DS←runP.TRIGGER.(method1,paras1)
2) TRIGGERdatareporting:ifthelatestreportedvalueofps 22 else
is “present,” use the diffKeep() method to process th 1 e 23 DS←runP.TRIGGER.(method,paras)
current value for reporting; otherwise, use keep().
3) CHECK data reporting: if the latest reported value of ts StopTimer(id)
1
is higher than 86◦F, use the block() method to process if duration > 5min,
Active
the current value of ts ; otherwise, use randomize(86, Timer fireTimer(id1)
MAX). 1 Motion Sensor (id1, duration)
Inactive
action1
We implement a policy engine to parse and execute the StartTimer(id1) ...
policies.Thepolicyenginelistenstoalltheincomingrawdata addCallback(id1, action1)
fromtheIoTdevicesandtime-relatedinformationifregistered. Fig. 4: An example showing how PFIREWALL handles a rule whose
When receiving a new data datum D, the engine uses D to conditionhasatimer.ThemethodsareshowninTableI.action1isdefined
evaluatethemaintainedpoliciesonebyone.Algorithm1sum-
toreport“inactive”totheplatformwithmethodkeepordiffKeep.Each
timermaintainsalistofactionswhichwillbecalledwhenthetimerfires.To
marizesthegeneralworkflowofhowtheengineevaluatesand
accommodate,thetimerintheruleisremovedtoavoiddoublingthetimer.
executesapolicyP.Specifically,itfirstchecksifDmatchesthe
type, subject, and attribute in TRIGGER, and then
examines if the value of D satisfies the constraint specified by
operator and value. If true, P is triggered and proceeds Fig. 4 illustrates the workflow of how PFIREWALL handles
to execution. Then the engine evaluates all items specified in this example.
CHECK. Since the data required for evaluating the CHECK
Thepolicydesignsupportsalltherulefeatures(e.g.,state-
items are not new events but the current smart home status
checking, timers, delayed actions) employed by most popular
(e.g., the device working status), the policy engine fetches the
platforms such as HomeKit, SmartThings, Alexa, Google
information indexed by type, subject and attribute
Home, IFTTT, etc. However, the policy design currently does
from a database DB, which stores the current states of all
not support some uncommon automation rule semantics that
connected devices and updates them when devices report any
are rarely seen. For instance, if a rule’s trigger or condition
change.OnlywhenconstraintsdefinedinallCHECKitemsare
checks historical values of a device (e.g., “if the precipitation
satisfied, the actions defined in all run or else fields will
in the past seven days is less than 100ml (trigger), turn on the
be performed. During the above process, a policy terminates
sprinklersystem(action)”), PFIREWALL willsimplyletallthe
ifthereisanyeventmismatchorconstraintviolation.Besides,
values pass to the platform to ensure the correctness of rule
thepolicyenginealsomaintainsanotherdatabaseDB∗ tokeep
executions. The policy design of PFIREWALL is extendable to
record of the last reported data for each device attribute.
support such rules when needed.
PFIREWALL also deals with time-related automation. For
2)User-Specified Policies: We propose an interactive ap-
instance,ifaruleisdefinedas“whenthedoorisopenediftime
proach for users to specify data-protection policies. This is
is after 18:00, turn on TV”, the derived policy needs to fetch
motivated by three reasons: 1) users have individual privacy
system time for condition checking. When a rule has a timer,
preferences that cannot be derived from automation rules; for
e.g., “when motion sensor becomes inactive for 5 minutes,
example, users might prioritize privacy rather than automation
turn off the light”, multiple policies are bundled to operate by
functionality for some device types during a time period or
calling the methods for starting, stopping and firing a timer.
under certain situations; 2) the platform may integrate a third-
6For instance, temperature (-460∼10000 ◦F), humidity (0∼100%), lumi- party service but there is no rule extractor available to extract
nance(0∼100000lux). semantics from it; 3) users have rights to control the use of
6
Original Flow PFirewall Flow
IoT Device1. join/leave 1. join/leave
2. raw events 2. processed events
Device Platform
3. command Connector 3. command Connector
1. join/leave 1. create/remove
2. raw events 3. command 2. processed events 3. command
1. join/leave
IoT 2. processed events Virtual Device
Platform Instance
3. command
Fig. 6: Workflowofthemediator.
(a) (b) quantifier-free first-order formula:
Fig. 5: Screenshots of PFIREWALL mobile app. The app provides an (type[.subject[.attribute]])(operator)(value).
informationtabshowinguserswhatdataeverydevicetypegeneratesandthe (cid:124) (cid:123)(cid:122) (cid:125)
corresponding privacy implications, and a policy tab allows users to define datasourceandtype
context-awaredatacontrolpolicies.
Toverifythelastformulas,wecheckwhetherthetwopolicies
perform contradictory actions (by looking at the methods and
parameters in run and else fields) on the same data.
their data. In principle, UPs have higher priority than APs in
controlling data. Thus,theconflictdetectionistransformedintoaconstraint
satisfaction problem that can be solved by a constraint pro-
We develop a mobile app for end-users to specify policies. gramming solver. In our implementation, we use a JavaScript
As shown in Fig. 5(a), information is displayed to help users linear solver javascript-lp-solver [49]. If the constraint
understand what privacy issues each device and its data may set derived from two policies is not solvable, it means the
imply. With the templates in Fig. 5(b), users are able to con- two policies have no conflict. Otherwise, two policies have a
figure whitelist, blacklist and conditional-style policies during conflict. PFIREWALL presents detected conflicts to users for
a specified time period or under certain contexts. Finally, UPs decision making.
are encoded into the policy format in Listing 1 for execution.
The solving complexity is determined by the constraints
derived from policies, which only involve simple numerical
3)Policy Conflicts: It is possible that a user’s UPs conflict
relationships and the search space (e.g., the range of device
with existing APs and hinder the automation since UPs are
values, the number of devices in a policy) is very small. In
designed to override APs. Nevertheless, users need a warning
our evaluation, it takes less than 400 milliseconds to check
that shows them what conflicts are caused and which automa-
a pair of policies and we did not encounter a failure due to
tionrulesareaffected.Therefore,anautomatedpolicyconflict
timeout.
detectionisneeded.TwopoliciesP andP conflictwitheach
1 2
other if all the following requirements are satisfied: (1) P
1
B. Data Flow Mediation
andP aretriggeredsimultaneously,i.e.,aneventmakesboth
2
constraints c1 T and c2 T (defined in TRIGGER fields of P 1 and Toenforcedataflowpoliciesinaclosed-sourceIoTsystem,
P 2 , respectively) hold; (2) both policies are finally executed, weintroduceamediatorforrelayingcommunicationsbetween
i.e., all the constraints c1 i and c2 i in the CHECK fields of both IoT devices and the IoT platform, as shown in Fig. 6. The
policies are evaluated true; (3) two policies define different mediator needs to act as both a device connector to interact
actions (i.e., data processing methods, parameters, or delays) with IoT devices and a platform connector, which generates a
for the same data. Formally, let S(C) denote the set of all virtual device on behalf of each real device, to interact with
possible contexts that satisfy the set of constraints C, and the target platform. An advantage of our design is that the
O(a), E(a) denote the object (i.e., the controlled data) and mediator PFIREWALL does not modify the IoT devices, hubs,
effects of a certain action a (defined in both TRIGGER and or the platforms.
CHECK fields). A conflict occurs when the formulas hold.
1)Connecting IoT Devices: We investigate the communi-
cation technologies used by IoT devices in the market, i.e.,

 S(c1 T )∩S(c2 T )(cid:54)=∅, the top 1000 IoT devices with the most total reviews on five
S(c1 1 ,c1 2 ,···)∩S(c2 1 ,c2 2 ,···)(cid:54)=∅, popular online stores (Amazon, BestBuy, Costco, Walmart,
 ∃i,j,O(a1)=O(a2),E(a1)(cid:54)=E(a2). andHomeDepot).Ourinvestigationfocusesontwoimportant
i j i j
questions: (1) the portion of IoT devices that use each of the
popularwirelesstechnologiesand(2)amongthedevicesusing
PFIREWALL detectspolicyconflictforeachnewlysubmit- end-to-end encryption technologies (such as WiFi) to connect
ted/updated UP against every AP. When an AP is added/up- withendpoint/vendorclouds,howmanyofthemprovidecloud
dated due to automation rule adding/updating, PFIREWALL APIs for accessing devices. The result is presented in Fig.
also detects it against all existing UPs. To verify the first 7. Currently, PFIREWALL cannot handle IoT devices that
two formulas, we encode each constraint in a policy into a use proprietary or end-to-end encrypted connections but do
7
Device-Accessing APIs PFirewall SmartThings Cloud
Discover
official Virtual Device (SSDP) Service Manager SmartApp
unofficial -SmartOutlet
ZigBee no available 34.9% Platform
ZWave Connector Command
4.0% Virtual Device (UPnP)
3.1% -MotionSensor
Device Handler Device Handler
WiFi 73.9% 18.5% Bluetooth 28.8% Data (UPnP) - MotionSensor -SmartOutlet
0.5%
Others 36.3% Fig. 8: Overview of interfacing with SmartThings classic. Note that the
communication between PFIREWALL and the SmartThings cloud is bridged
byaSmartThingshub,whichisomittedhere.
Fig. 7: Statistics of popular communication technologies employed by
commercialIoTdevicesandstatisticsofavailabilityofdeviceaccessingAPIs
ofWiFidevices.“Others”includedevicesthatuseothertechnologiesincluding
to work with three representative systems with different inter-
Clear Connect RF [50], HAP [51], GSM [52]. PFIREWALL could handle
facingtechniques:SmartThingsclassic,newSmartThings,and
over74%oftheinvestigateddevices(includingWiFi-connecteddeviceswith
unofficialAPIs). openHAB, without modifying the software of these platforms
or the hubs manufactured by them.
not provide accessing APIs. However, we envision that more Interfacing with SmartThings Classic System
IoT cloud endpoints will provide open APIs in the future
We choose LAN as the protocol for communicating with
to increase interoperability and facilitate service integration.
the SmartThings classic system. SmartThings classic uses a
To demonstrate the feasibility, we choose two open-source
device handler (DH) for abstracting each supported device
standard protocols (ZigBee, Z-Wave) and the most common
type.Accordingly,webuildavirtualdevice(VD)typeforeach
end-to-end encrypted protocols (WiFi connection with the
DH, as illustrated in Fig. 8. We develop a service manager
vendor clouds which provide REST cloud APIs).
SmartApponSmartThings,whichusesSSDP(SimpleService
Discovery Protocol) to discover VD instances on the same
To play the role of a device connector, the mediator
LAN as the SmartThings hub. SmartThings classic uses a
needs to handle 3 major tasks associated with IoT devices:
combination of IPs and ports to uniquely identify devices.
1) adding or removing devices to PFIREWALL; 2) receiving
To be discovered as different devices, each VD instance uses
eventsfromdevices;and3)sendingcommandstodevices.The
a unique port. After discovering a VD instance, the service
device connector alike functions have been implemented and
manager app adds it as a child device. When a child
are available in many open-source platforms, e.g., openHAB
device is added, SmartThings classic automatically selects
[4] and Mozilla IoT [28], which allow developers to add
a DH and abstracts it according to the model property of
add-ons for integrating various IoT devices using different
the child device. Hence, we make the model of a VD
communicationtechniques.Atthetimeofresearch,openHAB
instancethesameasthenameofthetargetDH.Aftertheinitial
supports 275 bindings that have been tested to work with
connection, a VD instance on the mediator side interacts with
hundreds of commercial IoT devices and Mozilla IoT also has
a DH instance on the SmartThings via the UPnP (Universal
tested more than 100 mainstream devices. In our implemen-
Plug and Play) protocol. In additional, we adapt all DHs for
tation, we utilize the ZigBee and Z-Wave add-ons of Mozilla
ZigBee/Z-WavedevicesavailableintheSmartThingsIDE.For
IoT to realize connecting with ZigBee and Z-Wave devices.
each DH, we add a subscribe() function that perform the
Specifically,themediatorisbuiltonaRaspberryPiwithaDigi
SUBSCRIBE operation in UPnP. When a DH is instantiated
XStickUSBdongle(ZBmeshversion)andanAeotecZ-Stick
(which means a VD instance is created and a child device is
(Gen5)toextendZigBeeandZ-Wavecapabilities,respectively.
added), it uses the IP and port to send a SUBSCRIBE SOAP
For WiFi devices, we use the REST APIs provided by three
(Simple Object Access Protocol) message to the VD instance.
vendor clouds (Philips Hue, LIFX, and Honeywell) to access
Moreover, we replace the original code with new code for
devices connected to them.
receivingandsendingSOAPmessages.Theoriginalcodeisin
2)Connecting Various Platforms: When a physical device
parseandcommandfunctionsofDHforreceivingZigBee/Z-
Wave data and sending ZigBee/Z-Wave commands. At this
is connected to PFIREWALL, the platform connector creates
point, the VD and DH instances become addressable to each
aninstanceofvirtualdeviceforit.Thevirtualdeviceinteracts
other and a subscribe/publish based UPnP communication is
with a platform on behalf of the physical device, i.e., it
implemented to report data and send commands.
(1) is discovered by the platform as a new device instance,
(2) reports the post-filtering events to the platform, and (3)
forwards commands from the platform to the physical device Interfacing with the New SmartThings System
(via the device connector). Popular platforms support vari- We achieve interfacing with the new SmartThings system
ous connectivity protocols; for example, SmartThings classic by developing a SmartThings schema connector [58] for
supports LAN- and cloud-based device integration [53], the PFIREWALL platform connector, which requires a cloud-to-
new SmartThings supports cloud-connected devices [54], and cloud connection between PFIREWALL and SmartThings. To
openHABsupportstheMessageQueuingTelemetryTransport this end, we use fast reverse proxy [59] to expose PFIRE-
(MQTT)protocol[55],MozillaIoTprovidesREST-basedWeb WALL (placed in a home network) to the SmartThings cloud,
Things framework and APIs [56], and Wink allows creating register PFIREWALL as an application in SmartThings De-
REST API devices [57]. These features allow a virtual device veloper Workspace [60], and make the platform connec-
instance created by the platform connector to talk with the tor (for the new SmartThings) run as an HTTPs server.
platform as if it is a real device. We implement the mediator The PFIREWALL schema connector implements handlers
8
PFirewall MQTT Topics openHAB
T1: data/id_o/switch MO1 OL1 SL5 AM2 OL4 SL2 MU2
C P o l n a n tf e o c rm tor V -S irt m ua a l r t D O e u v tl i e ce t T2: cmd/id_o/switch S T m 1 a M rtO Q u T t T T le 2 E t mbedded M B o r ti T o o 3 k n e S r ensor Thing O P L R 2 3 PR2 PR SL 1 1 MU1 PR S 6 L4 MU M 4 O3 MU3 SL3 M A O M 2 1
Virtual Device T3: data/id_m/motion T1 T2 T3 PR5 PR4
-MotionSensor switch motion Channel
OL3
Fig. 9: OverviewofinterfacingwithopenHAB.
(a) T1 (b) T2
for the interaction types [61] pre-defined by SmartThings,
including Reciprocal Access Token (mutual authenti-
cation), Discovery (SmartThings discovers devices con-
nectedtoPFIREWALL),StateRefresh(SmartThingsqueries
device states from PFIREWALL), Command (SmartThings
sends commands to PFIREWALL), Device State Callback
(PFIREWALL reports events to SmartThings), Discovery
Callback (PFIREWALL reports newly added devices to
SmartThings).Forprivacyreasons,whenthenewSmartThings
systemsendsaState Refresh)request,PFIREWALLreports
thepreviously-reportedstatesoftherequesteddevices(instead
of reporting the current device states).
Interfacing with openHAB
PFIREWALL uses MQTT to interface with openHAB be-
cause it is a general connectivity protocol and allows for
virtualizing any device types with flexibility. Fig. 9 shows
the high-level architecture of the integration. openHAB pro-
vides an embedded MQTT broker. When a new device
is added to PFIREWALL, a VD instance is created. For
each supported attribute of this devices, if it is a read-
only attribute (e.g., motion, temperature), the VD subscribes
to a topic data/{deviceId}/{attribute} for publishing
events; if it is a writable attribute (e.g., switch), the VD
subscribes to two topics data/{deviceId}/{attribute}
and cmd/{deviceId}/{attribute} for publishing events
and receiving commands, respectively. Meanwhile, by creat-
ing a new entry in openHAB thing configuration file [62],
PFIREWALL adds a corresponding MQTT thing instance with
channelstoopenHAB.EachthingchannelinopenHABcorre-
sponds to an attribute in VD (e.g., motion, switch) and shares
thesametopic(s).Thus,thecorrespondingVDin PFIREWALL
and thing channels in openHAB could exchange events and
commands via the shared MQTT topic(s).
VI. EVALUATION
A. Evaluation Setup
We set up four real-world testbeds for evaluating the
performance of PFIREWALL: an office with 5 members (T
1
),
a two-bedroom apartment with 1 member (T ), and two one-
2
bedroom apartments each of which has 2 members (T and 3
T ).7ThefloorplananddeviceplacementareshowninFig.10. 4
The deployed platform and device types are given in Table II.
The configured automation rules of the testbeds are listed in
Table III. We ask the members of the testbeds to write down
their desired automation rules in English for their own office
or home, and then the authors implement the specified rules
by installing official apps (T , T ), developing custom apps
1 2
(T ,T ,T ),and/orusingthemobilecompanionappinterface
1 2 4
7WehavereceivedtheIRBapproval(SeeAppendixB).
Up
H O B L 2 7 H H B1 M2 M W O S 4 1 HM1 WL1 OL6 HM5 LB1 MU S 6 W2SW1 OL5 HB4 LB2
HM3
MO5 MU7 MU5 SW4
MO6 MU10 MO7 MU8
SW3 HB5
MO9 MU9
(c) T3
pU
HM4 HS1 OL8
MO8 HM6 HB3
DL1
(d) T4
Fig. 10: The layout and device placement in four testbeds. Each presence
sensorPR1∼6iscarriedwithamember.
(T ). The rules are tested and adjusted for one week to make
3
sure they meet the needs of the testbed members.
B. Performance of Data Mediating
To test the correctness of PFIREWALL, we disable data
filtering in each testbed, i.e., PFIREWALL simply forwards
device events to the target platform without executing any
policies. We use the built-in device-level event logs provided
by SmartThings Groovy IDE [32] to capture the data received
by SmartThings classic and the new SmartThings systems.
openHABdoesnotprovideasimilarwebinterfaceforlooking
up events, so we build an event logger by utilizing the
openHABRESTAPI[63].Weobserveduplicateeventsinthe
event logs of SmartThings, and we remove duplicate events
before data analysis.
We run experiments using the above setting in all four
testbeds for one week and compare the event sequence re-
ceived by PFIREWALL and the platform for each testbed. The
experimental results are given in Table IV, which demonstrate
thatourmediatorworkscorrectlyinrelayingIoTdeviceevents
to the platforms.
C. Performance of Data Filtering
Toevaluatetheperformanceofourpolicy-baseddatafilter,
we run the four testbeds for another week with data filtering,
i.e., we enable the execution of data-minimization policies.
Also, two user-specified policies: UP1 (DO NOT report MO1
motion data between 5pm to 8am) and UP2 (DO NOT report
MU1 contact data between 10am to 6pm) are defined in T .
1
1)Correctness and Reliability: Comparing the received
eventsequencesbecomesmeaninglesssincedataarefilteredin
this setting. Instead, we evaluate the correctness of executions
of automation rules.
Methodology. PFIREWALL records all commands sent by the
platform in each testbed. We ask the testbed members to keep
arecordoftheirmanualoperationsonmobilecompanionapps
and manually remove the commands caused by these opera-
tions;thus,theremainingcommandsaresupposedtobeissued
by executions of rules; We use p-commands to denote the
9
TABLE II: Deployed platforms and devices in the four testbeds. PFIREWALL uses ZigBee (MU, MO, OL, SL, WS, SW), Z-Wave (AM), LAN (PR) or cloud
APIs(WL,HM,HB,LB,HS)toconnectthesedevices.
Testbed Platform Device(Abbr.) Protocol Attribute Num
SmartThingshubv2 ZigBee,Z-Wave,WiFi,Ethernet – 1
Multipurposesensor(MU) ZigBee contact,temp. 1
SmartThings Motionsensor(MO) ZigBee motion,temp. 1
T1
Classic Smartoutlet(OL) ZigBee switch,power 2
Smartlight(SL) ZigBee switch 1
Presencesensor(PR) ZigBee presence 5
SmartThingshubv2 ZigBee,Z-Wave,WiFi,Ethernet – 1
Multipurposesensor(MU) ZigBee contact,temp. 3
Motionsensor(MO) ZigBee motion,temp. 2
SmartThings
T2
Classic
Smartoutlet(OL) ZigBee switch,power 2
Smartbulb(SL) ZigBee switch 4
AeotecMultiSensor(AM) Z-Wave motion,humidity,luminance 2
Presencesensor(PR) ZigBee presence 1
PhilipsHueBridge ZigBee,Ethernet – 1
Multipurposesensor(MU) ZigBee contact,temp. 3
Motionsensor(MO) ZigBee motion,temp. 3
Smartoutlet(OL) ZigBee switch,power 3
SmartThings
T3
NewSystem
Smartswitch(SW) ZigBee switch 3
Watersensor(WS) ZigBee water,temp. 1
Honeywellwaterleakage(WL) WiFi water,temp. 1
Huemotionsensor(HM) ZigBee motion,temp.,luminance 2
Huebulb(HB) ZigBee switch 2
LIFXbulb(LB) WiFi switch 1
PhilipsHueBridge ZigBee,Ethernet – 1
Multipurposesensor(MU) ZigBee contact,temp. 3
Motionsensor(MO) ZigBee motion,temp. 3
Smartoutlet(OL) ZigBee switch,power 1
T4 openHAB Smartswitch(SW) ZigBee switch 1
Huemotionsensor(HM) ZigBee motion,temp.,luminance 4
Huebulb(HB) ZigBee switch 3
Hueswitch(HS) ZigBee button 1
LIFXbulb(LB) WiFi switch 1
Dimmablelight(DL3) ZigBee level 1
commands that are issued by the platform when PFIREWALL aresoundandcomplete,respectively,asshowninTableV.We
is used. We check if p-commands (i.e., the execution result find that 15 command records are not sound and 1 command
from filtered events) are sound (i.e., policies do not cause (i.e., SL4 OFF) in the gt-commands cannot find a match in
false positive device actuation) and complete (i.e., policies the p-commands (marked in bold). Recall that we ask the
do not lead to missed device actuation) against ground truth testbedmemberstoannotatetheirmanualoperationsonmobile
commands, denoted as gt-commands, which are supposed to companionappsbecausethesemanualoperationsalsogenerate
beissuedbytheplatformusingthesameautomationrulesover commands which cannot pass the soundness verification. We
the raw (unfiltered) events. To generate the gt-commands, we ask the testbed members to recall and confirm if they miss
disconnect PFIREWALL from physical devices and replay the annotating manual operations at the timestamp of the unsound
one-week raw events to the platform in each testbed, i.e., the commands. After rectifying the annotations, we repeat the
raw events are sent to the platform over another week based soundness verification process. The updated results in the
on their timestamps. Note that all rules in Table III are date- parenthesesinTableVshowthatR increasesafterimproving
S
insensitive so that the dates of the timestamps of events does the user annotations. The remaining 4 unsound command
not affect the rules. For convenient comparison, we adjust the records are very likely to be generated by forgotten manual
start time of gt-commands and make it the same as that of operations. On the other hand, we look up the SmartThings
p-commands, i.e., make the two sets of commands start at the livelogging[32]andconfirmthatrule13(seeTableIII)indeed
same time such that we can compare them. issues an OFF command to device SL4 at the timestamp of
theunmatchedcommand(SL4OFF).Therefore,thecommand
Toverifythesoundnessofeachcommandinp-commands,
may be lost during transmission from SmartThings cloud to
we check if it has a counterpart within 3 seconds in the gt-
PFIREWALL. The evaluation results prove that PFIREWALL
commands. If so, the command is sound. Recall that PFIRE-
does not impede the home automation.
WALL removes redundant rule executions (i.e., commands)
while platforms not; for example, PFIREWALL will not send
data for a rule to turn on a fan if the fan is already “ON” Evaluation of a naive pull-based approach. Considering
(see Section V-A1). Thus, the p-commands should not be some platforms use both push (i.e., devices report data to
considered incomplete if it has no counterpart of a redundant platforms via callbacks) and pull (i.e., platforms request
command in the gt-commands. Therefore, we traverse the raw data from devices) models to obtain data, a naive privacy-
eventsandgt-commandsinparallelandremovesuchredundant preserving approach is that PFIREWALL does not report data
commands before verifying completeness. Then, we check if to the platform unless the platform proactively requests, on
every command in the gt-commands has a counterpart within the assumption that the platform pulls data on demand. The
3 seconds in the p-commands. SmartThings new system uses both push and pull. We use
one of the SmartThings testbed T to evaluate this baseline
3
Results. We compute the ratio R and R of commands that (pull-based) approach. We keep the configuration of devices
S C
10
TABLE III: Installedrulesinalltestbeds.Source:officialapp(O),customapp(C),templatesonmobile/webinterface(T).
Testbed ID Source DescriptionandDeviceBindings
1 O Whenfrontdoor(MU1)isopened,turnonlight(SL1).
2 O Whennomotion(MO1)orpresence(PR1∼5)isdetectedfor5minutes,turnofflight(SL1).
3 C Whenpresence(PR1)becomespresent,iftimeisbefore12am,turnoncoffeemachine(OL1).
T1 4 C Whenmotion(MO1)detected,iftemperature(MU1)isbelow70◦F,turnonheater(OL2).
5 C Whenmotion(MO1)isactiveforlongerthan60minutes,sendamessagetoalert.
6 C Whendoor(MU1)isopen,ifnopresence(PR2∼5),sendamessage.
7 O Whendoorisopened(MU2),turnonlight(SL2).
8 O Whenmotion(MO2)activeifluminance(AM1)isbelow15LUX,turnonlight(SL3).
9 O Whenpresence(PR6)becomespresentifbetween5-8pm,turnonoven(OL3).
10 O Whenmotion(MO2)activeifnotpresence(PR6),sendanotification.
T2
11 O Whenwardrobedoor(MU4)open,turnonlight(SL5);whendoor(MU4)close,turnofflight(SL5).
12 O Whenmotion(MO2),iftemp.(MU3)below68◦F,turnonheater(OL4);whenmotion(MO2)inactivefor20minutes,turnoffheater(OL4).
13 C Whendoor(MU3)opened,turnonlight(SL4);whendoor(MU3)closedifmotion(MO3)inactivefor5minutes,turnofflight(SL4).
14 C Whenhumidity(AM2)exceeds85%ifmotion(AM2)activebutmotion(MO3)keepsinactivefor30minutes,sendanotification.
15 T Whenbedroommotion(MO6)activebetween10amand12am,turnonlight(SW3).
16 T Whenkitchenmotion(HM1)activebetween7amand12am,turnonmicrowaveoutlet(OL6).
17 T Whensinkwaterleakage(WL1)detectedandallmotion(MO4∼6,HM1∼2)inactive,sendatextmessage.
18 T Whenfrontdoor(MU5)openandluminance(HM2)isbelow30LUX,turnonlights(LB1,OL7).
19 T Whenbathroommotion(MO4)activeandwatersensor(WS1)wet,turnonfan(SW1).
T3
20 T When7am,turnoncoffeeoutlet(OL5);when6pm,turnoffcoffeeoutlet(OL5).
21 T Whenbathroommotion(MO4)activebetween10amand1am,turnonlight(SW2).
22 T Whenbathroommotion(MO4)inactiveandbathroomdoor(MU6)closed,turnofflightswitch(SW2)after10minutes.
23 T Whenstudyroommotion(MO5)activebetween9amand12amandluminance(HM2)isbelow30LUX,turnonlights(LB1,OL7,HB1∼2).
24 T Whenstudydeskmotion(HM2)activebetween9amand12amandluminance(HM2)isbelow30LUX,turnonlight(LB1,OL7,HB1∼2).
25 C Whenstovetopmotion(HM4)active,ifHueswitch(HS1)activatesbutton1(daymode)or3(napmode),turnonlampoutlet(OL8).
26 C Whenstovetopmotion(HM4)inactivefor5minutes,turnoffthelampoutlet(OL8).
27 C Whenlivingroommotion(MO7)active,ifHueswitch(HS1)activatesbutton1(daymode)or3(napmode),turnonlivingroomlight(LB2).
28 C Whenlivingroommotion(MO7)inactivefor20minutes,turnofflivingroomlight(LB2).
29 C Whenbathroommotion(HM3)active,ifHueswitch(HS1)activatesbutton1(daymode)or3(napmode),turnonlights(SW4,HB3);ifHue
switch(HS1)activatesbutton2(nightmode),turnonlightswitch(SW4).
T4
30 C Whenbathroommotion(HM3)inactiveanddoor(MU8)openfor15minutes,turnofflights(SW4,HB3).
31 C Whenbedroommotion(HM6)active,ifHueswitch(HS1)activatesbutton1(daymode),turnonlight(HB5).
32 C Whenbedroommotion(HM6)inactivefor10minutes,turnofflight(HB5).
33 C Whenstudyroommotion(HM5)active,ifHueswitch(HS1)activatesbutton1(daymode)or3(napmode),turnonlight(HB4).
34 C Whenstudyroommotion(HM5)inactivefor30minutes,turnofflight(HB4).
35 C Whenfrontdoor(MU9)open,setthedimmer(DL1)brightnesslevelto100%;after5minutes,setthedimmerto0%.
leads to failures (non-executions) of most automation rules
TABLE IV: Comparisonofeventsreceivedby PFIREWALL mediatorand
(i.e., rules in line 3-11) except rule 20 (line 1 & 2; device:
the target platform in all testbeds. Total: the total data volume received by
PFIREWALLmediatorandtheplatform,respectively.Duetospacelimits,we OL5), which only uses a specific time to trigger the rule.
listpartialrepresentativedevicesandattributes,coveringdifferentcommuni- Accordingtoourobservation,SmartThingsonlypullsthestate
cationprotocolsandattributetypes(binary/numeric-value)ineveryplatform. of a specific device when we operate on the SmartThings
mobile app to refresh its state; otherwise, SmartThings relies
Testbed Device Attribute Total Inconsistency
MU1 contact 1372,1372 0 on the push model to update devices’ states and trigger rules.
MU1 temperature 6174,6174 0 Thus, when the naive approach is employed, most automation
MO1 motion 1598,1598 0
T1 OL1 switch 24,24 0 rules cannot be triggered because the platform does not know
SL1 switch 18,18 0 the events that trigger the rules.
PR1 presence 46,46 0
AM1 motion 268,268 0
T2 AM1 humidity 459,459 0 2)Latency: Compared to the original systems, PFIRE-
AM1 luminance 648,648 0 WALL adds one more “hop” to the original system. Therefore,
W
M
S
O
1
6 tem
w
p
a
e
t
r
e
a
r
ture 691
1
9
2
,
,
6
1
9
2
19
0
0
the additional latency L
HA
introduced by PFIREWALL to
WL1 water 4,4 0 home automation consists of the computation latency L 1 for
T3 HM1 luminance 1547,1547 0 executing policies and the additional transmission delay. The
HM2 motion 4046,4046 0
additional transmission delay includes the event transmission
HB1 switch 26,26 0
LB1 switch 18,18 0 delay L 2 from PFIREWALL to the local hub (SmartThings
MO7 motion 2116,2116 0 classic) or to the platform (the new SmartThings, openHAB)
HB4 switch 19,19 0
and the command transmission delay in the reverse direction.
T4 LB2 switch 26,26 0
HS1 button 15,15 0 Thus, L is approximately equal to the sum of computation
HA
DL1 level 32,32 0 latency L and a round-trip transmission delay 2 ∗ L , i.e.,
1 2
L = L + 2 ∗ L . We obtain L by computing the
HA 1 2 1
and rules the same and modify the behavior of PFIREWALL, elapsed time from when PFIREWALL receives an event to
i.e., PFIREWALL responds to State Refresh (pull) with when PFIREWALL reports the event (if the event is reported),
unfiltered real data but does not push any data. We run this and we obtain L by computing the elapsed time from when
2
newsettingforaweekandusetheaforementionedcorrectness PFIREWALL reports an event to when the hub/platform re-
verification methodology to check if the baseline approach ceives the same event. We compute the latency for all events
guarantees the correctness of automation. and show the averaged results in Table VII. The extra latency
(about0.6second)isatradeoffformitigatingprivacyleakage.
The results in Table VI show that the baseline approach User experience suffers less than indicated by the latency
11
TABLE V: Results of correctness verification of all device commands TABLE VII: LatencyintroducedbyPFIREWALL(inseconds).
that are issued by automation rules. NR: the number of device commands
receivedbyPFIREWALLafterremovingonescausedbytheannotatedmanual Testbed Computation One-WayTransmission Automation
operations; NS: the number of commands that are proved sound; NC: the LatencyL1 LatencyL2 LatencyLHA
number of ground truth commands generated based on raw event replaying.
R res S pec a t n i d vel R y. C are the ratio of commands that are sound and complete, T T 1 2 0 0 . . 1 0 3 8 6 7 0 0 . . 2 2 3 0 3 3 0 0 . . 6 4 0 9 2 3
T3 0.143 0.274 0.691
Soundness Completeness
T4 0.083 0.293 0.669
Testbed Device Comm. NR
NS RS NC RC
OL1 ON 6(5) 5 0.83(1.00) 5 1.00
OL2 ON 7 7 1.00 7 1.00 TABLE VIII: ResultsofthereductionrateRRandcorrecttrackingratio
T1
SL1 ON 9 9 1.00 9 1.00 CTR/CATR per device. VOL: the volume of raw event and the volume
SL1 OFF 9 9 1.00 9 1.00 of event reported to the platform after data filtering, respectively. The last
OL3 ON 4(3) 3 0.75(1.00) 3 1.00 columnisCATRifnotspecifiedandotherwiseCTR.Wepresenttheresults
OL4 ON 21(21) 20 0.95(0.95) 20 1.00
forpartialrepresentativedevicesduetopagelimits.
OL4 OFF 21(19) 17 0.81(0.89) 17 1.00
SL2 ON 10 10 1.00 10 1.00
Testbed Device Attribute VOL RR CATR(CTR)
T2 S
S
L
L
3
4
O
O
N
N
3
2
1
0
3
2
1
0
1
1
.
.
0
0
0
0
3
2
1
0
1
1
.
.
0
0
0
0 MU1 contact 1244,9 0.99 0.01
SL4 OFF 19 19 1.00 20(19) 0.95(1.00) MO1 motion 1574,26 0.98 0.75
S
S
L
L
5
5 O
O
F
N
F
1
1
3
3
1
1
3
3
1
1
.
.
0
0
0
0
1
1
3
3
1
1
.
.
0
0
0
0
T1 O
S
L
L
1
1
s
s
w
w
i
i
t
t
c
c
h
h 1
2
8
2
,
,
1
4
8
0
0
.
.
8
0
2
0
0
1
.
.
3
0
2
0
PR1 presence 42,30 0.29 0.91
OL5 ON 7 7 1.00 7 1.00
PR2 presence 42,1 0.99 0.32
OL5 OFF 7 7 1.00 7 1.00
OL6 ON 2 2 1.00 2 1.00 MU2 contact 30,10 0.67 0.01
OL7 ON 9 9 1.00 9 1.00 MO2 motion 264,45 0.83 0.46
T3
S
S
S
W
W
W
1
2
2 O
O
O
F
N
N
F 19
2
5
(
3
18)
2
1
5
3
7 0.8
1
1
9
.
.
(
0
0
0
0
0
.94)
2
1
5
3
7
1
1
1
.
.
.
0
0
0
0
0
0
T2 P
O
A
R
L
M
6
3
1 i
p
ll
s
r
u
w
e
m
s
i
e
t
a
n
c
n
h
c
c
e
e 6
2
3
5
2
6
8
,
,
,
4
4
1
0
0
0
.
.
.
8
8
9
2
9
9 0.00
0
0
(
.
.
C
4
0
8
3
TR)
SW3 ON 7 7 1.00 7 1.00 AM1 humidity 487,0 1.00 0.00(CTR)
HB1 ON 7 7 1.00 7 1.00 WS1 water 14,5 0.64 0.03
HB2 ON 7 7 1.00 7 1.00 MO4 motion 918,45 0.95 0.15
LB1 ON 9 9 1.00 7 1.00 MO6 motion 923,7 0.99 0.38
OL8 ON 27 27 1.00 27 1.00 T3 HM1 motion 1090,2 0.99 0.05
OL8 OFF 23 23 1.00 23 1.00 HM2 motion 5046,2 0.99 0.31
SW4 ON 67 67 1.00 67 1.00 HB1 switch 24,12 0.50 0.22
SW4 OFF 55 55 1.00 55 1.00 WL1 water 4,0 1.00 0.00
HB3 ON 38 38 1.00 38 1.00 HM3 motion 1354,122 0.91 0.27
HB3 OFF 38 38 1.00 38 1.00 HM4 motion 1178,50 0.96 0.55
HB4 ON 34 34 1.00 34 1.00 HM5 motion 5778,68 0.99 0.48
T4 HB4 OFF 34 34 1.00 34 1.00 T4 HM6 motion 2815,127 0.95 0.22
HB5 ON 66 66 1.00 66 1.00 MO7 motion 1898,74 0.96 0.51
HB5 OFF 67(61) 61 0.91(1.00) 61 1.00 HB3 switch 338,122 0.64 0.79
LB2 ON 37 37 1.00 37 1.00 HS1 button 16,14 0.13 0.54
LB2 OFF 37 37 1.00 37 1.00
DL1 Set100 20 20 1.00 20 1.00 readings and device states (i.e., motion, presence, switch,
DL1 Set0 20 20 1.00 20 1.00
etc.) which reveals sensitive information. By reducing the
disclosed data, PFIREWALL can effectively prevent smart
TABLE VI: Resultsofthenaivepull-basedapproach.SeeTableVforthe home platforms and potential attackers from inferring private
notations. information of smart homes and homeowners based on large
amount of IoT device data in the original system. In general,
Soundness Completeness
Testbed Device Comm. NR
NS RS NC RC
the RR of binary-value attributes are smaller than numeric-
OL5 ON 7 7 1.00 7 1.00 value ones, since binary attributes are more often used as rule
OL5 OFF 7 7 1.00 7 1.00 triggers and hence cannot be completely blocked.
OL6 ON 0 0 – 3 0.00
OL7 ON 0 0 – 8 0.00 4)Privacy Gain of PFIREWALL: We further investigate
SW1 ON 0 0 – 5 0.00
T3 SW2 ON 0 0 – 27 0.00 how much privacy PFIREWALL enhances by studying the
SW2 OFF 0 0 – 23 0.00 degree that PFIREWALL prevents attackers from: (1) tracking
SW3 ON 0 0 – 8 0.00
device states, and (2) inferring sensitive user activities.
HB1 ON 0 0 – 7 0.00
HB2 ON 0 0 – 7 0.00
LB1 ON 0 0 – 7 0.00 Device Status Tracking. An attacker can precisely track the
state of a device by leveraging its complete event sequence.
When PFIREWALL is deployed, it filters out a very large
since many rules (e.g., rule 2, 3, 4, 5 in Table III) are not portionofdeviceeventssuchthatitisnoteasyforanattacker
time-critical. Hence, the latency (up to 0.7 seconds) of most to infer the correct device state with partial information. We
automation rules is acceptable. define two metrics for this study: Correct Tracking Ratio
(CTR) and Correct Active-State Tracking Ratio (CATR):
3)Reduction of Data Leakage: To show the effectiveness
ofPFIREWALLinfilteringevents,wecomparethedatavolume Durationofcorrectlyguessingasensor’smeasurements
CTR= (1)
collected by PFIREWALL with that reported to the platforms
Totalduration
and compute the relative Reduction Rate (RR). As shown in
Table VIII, PFIREWALL blocks more than 99% of numeric- Durationofcorrectlyguessingadevice’sactivestate
CATR= (2)
value sensor readings, and 96.79% of binary-value sensor
Durationofguessingadevice’sactivestate
12
CTR measures the correctness of tracking numeric-value
TABLE IX: Methodologyforinferringuseractivitiesindifferenttestbeds.
IoT attributes (e.g., temperature, humidity) and CATR mea-
Device,roomandtimeinformationisexploited.
sures the correctness of tracking binary-value attributes (e.g.,
motionandswitch).CTRisnotsuitableformeasuringbinary- Activity ID Methodology Testbed
value attributes; for instance, a CTR is equal to 80% when
Working 0 presencesensoron T1
Leaving frontdooropen/closed→allmotionsensorsbecome
simply guessing a motion sensor (which is “inactive” for 80%
home
1
inactiveforatleast10minutes
T3,T4
of a day) is “inactive” all day. However, this does not indicate Arriving frontdooropen/closed→atleastamotionsensor
a good inference since an active state (e.g., motion “active”, home
2
becomesactivewithin3minutes
T3,T4
switch “on”) matters more than the other (e.g., motion “inac- Toileting 3 1minute<bathroommotionactive<10minutes T3,T4
tive”, switch “off”) from the perspective of activity inference. Showering 4
bathroommotionactive→watersensorwet T3
15minutes<bathroommotionactive<60minutes T4
Instead, CATR only takes the active state of a binary-value
bedroommotionactive→nomotionactiveinother
attribute into calculation and thus eliminates the impact of
Sleeping 5
rooms→bedroommotioninactive>10minutes
T3,T4
unbalanced distributions of binary states.
Cooking 6
kitchenmotion>10minutes T3,T4
microwaveoutletpower>1000W T3
We calculate the CTR or CATR of every attribute for all Preparing
devicesinthefourtestbedsoveroneweek.Theresultisshown coffee
7 coffeemachineoutletpower>1000W T3
in Table VIII. The CTR of all numeric-value attributes are
equal or close to zero since most of them are not used by
automation rules and hence are not reported to the platform. Sun
Although some numeric-value attributes are used in rule con-
Sat
ditions (e.g., AM1-luminance used by rule 8), more than 99% Fri
of their values are not reported and therefore attackers cannot Thu
correctlytrackthem.Overall,mostbinary-valueattributeshave Wed
a low CATR, showing that data filtering prevents attackers Tue
from correctly tracking the device status. The CATR of a few Mon
binary-value attributes (e.g., PR1-presence) is higher because 0 2 4 6 T 8 ime 1 0 of D 12 ay 1 ( 4 hou 1 r 6 ) 18 20 22 24
these attributes are heavily needed by rules and thus most of
their values cannot be filtered out.
Activity Inference. We consider a strong attacker who has
sufficient background and domain knowledge to perform so-
phisticated attacks to infer user activities. Smart home users
usuallygiveameaningfulname(e.g.,bathroommotionsensor,
bedroom light, microwave outlet) and assign a room to each
device. Hence, we assume that the attacker knows the rooms
of a home and the assigned room of every device. We also
assume that the attacker has expertise to associate activities
withdeviceeventsandstates.8Basedontheaboveassumptions
of a strong attacker, we implement methods (see Table IX) of
attackers to infer users’ activities. We run the methods on raw
events (before data filtering) and the processed events (after
data filtering) and compare the results.
As shown in Fig 11, the working hours of every member
who carries a presence sensor can be easily inferred by
observing the raw presence sensor data. Note that PR1∼5 are
the 5 presence sensors in testbed T . Furthermore, the device
1
label of a presence sensor may carry personally identifiable
information (e.g., name) and thus the learned working hours
could be matched to individuals. When PFIREWALL is de-
ployed, most presence data are filtered out and thus attackers
cannot infer working hours correctly from PR2∼5. Attackers
canstillachieveanaccuracyofsincethedataofPR1cannotbe
completelyfilteredsinceboththestatesofPR1(i.e.,“present”
and “not present”) are needed for executing automation rules
2 and 3 (see Table III).
Figure 12 shows the confusion matrices of activity infer-
ence attacks before and after data filtering on testbed T and
3
T
4
. Without PFIREWALL, the attacker correctly recognizes
most activities. The recall (a.k.a., true positive rate) is 1 for
8Suchknowledgecanbeeasilylearnedfromalotofexistingliteraturesuch
as[64],[65],[66],[67].
yaD
PR1 P P R R 2 3 Sun
PR4
PR5 Sat
Fri
Thu
Wed
Tue
Mon
0 2 4 6 8 10 12 14 16 18 20 22 24 Time of Day (hour)
(a) Withoutdatafiltering
yaD
PR1 PR2 PR3
PR4
PR5
(b) Withdatafiltering
Fig. 11: Visualization of inferred working hours based on the presence
sensor data in testbed T1 without and with data filtering, respectively. For
simplicity of illustration, we round all working hours to the nearest hours.
PR1∼5:presencesensorsinT1.
most activities except that it is 0.83 for activities 1, 2, 6 in
T . Data filtering brings the recall of most activities down to 3
less than 0.34 and some (activity 1, 5, 7 in T and 5 in T ) 3 4
evento0,makingtheattackermissrecognizingmostactivities.
Overall, the total recall of all activities drops from 0.96 to
0.19 in T and from 1 to 0.13 in T . Hence, by filtering 3 4
data, PFIREWALL significantly degrades the performance of
the activity inference attacks.
VII. RELATEDWORK
A. Smart Home Security
Recent research have explored smart home security and
safety in various aspects. Fernandes et al. [41] revealed de-
sign vulnerabilities in the permission system of SmartThings.
Follow-upworks[46],[10],[68],[69],[70]havedesignednew
mechanismstoimproveaccesscontrolinIoTsystems.Security
researches also studied the application security. For instance,
Jia et al. [46] extensively surveyed app-level attacks on IoTs,
and presented a context-based permission system. Other than
single-appattacks,cross-appinteraction(CAI)threatsattracted
the attention of recent works [71], [24], [25], [12], [11].
HomeGuard [71], [24] is the first work that systematically
studiesthisproblemandalsothefirstonethatproposestouse
theorem proving to detect CAI threats. iRuler [72] applies the
sameapproachtostudyingCAIthreatsontheIFTTTplatform.
In addition to automation applications, resource-
constrained and diverse IoT devices raise unique challenges.
13
               ) 1
 $ F W L Y L W \  , '   L Q I H U U H G 
  G H W D W R Q Q D   ' ,  \ W L Y L W F $
 
 
 
 
 
 
 
 3 )
               
                  
                   
                  
                
                   
                  
                
 
               ) 1
 $ F W L Y L W \  , '   L Q I H U U H G 
(a) T3 withoutdatafiltering
  G H W D W R Q Q D   ' ,  \ W L Y L W F $
 
 
 
 
 
 
 
 3 )
               
                  
                 
  
               
                   
                
                  
               
 
(b) T3 withdatafiltering
             ) 1
 $ F W L Y L W \  , '   L Q I H U U H G 
  G H W D W R Q Q D   ' ,  \ W L Y L W F $
 
 
 
 
 
 
 3 )
                
                
                 
             
                 
                 
              
               ) 1
 $ F W L Y L W \  , '   L Q I H U U H G 
(c) T4 withoutdatafiltering
  G H W D W R Q Q D   ' ,  \ W L Y L W F $
 
 
 
 
 
 
 3 )
cooperation from the platform and app developers to operate.
Xuetal.[81]filterandobfuscatedatasentfromIoTplatforms
to IFTTT to enhance smart home privacy; however, the user
data still flow to IoT platforms. How to protect smart home
privacy from such IoT platforms as SmartThings and Amazon
has not been studied prior to our work.
C. In-hub Security and Privacy Enforcement
Manyin-hubschemesareproposedtoenforcesecurityand
privacy schemes in the IoT domain. Simpson et al. designed
              an in-hub security manager built atop the smart home hub
                 to patch vulnerable IoT devices and strengthen authentication
                  [82]. The security manager is deployed in an open-source
              system HomeOS. FACT [69] and HanGuard [70] enforced
                  access controls in the middle by implementing controllers on
                 an open-source hub and a programmable WiFi router, respec-
               tively. By comparison, these schemes rely on a programmable
  hub (gateway, router) that can indeed intercept and control
the communication between the home area network and the
(d) T4 withdatafiltering
Internet. However, in cloud-based smart home platforms like
Fig.12:Resultsofactivityinferenceattacks(seeTableIX)intestbedT3and SmartThings, communications between the commercial hub
T4.FNandFPdenotefalsenegativeandfalsepositiveinference,respectively. and the backend cloud are encrypted [83] and hence the
router can neither decrypt nor modify the packets on demand.
PFIREWALLprovidesanovelapproachtoworkingwithclosed
systems, without modifying the IoT devices, hubs, or clouds.
For example, how to conduct IoT authentication [73]
and pairing [74] for IoT devices that only have a button D. Firewall-Based Solutions
or knob is an intriguing question. As another example,
researchers frequently employ data-driven techniques to Networkfirewallshavebeenextensivelystudiedindifferent
detect malfunctions in smart homes but the detection is communication layers, such as data-link [84], [85], network
hardly precise and explainable. HAWatcher [75] proposes [86], [87], transport [88], and application [89], [90], [91], and
a novel semantics-aware approach that utilizes semantic in different aspects, such as policy compactness [92], [93],
information, such as automation rules and device relations, to verification[94],languages[95],conflicts[96],[97],andsoon.
mine correlations from event logs for precise and explainable PFIREWALLisessentiallyanapplicationlayerfilteringsystem.
anomaly and attack detection. Security issues related to voice Existing application firewalls, such as intrusion prevention
assistants draw great attention [76], [77], [78]. For example, systems [89] and web application firewalls [90], [91], check
MVP-Ears[78]presentsahighlyaccurate(accuracy>99.8%) on non-payload information (e.g., IP address, port, protocol,
audio adversarial example (AE) detection method inspired DNS, HTTP URL, etc.). On the other hand, PFIREWALL is
by multiversion programming, and it can proactively handle a novel contextualized solution to the privacy protection of
transferable audio AEs. This work is concerned with the rich smart homes by inspecting application-layer payloads (i.e.,
privacy-sensitive data generated by IoT devices. events) and performing semantics-aware data filtering against
the “trigger-condition-action” automation rules.
B. Smart Home Privacy
VIII. DISCUSSIONANDLIMITATIONS
Privacy is an important research topic in smart home
ecosystems. Zheng et al. [5] studied smart home owners’ Can PFIREWALL perform home automation and thus get
perceptions of privacy risks and actions taken to protect their rid of the cloud? Theoretically, PFIREWALL is capable of
privacy. The study found that users are unaware of privacy executing the extracted rules locally and disclosing no data
risks from inference algorithms operating on data from their to the platform. However, we did not employ this design
IoT devices, and they expect device manufacturers to protect due to practical considerations. (1) The kick-cloud-out strat-
their privacy though it is not the case. Celik et al. [7] tracked egy may cause ethical or legal concerns which our research
the sensitive data flows in programming frameworks and team cannot tackle. While PFIREWALL may provide home
identified that 138 out of 230 apps in SmartThings transmit automation,allothercloud-basedservices(messaging,storage,
at least one kind of sensitive data over platform-provided and remote management) will be lost. (2) Huge engineering
APIs, which means malicious apps have the capability to efforts are needed to implement an equivalent rule engine that
steal user data collected by the platform. The literature [41], supports the same programming framework and APIs as well
[46], [79], [80] also demonstrated that IoT apps/rules can as maintaining them in a long run. Therefore, we strategically
be exploited to breach user privacy. FlowFence [9] enforced separate the data-filtering policy engine and the rule engine;
a data flow control mechanism for sensitive data protection. and PFIREWALL only deals with data filtering.
However, unlike our work, FlowFence protects sensitive data
from unauthorized apps rather than the platform, which is Pull Strategies. There are two pull-based models for home
trusted in their threat model. Plus, FlowFence requires the automation:batchpullandlazypull.Arepresentativeplatform
14
employingbatchpullisIFTTT,whichpollsthemostrecentN any incoming traffic initiated by unknown sources. Although
(50 by default) events about once every hour [98]. This model it is possible that the platform could detect PFIREWALL and
still does not take data minimization into consideration. Lazy behaveadversely,itcannotobtainmoresensitivedatabydoing
pull is a naive privacy-preserving framework where platforms sobecausePFIREWALLbydesignonlypassesdatathatenables
only pull the current state of devices when needed instead of the execution of automation rules that are specified by users.
expectingdevicestocontinuouslypushdatatothem.Lazypull
is probably impractical for home automation, as the platforms
IX. CONCLUSION
cannot predict the occurrence of device events. To our best
knowledge, no smart home platforms use lazy pull. We presented PFIREWALL, a semantics-aware customiz-
able data flow control system for protecting privacy of
User efforts. To deploy PFIREWALL, users only need to pair smart home owners. PFIREWALL filters data by enforcing
their IoT devices with PFIREWALL mediator and operate on data-minimization policies automatically derived from au-
the mobile companion app to connect PFIREWALL with the tomation applications and, optionally, user-specified policies.
target platform. All these operations are similar to using their We overcame multiple challenges and designed an elegant
original platforms and users do not need any expertise. virtualization-based mediating system, which enforces the
policies without modifying IoT platforms or devices. We
Compatibility. Besides home automation, a dashboard func-
implemented a prototype of PFIREWALL and evaluated it in
tion for viewing and controlling device states is usually
four real-world testbeds with various IoT devices of different
provided on a companion mobile app by the IoT platform.
communication protocols (ZigBee, Z-Wave, and WiFi). The
With PFIREWALL, the dashboard may not always display the
evaluation results demonstrated that PFIREWALL can signif-
correct device states. However, this does not undermine the
icantly reduce sensitive data leakage without affecting home
value of PFIREWALL, which can be deployed as a privacy
automation.Itseverelyimpairstheattacker’sabilitytomonitor
enhancingadd-onforprivacy-conscioususerswhomainlyuse
and infer a homeowner’s privacy-sensitive behaviors. Besides
the platform for automation. It is worth noting that occasional
smart homes, PFIREWALL can also significantly enhance pri-
remote access from the companion app does not justify that
vacyformanyothersmartenvironments,suchassmartoffices,
IoT data should continuously flow to the platform. With a
hospitals and factories.
small amount of engineering effort, PFIREWALL can provide
an equivalent dashboard on its mobile app, which can be used
by users for viewing and controlling device states. End-to-end ACKNOWLEDGMENT
encryption can be used to protect data transmissions between
We thank the anonymous reviewers for their construc-
the local PFIREWALL mediator and the mobile app, such that
tive suggestions. This work was supported in part by the
datawillnotbedisclosedtotheplatformorthirdparties(e.g.,
US National Science Foundation (NSF) under grants CNS-
cloud-based relay servers).
1828363,CNS-1564128,CNS-1824440,CNS-2016589,CNS-
1856380, CNS-2016415, CNS-1850278, CNS-1815144, and
Generalizability.Althoughourprototypeimplementationsare
CNS-1953073.
onSmartThingsandopenHAB,thepresentedapproachcanbe
adapted to other IoT systems. As discussed in Section V-B,
it is practical to implement such a mediator in most systems. REFERENCES
On one hand, the mediator could be extended to connect a
[1] “IoT platforms company list 2017 update,” https://www.statista.com/
large portion of IoT devices (see Section V-B1). On the other
statistics/805061/global-smart-systems-services-iot-platform-market-
hand, the mediator could interface with many platforms via a size-by-region/,2018.
communicationtechnologysupportedbytheplatform.Finally, [2] “SmartThings,”https://www.smartthings.com/,2020.
aspectrumoftechniquessuchascodeanalysis,UIparsing,and [3] “Amazon Alexa,” https://developer.amazon.com/en-US/alexa/devices/
NLPhavebeenemployedforextractingautomationrulesfrom smart-home-devices,2020.
IoT apps or web/mobile interfaces. Therefore, PFIREWALL [4] “openHAB – an open-source platform for empowering home automa-
can be extended to support more devices and platforms with tion,”https://www.openhab.org/,2020.
some engineering efforts. The impact of unsupported devices [5] S.Zheng,N.Apthorpe,M.Chetty,andN.Feamster,“Userperceptions
(which have no APIs) depends on how many such devices are of smart home iot privacy,” Proceedings of the ACM on Human-
ComputerInteraction,vol.2,no.CSCW,p.200,2018.
deployed in a particular home. A large-scale investigation on
[6] E.Zeng,S.Mare,andF.Roesner,“Endusersecurity&privacyconcerns
realhouseholdsthathaveIoTdeviceswillbehelpfultoanswer
with smart homes,” in Symposium on Usable Privacy and Security
this question. This will be our future work.
(SOUPS),2017.
[7] Z. B. Celik, L. Babun, A. K. Sikder, H. Aksu, G. Tan, P. McDaniel,
Attack surface. Like many existing IoT security systems
andA.S.Uluagac,“Sensitiveinformationtrackingincommodityiot,”
(ContexIoT [46], IoTGuard [11], FACT [69]), our proto- inUSENIXSecuritySymposium,2018.
type adds an additional component to a smart home, which
[8] I.Bastys,M.Balliu,andA.Sabelfeld,“Ifthisthenwhat?:Controlling
might become a potential target of attackers. We argue that flowsiniotapps,”inProceedingsofthe2018ACMSIGSACConference
PFIREWALL can be considered as an IoT hub (with privacy onComputerandCommunicationsSecurity. ACM,2018,pp.1102–
protection functionalities), so conceptually it does not make a 1119.
smart home more exploitable. PFIREWALL employs existing [9] E. Fernandes, J. Paupore, A. Rahmati, D. Simionato, M. Conti, and
A. Prakash, “Flowfence: Practical data protection for emerging iot
communication technologies used by IoT devices and plat-
applicationframeworks.”inUSENIXSecuritySymposium,2016.
forms to connect them and does not introduce new protocols.
[10] Y.Tian,N.Zhang,Y.-H.Lin,X.Wang,B.Ur,X.Guo,andP.Tague,
Furthermore, PFIREWALL knowswhoitshouldtalkwith,soit
“Smartauth: User-centered authorization for the internet of things,” in
canmaintainawhitelist,usinganembeddedfirewall,todiscard USENIXSecuritySymposium,2017.
15
[11] Z.B.Celik,G.Tan,andP.McDaniel,“IoTGuard:Dynamicenforcement [35] O.Alrawi,C.Lever,M.Antonakakis,andF.Monrose,“Sok:Security
ofsecurityandsafetypolicyincommodityiot,”2019. evaluationofhome-basediotdeployments,”inProceedingsoftheIEEE
[12] D. T. Nguyen, C. Song, Z. Qian, S. V. Krishnamurthy, E. J. Colbert,
SymposiumonSecurityandPrivacy(S&P).https://doi.org/10.1109/SP,
andP.McDaniel,“Iotsan:fortifyingthesafetyofiotsystems,”inPro- 2019.
ceedingsofthe14thInternationalConferenceonemergingNetworking [36] J. Wurm, K. Hoang, O. Arias, A.-R. Sadeghi, and Y. Jin, “Security
EXperimentsandTechnologies. ACM,2018,pp.191–203. analysisonconsumerandindustrialiotdevices,”in201621stAsiaand
[13] K.-H. Hsu, Y.-H. Chiang, and H.-C. Hsiao, “Safechain: Securing SouthPacificDesignAutomationConference(ASP-DAC). IEEE,2016,
trigger-actionprogrammingfromattackchains,”IEEETransactionson pp.519–524.
InformationForensicsandSecurity,2019. [37] G. Acar, D. Y. Huang, F. Li, A. Narayanan, and N. Feamster, “Web-
[14] A. Acar, H. Fereidooni, T. Abera, A. K. Sikder, M. Miettinen,
basedattackstodiscoverandcontrollocaliotdevices,”inProceedings
H. Aksu, M. Conti, A.-R. Sadeghi, and A. S. Uluagac, “Peek-a-boo:
ofthe2018WorkshoponIoTSecurityandPrivacy,2018,pp.29–35.
I see your smart home activities, even encrypted!” arXiv preprint [38] E.RonenandA.Shamir,“Extendedfunctionalityattacksoniotdevices:
arXiv:1808.02741,2018. The case of smart lights,” in 2016 IEEE European Symposium on
[15] T.Datta,N.Apthorpe,andN.Feamster,“Adeveloper-friendlylibrary SecurityandPrivacy(EuroS&P). IEEE,2016,pp.3–12.
forsmarthomeiotprivacy-preservingtrafficobfuscation,”inProceed- [39] T. Chomsiri, “Sniffing packets on lan without arp spoofing,” in 2008
ingsofthe2018WorkshoponIoTSecurityandPrivacy. ACM,2018, ThirdInternationalConferenceonConvergenceandHybridInformation
pp.43–48. Technology,vol.2. IEEE,2008,pp.472–477.
[16] N.Apthorpe,D.Reisman,andN.Feamster,“Closingtheblinds:Four [40] W. A. Arbaugh, N. Shankar, Y. J. Wan, and K. Zhang, “Your 80211
strategiesforprotectingsmarthomeprivacyfromnetworkobservers,” wireless network has no clothes,” IEEE Wireless Communications,
arXivpreprintarXiv:1705.06809,2017. vol.9,no.6,pp.44–51,2002.
[17] N.Apthorpe,D.Reisman,S.Sundaresan,A.Narayanan,andN.Feam- [41] E.Fernandes,J.Jung,andA.Prakash,“Securityanalysisofemerging
ster, “Spying on the smart home: Privacy attacks and defenses on smarthomeapplications,”inIEEESymposiumonSecurityandPrivacy
encryptediottraffic,”arXivpreprintarXiv:1708.05044,2017. 2016.
[18] “Bupasuffersmajordatabreachasdisgruntledemployeestealsdata,” [42] “RESTAPI,”https://restfulapi.net/,2020.
https://www.cbronline.com/cybersecurity/breaches/bupa-major-data- [43] J.Bae,H.Bae,S.-H.Kang,andY.Kim,“Automaticcontrolofworkflow
breach-disgruntled-employee-steals-data/,2017. processesusingECArules,”IEEEtransactionsonknowledgeanddata
[19] “The 17 biggest data breaches of the 21st century,” engineering,vol.16,no.8,pp.1010–1023,2004.
https://www.csoonline.com/article/2130877/data-breach/the-biggest- [44] W. Brackenbury, A. Deora, J. Ritchey, J. Vallee, W. He, G. Wang,
data-breaches-of-the-21st-century.html,2018. M.L.Littman,andB.Ur,“Howusersinterpretbugsintrigger-action
[20] “Wink terms of use and privacy policy,” https://www.wink.com/legal/, programming,”inProceedingsofthe2019CHIConferenceonHuman
2018. FactorsinComputingSystems. ACM,2019,p.552.
[21] “SmartThings privacy policy,” https://www.smartthings.com/privacy, [45] E. Fernandes, A. Rahmati, K. Eykholt, and A. Prakash, “Internet of
2018. things security research: A rehash of old ideas or new intellectual
[22] “Veratermsandconditions,”http://getvera.com/legal/,2018.
challenges?”IEEESecurity&Privacy,vol.15,no.4,pp.79–84,2017.
[23] “Europeangeneraldataprotectionregulation,”https://eur-lex.europa.eu/ [46] Y.J.Jia,Q.A.Chen,S.Wang,A.Rahmati,E.Fernandes,Z.M.Mao,
legal-content/EN/TXT/PDF/?uri=CELEX:32016R0679,2016. andA.Prakash,“Contexiot:Towardsprovidingcontextualintegrityto
appifiediotplatforms,”inProceedingsofTheNetworkandDistributed
[24] H. Chi, Q. Zeng, X. Du, and J. Yu, “Cross-app interference threats SystemSecuritySymposium,2017.
insmarthomes:Categorization,detectionandhandling,”in202050th
Annual IEEE/IFIP International Conference on Dependable Systems [47] I. Hwang, M. Kim, and H. J. Ahn, “Data pipeline for generation and
andNetworks(DSN). IEEE,2020,pp.411–423. recommendation of the iot rules based on open text data,” in IEEE
WAINA,2016.
[25] Z. B. Celik, P. McDaniel, and G. Tan, “Soteria: Automated iot safety
andsecurityanalysis,”inUSENIXSecuritySymposium,2018. [48] “SmartThingscapabilities,”https://smartthings.developer.samsung.com/
docs/api-ref/capabilities.html,2020.
[26] W.Zhang,Y.Meng,Y.Liu,X.Zhang,Y.Zhang,andH.Zhu,“Homonit:
Monitoringsmarthomeappsfromencryptedtraffic,”inProceedingsof [49] “JavaScript linear programming solver,” https://www.npmjs.com/
the2018ACMSIGSACConferenceonComputerandCommunications package/javascript-lp-solver,2016.
Security. ACM,2018,pp.1074–1088. [50] “Clear connect rf,” https://www.lutron.com/en-US/CaseStudyPDF/
[27] W. Ding and H. Hu, “On the safety of iot device physical interaction Clear%20Connect%20Technology%20whitepaper.pdf,2019.
control,” in Proceedings of the 2018 ACM SIGSAC Conference on [51] “Homekit accessory protocol,” https://developer.apple.com/support/
ComputerandCommunicationsSecurity. ACM,2018,pp.832–846. homekit-accessory-protocol/,2020.
[28] “Mozilla IoT – a smart home protect by Mozilla,” https://iot.mozilla. [52] “GSM,”https://www.gsma.com/,2020.
org/,2019.
[53] “LAN-connecteddevices,”https://docs.smartthings.com/en/latest/cloud-
[29] C. D. Coley and R. E. Wesinger Jr, “Firewall system for protecting and-lan-connected-device-types-developers-guide/index.html,2018.
network elements connected to a public network,” Oct. 20 1998, uS
[54] “Types of device integrations on SmartThings,” https://smartthings.
Patent5,826,014.
developer.samsung.com/docs/devices/device-basics.html,2020.
[30] R. E. Wesinger Jr and C. D. Coley, “Firewall providing enhanced
[55] “MQTT Binding,” https://www.openhab.org/addons/bindings/mqtt/,
network security and user transparency,” Apr. 27 1999, uS Patent
2019.
5,898,830.
[56] “WebofThings,”https://webofthings.org,2019.
[31] H. Chi, Q. Zeng, X. Du, and L. Luo, “Pfirewall: Semantics-aware
customizable data flow control for home automation systems,” arXiv [57] “Wink APIs: A RESTful Service,” https://winkapiv2.docs.apiary.io/
preprintarXiv:1910.07987,2019. #reference/a-restful-service,2019.
[32] “SmartThingsGroovyIDE,”https://graph.api.smartthings.com/,2020. [58] “SmartThings schema connector,” https://smartthings.developer.
samsung.com/docs/devices/smartthings-schema/schema-basics.html,
[33] R. Trimananda, J. Varmarken, A. Markopoulou, and B. Demsky,
2020.
“Packet-levelsignaturesforsmarthomedevices,”inProceedingsofthe
NetworkandDistributedSystemSecuritySymposium(NDSS),2020. [59] “frp,”https://github.com/fatedier/frp,2020.
[34] T.OConnor,W.Enck,andB.Reaves,“Blindedandconfused:uncov- [60] “SmartThings developer workspace,” https://smartthings.developer.
ering systemic flaws in device telemetry for smart-home internet of samsung.com/workspace,2020.
things,”inProceedingsofthe12thConferenceonSecurityandPrivacy [61] “Interaction types,” https://smartthings.developer.samsung.com/docs/
inWirelessandMobileNetworks(WiSec),2019. devices/smartthings-schema/smartthings-schema-reference.html,2020.
16
[62] “openHAB configuration guide,” https://www.openhab.org/docs/ practical security and safety analyses,” in 2020 IEEE Symposium on
configuration/things.html,2020. SecurityandPrivacy(SP). IEEE,2020,pp.482–499.
[63] “openHAB REST API,” https://www.openhab.org/docs/configuration/ [81] R. Xu, Q. Zeng, L. Zhu, H. Chi, X. Du, and M. Guizani, “Privacy
restdocs.html,2020. leakageinsmarthomesanditsmitigation:Iftttasacasestudy,”IEEE
Access,vol.7,pp.63457–63471,2019.
[64] P. Rashidi, D. J. Cook, L. B. Holder, and M. Schmitter-Edgecombe,
“Discoveringactivitiestorecognizeandtrackinasmartenvironment,” [82] A. K. Simpson, F. Roesner, and T. Kohno, “Securing vulnerable
IEEEtransactionsonknowledgeanddataengineering,vol.23,no.4, home iot devices with an in-hub security manager,” in 2017 IEEE
pp.527–539,2010. InternationalConferenceonPervasiveComputingandCommunications
Workshops(PerComWorkshops). IEEE,2017,pp.551–556.
[65] R. Hammid, S. Maddi, A. Johnson, A. Bobick, I. Essa, and C. L. Is-
bell,“Unsupervisedactivitydiscoveryandcharacterizationfromevent- [83] “Veracode white paper - iots security research study,”
streams,”arXivpreprintarXiv:1207.1381,2012. https://www.veracode.com/sites/default/files/Resources/Whitepapers/
internet-of-things-whitepaper.pdf,2015.
[66] T. Gu, Z.Wu, X. Tao, H. K. Pung,and J. Lu, “epsicar: Anemerging
patternsbasedapproachtosequential,interleavedandconcurrentactiv- [84] A. Khan, N. Al-Darwish, M. Guizani, M. Benten, and H. Youssef,
ity recognition,” in 2009 IEEE International Conference on Pervasive “Designandimplementationofasoftwarebridgewithpacketfiltering
ComputingandCommunications. IEEE,2009,pp.1–9. and statistics collection functions,” International Journal of Network
Management,vol.7,no.5,pp.251–263,1997.
[67] K. Viard, M. P. Fanti, G. Faraut, and J.-J. Lesage, “An event-based
[85] J. Liu and Y. Ma, “Packet filtering in bridge,” in 1999 Internet
approach for discovering activities of daily living by hidden markov
Workshop.IWS99.(Cat.No.99EX385). IEEE,1999,pp.94–98.
models,” in 2016 15th International Conference on Ubiquitous Com-
puting and Communications and 2016 International Symposium on [86] K.ParkandH.Lee,“Ontheeffectivenessofroute-basedpacketfiltering
CyberspaceandSecurity(IUCC-CSS). IEEE,2016,pp.85–92. for distributed dos attack prevention in power-law internets,” ACM
SIGCOMM computer communication review, vol. 31, no. 4, pp. 15–
[68] A. Rahmati, E. Fernandes, K. Eykholt, and A. Prakash, “Tyche:
26,2001.
Risk-based permissions for smart home platforms,” arXiv preprint
arXiv:1801.04609,2018. [87] K.InghamandS.Forrest,“Ahistoryandsurveyofnetworkfirewalls,”
UniversityofNewMexico,Tech.Rep,2002.
[69] S. Lee, J. Choi, J. Kim, B. Cho, S. Lee, H. Kim, and J. Kim,
“Fact:Functionality-centricaccesscontrolsystemforiotprogramming [88] B. Cheswick, “The design of a secure internet gateway,” in USENIX
frameworks,”inProceedingsofthe22ndACMonSymposiumonAccess SummerConferenceProceedings. Citeseer,1990.
ControlModelsandTechnologies. ACM,2017,pp.43–54. [89] E.Viegas,A.O.Santin,A.Franca,R.Jasinski,V.A.Pedroni,andL.S.
[70] S. Demetriou, N. Zhang, Y. Lee, X. Wang, C. A. Gunter, X. Zhou, Oliveira, “Towards an energy-efficient anomaly-based intrusion detec-
and M. Grace, “Hanguard: Sdn-driven protection of smart home wifi
tionengineforembeddedsystems,”IEEETransactionsonComputers,
devicesfrommaliciousmobileapps,”inProceedingsofthe10thACM vol.66,no.1,pp.163–177,2016.
ConferenceonSecurityandPrivacyinWirelessandMobileNetworks. [90] T.Krueger,C.Gehl,K.Rieck,andP.Laskov,“Tokdoc:Aself-healing
ACM,2017,pp.122–133. webapplicationfirewall,”inProceedingsofthe2010ACMSymposium
onAppliedComputing,2010,pp.1846–1853.
[71] H.Chi,Q.Zeng,X.Du,andJ.Yu,“Cross-appinterferencethreatsin
smart homes: Categorization, detection and handling,” arXiv preprint [91] S.Prandl,M.Lazarescu,andD.-S.Pham,“Astudyofwebapplication
arXiv:1808.02125,2018. firewallsolutions,”inInternationalConferenceonInformationSystems
Security. Springer,2015,pp.501–510.
[72] Q.Wang,P.Datta,W.Yang,S.Liu,A.Bates,andC.A.Gunter,“Chart-
ingtheattacksurfaceoftrigger-actioniotplatforms,”inProceedingsof [92] M.Yoon,S.Chen,andZ.Zhang,“Minimizingthemaximumfirewall
ACMSIGSACConferenceonComputerandCommunicationsSecurity rule set in a network with multiple firewalls,” IEEE Transactions on
(CCS),2019. Computers,vol.59,no.2,pp.218–230,2009.
[73] X. Li, F. Yan, F. Zuo, Q. Zeng, and L. Luo, “Touch well before use: [93] C. Bodei, P. Degano, L. Galletta, R. Focardi, M. Tempesta, and
Intuitiveandsecureauthenticationforiotdevices,”inThe25thAnnual L.Veronese,“Language-independentsynthesisoffirewallpolicies,”in
InternationalConferenceonMobileComputingandNetworking,2019, 2018IEEEEuropeanSymposiumonSecurityandPrivacy(EuroS&P).
pp.1–17. IEEE,2018,pp.92–106.
[74] X. Li, Q. Zeng, L. Luo, and T. Luo, “T2pair: Secure and usable [94] N.B.Youssef,A.Bouhoula,andF.Jacquemard,“Automaticverification
pairingforheterogeneousiotdevices,”inProceedingsofthe2020ACM ofconformanceoffirewallconfigurationstosecuritypolicies,”in2009
SIGSACConferenceonComputerandCommunicationsSecurity,2020, IEEE Symposium on Computers and Communications. IEEE, 2009,
pp.309–323. pp.526–531.
[95] B.Zhang,E.Al-Shaer,R.Jagadeesan,J.Riely,andC.Pitcher,“Speci-
[75] C. Fu, Q. Zeng, and X. Du, “Hawatcher: Semantics-aware anomaly
ficationsofahigh-levelconflict-freefirewallpolicylanguageformulti-
detection for appified smart homes,” in USENIX Security Symposium,
domain networks,” in Proceedings of the 12th ACM symposium on
2021.
Accesscontrolmodelsandtechnologies,2007,pp.185–194.
[76] N. Carlini, P. Mishra, T. Vaidya, Y. Zhang, M. Sherr, C. Shields,
[96] E.S.Al-ShaerandH.H.Hamed,“Firewallpolicyadvisorforanomaly
D. Wagner, and W. Zhou, “Hidden voice commands,” in 25th
discoveryandruleediting,”inInternationalSymposiumonIntegrated
{USENIX} Security Symposium ({USENIX} Security 16), 2016, pp.
NetworkManagement. Springer,2003,pp.17–30.
513–530.
[97] F. A. Maldonado-Lopez, E. Calle, and Y. Donoso, “Detection and
[77] N. Carlini and D. Wagner, “Audio adversarial examples: Targeted at-
prevention of firewall-rule conflicts on software-defined networking,”
tacksonspeech-to-text,”in2018IEEESecurityandPrivacyWorkshops
in20157thInternationalWorkshoponReliableNetworksDesignand
(SPW). IEEE,2018,pp.1–7.
Modeling(RNDM). IEEE,2015,pp.259–265.
[78] Q.Zeng,J.Su,C.Fu,G.Kayas,L.Luo,X.Du,C.C.Tan,andJ.Wu,
[98] “General API requirements,” https://platform.ifttt.com/docs/api
“A multiversion programming inspired approach to detecting audio
reference,2020.
adversarial examples,” in 2019 49th Annual IEEE/IFIP International
ConferenceonDependableSystemsandNetworks(DSN). IEEE,2019,
pp.39–51. APPENDIX
[79] M. Surbatovich, J. Aljuraidan, L. Bauer, A. Das, and L. Jia, “Some
A. User Study
recipescandomorethanspoilyourappetite:Analyzingthesecurityand
privacyrisksofiftttrecipes,”inProceedingsofthe26thInternational
1)Setup: Weconductausersurveytostudyusers’attitude
Conference on World Wide Web. International World Wide Web
ConferencesSteeringCommittee,2017,pp.1501–1510. andabilitiestowardsdefiningcustomizeddata-protectionpoli-
cies with our policy templates (Section V-A2). We recruit 20
[80] S. Manandhar, K. Moran, K. Kafle, R. Tang, D. Poshyvanyk, and
A. Nadkarni, “Towards a natural perspective of smart homes for adult participants who are knowledgeable about the concepts
17
(a) (b) (c) (d)
Fig. 13: ThePFirewallSurveymobileappusedintheusersurvey.
“home automation”, “smart home” or “IoT” from our institu- outlets. Regarding the usability of our policy templates, 8
tions. Participants completed the trial tasks of our “PFirewall participants thought the templates are “very easy” to use and
Survey” app in our lab using smartphones we provided and 12 participants thought them “easy” to use. Three participants
after that answered several questions. found that they could not specify policies to control data by
specifyingmultipleconditionswiththetemplates,forexample,
Weaskedtheparticipantstogetfamiliarwithasmarthome
the combination of a device state and a specified time period.
setting where 10 automation rules (Fig. 13(b)) are configured
According to the feedback, we address this issue by allowing
to work with 15 devices (Fig. 13(a)). The app provides a page
userstochooseiftheywouldliketoaddanewonerecursively
(Fig. 13(c)) to illustrate the architecture of the system and the
after they complete a condition.
potential risks of data leakage; we did not explain the content
and ask questions about this page to avoid influencing the Overall, participants concern data privacy and hold a pos-
understanding of end-users by factors other than the interface itive attitude in defining own policies with our templates. The
itself. Besides, the app also provides an interface showing the result also shows that participants may overlook the privacy
list of 15 devices; when a device is selected, the app switches risks of some devices like humidity sensor and powers, which
to a device detail page (e.g., Fig. 13(d)) showing what data wehavediscussedinSectionVI-C4.Hence,data-minimization
the device generates and what privacy risks are imposed if policies and user-specified policies could work together to
the data are leaked. In addition, policy templates (as shown in achieve better privacy protection.
Fig. 5(b)) were provided for participants to define their own
policies. After a 30-minute trial, participants were asked to B. IRB Approval
answer questions.
Ourtestbedsneedtocollectdatafromthetestbedproviders,
2)Results: All 20 participants cared about their data pri- including the 5 office members and 5 apartment members.
vacyandthoughtitusefultodefinetheirowndataflowpolicies Also,ouruserstudyinvolves20participants.Wehavereceived
for protecting privacy. However, 2 participants thought they the approval from the IRB in the institution where all the
would not spend time in defining policies even if an app above investigations are performed. The testbed providers and
is available. We collect the number of participants who had surveyparticipants(undergraduateandgraduatestudents)were
privacy concerns on each listed device. Cameras and smart recruited through emails and flyers. $500 was paid to the
speakers were the top two devices whose data are considered participants of each testbed and $50 was paid to each survey
sensitive by the participants (19 and 16, respectively); half or participant.
more participants had concerns on the status data of smart
We value the participants’ privacy during our investigation
locks, doors and windows (11, 13, 10, respectively); Each of
processes. The data collected from all testbeds do not contain
humidity sensors, heaters, lights, powers and coffee makers is
personally identifiable information and location data. The
concerned by less than 3 participants.
collecteddatawillbetransmittedtoandstoredinthepassword
Besidesthelisteddevices,theparticipantsalsocaredabout protectedcomputerofoneoftheauthors.Computersthatstore
the data privacy of smart TVs, smart window blinds, smart datahavepassword-protectedaccountsandwillbeinalocked
18
office that has limited access. Only the researchers identified without revealing any personally identifiable information. The
on this protocol will have access to the data. Survey partic- questionnairewillbestoredinthelockedofficeafteranalyses.
ipants are asked to submit their questionnaire anonymously
19