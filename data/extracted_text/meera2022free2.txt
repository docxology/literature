Delft University of Technology
Free Energy Principle for the Noise Smoothness Estimation of Linear Systems with
Colored Noise
Anil Meera, A.; Wisse, M.
DOI
10.1109/CDC51059.2022.9992717
Publication date
2022
Document Version
Final published version
Published in
Proceedings of the IEEE 61st Conference on Decision and Control (CDC 2022)
Citation (APA)
Anil Meera, A., & Wisse, M. (2022). Free Energy Principle for the Noise Smoothness Estimation of Linear
Systems with Colored Noise. In Proceedings of the IEEE 61st Conference on Decision and Control (CDC
2022) (pp. 1888-1893). IEEE. https://doi.org/10.1109/CDC51059.2022.9992717
Important note
To cite this publication, please use the final published version (if applicable).
Please check the document version above.
Copyright
Other than for strictly personal use, it is not permitted to download, forward or distribute the text or part of it, without the consent
of the author(s) and/or copyright holder(s), unless the work is under an open content license such as Creative Commons.
Takedown policy
Please contact us and provide details if you believe this document breaches copyrights.
We will remove access to the work immediately and investigate your claim.
This work is downloaded from Delft University of Technology.
For technical reasons the number of authors shown on this cover page is limited to a maximum of 10.
Green Open Access added to TU Delft Institutional Repository
'You share, we take care!' - Taverne project
https://www.openaccess.nl/en/you-share-we-take-care
Otherwise as indicated in the copyright section: the publisher
is the copyright holder of this work and the author uses the
Dutch legislation to make this work public.
2022 IEEE 61st Conference on Decision and Control (CDC)
December 6-9, 2022. Cancún, Mexico
Free Energy Principle for the Noise Smoothness Estimation of
Linear Systems with Colored Noise
Ajith Anil Meera and Martijn Wisse
Abstract—Thefreeenergyprinciple(FEP)fromneuroscience II. RELATEDWORK
provides a framework called active inference for the joint
This section highlights the interdisciplinary nature of FEP
estimation and control of state space systems, subjected to
colored noise. However, the active inference community has with related works in neuroscience and robotics literature.
been challenged with the critical task of manually tuning
A. Neuroscience
the noise smoothness parameter. To solve this problem, we
introduce a novel online noise smoothness estimator based on According to FEP, all biological systems resist their nat-
theideaoffreeenergyprinciple.Wemathematicallyshowthat
ural tendency to disorder by minimizing an information
ourestimatorcanconvergetothefreeenergyoptimumduring
theoretic measure called free energy [6], which bounds its
smoothness estimation. Using this formulation, we introduce a
joint state and noise smoothness observer design called DEMs. sensory surprisal. FEP emerges as a unified theory of the
Throughrigoroussimulations,weshowthatDEMsoutperforms brain by providing a mathematical framework for brain
state-of-the-artstateobserverswithleaststateestimationerror. functions[9],unifyingactionandperception[10],explaining
Finally,weprovideaproofofconceptforDEMsbyapplyingit Freudian ideas [11], and connecting memory and attention
onarealliferoboticsproblem-stateestimationofaquadrotor
[9].TheworkclosesttoourproposedideaistheGeneralized
hovering in wind, demonstrating its practical use.
filtering [12] that uses FEP for noise smoothness estimation
I. INTRODUCTION during the inversion of dynamic models of the brain (fMRI
data) [13]. We extend this idea into robotics to design an
Therisingdemandforautonomousdronedeliverysystems
online state and noise smoothness observer for applications
has increased the need for accurate state observers that are
like quadrotor flights with wind as colored noise.
robust against uncertain events like strong wind currents.
These unmodelled wind currents induce colored noise to the
B. Robotics and control
system, hindering the safe operation of drones. We take a
Numerous approaches for state estimation under colored
step in this direction by using the ideas from computational
noise exists in the control systems literature [1]. SA models
neurosciencetointroduceanovelstateandnoisesmoothness
the colored process noise in a state space system as auto-
observer design for linear systems with colored noise.
regressive(AR)noise.Thesystemisthentransformedintoan The classical linear estimators like Kalman Filter (KF)
equivalent augmented system influenced by white noise [3].
assumes the noises to be white. This assumption is often
Another approach is to incorporate the temporal correlations violated in practice, resulting in a sub-optimal estimation
of the AR noise into the prior covariance calculation of KF,
[1]. Many adaptations on KF have been introduced to over-
resulting in an extended KF called SMIKF [2]. MD [4]
come this challenge, including Second Moment Information
approach deals with handling colored measurement noise.
Kalman filter (SMIKF) [2], State Augmentation (SA) [3],
However,thewhitenoiseassumptionisprevalentinrobotics
Measurement Differencing (MD) [4] etc. Dynamic Expec-
for the state estimation of a quadrotor [14], which might not
tation Maximization (DEM) [5], based on Free Energy
be effective in outdoor windy conditions [8]. Our work fills
Principle(FEP)[6]fromneurosciencehasrecentlybeenused
this research gap by providing an online noise smoothness
to design state and input observers [7] that has shown to
estimator.
outperform the classical methods both in simulation and in
The brain inspired nature of FEP has already inspired the
realrobotexperiments[8].ThemainadvantageofDEMisits
development of intelligent agents [15] – body perception of
capability to seamlessly handle colored noise [7]. However,
humanoidrobots[16],estimationandcontrolofmanipulator
DEM requires the prior knowledge of the noise smoothness
robot [17], system identification of a quadrotor [18], SLAM
parameter for the accurate state estimation. To solve this
[19], PID controller [20], KF [8], [21] etc. These active
problem, we introduce a novel online noise smoothness
inference applications can employ our noise estimator for
estimator based on FEP, for linear systems with colored
better estimation and control of robots during colored noise.
noise. The core contributions of the paper include:
1) introduction of an online smoothness estimator for the III. PROBLEMSTATEMENT
state estimation of linear systems under colored noise,
Consider the linear plant dynamics given in Equation 1
2) extensiveevaluationoftheestimatorinsimulationand where A, B and C are constant system matrices, x∈Rn is
its validation on a real robot (quadrotor flight) data. thehiddenstate,v∈Rr istheinputandy∈Rm istheoutput.
BothauthorsarewiththeDepartmentofCognitiveRoboticsatTUDelft,
x˙ =Ax+Bv+w, y=Cx+z. (1)
TheNetherlands.Correspondingauthor:ajitham1994@gmail.com
978-1-6654-6761-2/22/$31.00 ©2022 IEEE 1888
7172999.2202.95015CDC/9011.01
:IOD
| EEEI
2202©
00.13$/22/2-1676-4566-1-879
| )CDC(
lortnoC
dna
noisiceD
no
ecnerefnoC
ts16
EEEI
2202
Authorized licensed use limited to: TU Delft Library. Downloaded on January 23,2023 at 11:50:14 UTC from IEEE Xplore. Restrictions apply.
Here w∈Rn and z∈Rm represent the process and mea- derivatives take a specific structure [5]. The smoothness
surement noise with noise precision (inverse covariance) Πw matrix defining this relation for p=6 is calculated as [7]:
and Πz respectively. Variables of the plant are denoted in  35 0 35s2 0 7s4 0 1s6 
boldface, while its estimates are denoted in non-boldface. In 16 8 4 6
 0 35s2 0 7s4 0 s6 0 
this paper, the white noise is convoluted with a Gaussian   35s2 4 0 77s4 0 19s6 0 s8  
filter of kernel width s to generate the colored noise.  8 4 2 
S= 0 7s4 0 8s6 0 4s8 0 , (4)
The problem considered in this paper is the state (x)  3 
 7s4 0 19s6 0 17s8 0 2s10
and noise smoothness (s) observer design (DEMs) for the  4 2 3 3 
 0 s6 0 4s8 0 4 s10 0 
linearsystemgiveninEquation1,subjectedtocolorednoise. 3 15
1s6 0 s8 0 2s10 0 4 s12
We show that our observer outperforms state-of-the-art state 6 3 45
observers,bothinsimulation(SectionVIII)andonrealrobot where s is the kernel width of the Gaussian filter. s≈0 is
data (Section IX). high frequency white noise. Since s<1 second for practical
cases (sensors have high sampling rate), the first elements
IV. NOISECOLORMODELLING
in S matrix are higher than the last ones, implying a higher
The two key concepts behind the success of DEM in correlationbetweenthefirstnoisederivatives(moresmooth)
handling the colored noise are i) the use of generalized co- than the last derivatives (less smooth). The combined (gen-
ordinates and ii) the noise precision modelling. This section eralized) noise precision matrix can be written using S as:
aims to elaborate on these theoretical concepts. (cid:20) S⊗Πz 0 (cid:21)
Π˜ = . (5)
0 S⊗Πw
A. Generalized coordinates
With the key concepts in place, the next section derives the
Generalized coordinates is a vector representation of the
free energy formulations that are necessary for the observer
trajectoryofatimevaryingquantity(x,v,y)usingacollection
design in Section VI.
of its higher order derivatives. For example, the state vector
in generalized coordinates is written using a tilde operator V. FREEENERGYOPTIMIZATION
as x˜=[x x′ x′′ ....]T, where the dash operator represents the
FEP uses Bayesian Inference to estimate the posterior
derivatives. The key advantage is the capability to track the (cid:82)
probability p(ϑ/y)= p(ϑ,y/ p(ϑ,y)dϑ, where ϑ is the
trajectory of states, unlike the classical estimators that track
componenttobeestimated(ϑ={x˜,s}),andyisthemeasure-
only the point estimates. This provides additional data for
ment [22]. The presence of an intractable integral motivates
DEMduringestimation,resultinginitssuperiorperformance
the use of a variational density q(ϑ), called the recognition
duringstateestimationundercolorednoise.Sincethenoises
density that approximates the posterior as q(ϑ)≈ p(ϑ/y).
are colored, the higher derivatives of the system model can
ThisapproximationisachievedbyminimizingtheKullback-
be written as [5]:
Leibler (KL) divergence of the distributions given by
x′=Ax+Bv+w y=Cx+z KL(q(ϑ)||p(ϑ/y))=⟨lnq(ϑ)⟩ −⟨lnp(ϑ/y)⟩ , where
q(ϑ) q(ϑ)
x′′=Ax′+Bv′+w′ y′=Cx′+z′ (2) ⟨.⟩ q(ϑ) represents the expectation over q(ϑ). Upon simplifi-
cation using p(ϑ/y)=p(ϑ,y)/p(y), it reduces to [6]:
... ...
lnp(y)=F+KL(q(ϑ)||p(ϑ|y)), (6)
which can be compactly written as:
whereF=⟨lnp(ϑ,y)⟩ −⟨lnq(ϑ)⟩ isthefreeenergy.
x˙˜=Dxx˜=A˜x˜+B˜v˜+w˜ y˜=C˜x˜+z˜ (3) q(ϑ) q(ϑ)
TheminimizationofKLdivergenceresultsinthemaximiza-
(cid:34)01 (cid:35) tionoffreeenergy,aslnp(y)isindependentofϑ.Thisisthe
where Dx= 01 . . ⊗I n×n . core idea behind using free energy minimization as a proxy
01 forbrain’sinference,therebyminimizingthebrain’ssensory
0 (p+1)×(p+1)
Here, Dx represents the shift matrix, which performs the surprisal [6].
derivative operation on the generalized state vector. The We use this idea from free energy principle for the
embedding order representing the number of derivatives joint observer design for x˜ and s through two fundamental
of hidden states and inputs used is denoted by p and assumptions about q(ϑ)=q(x˜,s): i) Mean field assumption
d respectively. The generalized system matrices are given [5] that facilitates a conditional independence between the
by A˜ =I
p+1
⊗A, B˜ =I
p+1
⊗B, C˜ =I
p+1
⊗C, where I subdensities, q(ϑ)=q(x˜)q(s), and ii) Laplace assumption
denotes the identity matrix and ⊗ the Kronecker tensor [23] that facilitates the use of Gaussian distributions with
product. mean µ and variance Σ over these subdensities, q(x˜) =
N (x˜: µx˜,Σx˜) and q(s)=N (s: µs,Σs). We refer to [24]
B. Noise precision modelling
for an elaborate read on similar simplifications. Under these
The second key concept is the modelling of generalized assumptions, F reduces to the sum of precision weighted
noise precision (inverse covariance) matrix Π˜. Since the prediction errors and the information entropy as:
noises are assumed to be Gaussian convoluted white noise, 1 1 1 1
the covariance matrix embedding the relation between noise F =− ε˜TΠ˜ε˜+ ln|Π˜|− εsTΠsεs+ ln|Πs|, (7)
2 2 2 2
1889
Authorized licensed use limited to: TU Delft Library. Downloaded on January 23,2023 at 11:50:14 UTC from IEEE Xplore. Restrictions apply.
where ε˜ is the combined prediction error for outputs and Since Π˜ ≻ 0, from definition ε˜TΠ˜ε˜ > 0, and since
states, and εs is the prediction error for s, given by: (ε˜TΠ˜ ε˜)| >0, we can conclude that (ε˜TΠ˜ ε˜)| >0,
s s=so ss s=so
(cid:20) y˜−C˜x˜ (cid:21) even though Π˜ s ⊁ 0 and Π˜ ss ⊁ 0 (refer Appendix B for
ε˜ = Dxx˜−A˜x˜−B˜v˜ , and εs=s−ηs. (8) numerical analysis). From Equation 14, (ε˜TΠ˜ ss ε˜)| s=so >
0 =⇒ F | <0, completing the proof for the existence
Here ηs and Πs are the prior (or initial) smoothness and of a uniq
s
u
s
e
s=
m
so
aximum of free energy at s=s .
o
its prior precision (confidence). For this work, we use a
low prior ηs ≈0 with a low precision Πs =1 (practically, VI. OBSERVERDESIGN
0<s<1). Our observer design follows a constant precision This section aims to introduce a novel observer design
approachwhereΠsiskeptconstantthroughouttheestimation
(DEMs) for the joint state and noise smoothness estimation
(or updation) of s, unlike the precision update approach of ofalinearsystemwithcolorednoise.Weformulatethenoise
DEM [5], [24]. This reduces the number of update rules and smoothness estimator from the previous section (gradient
simplifies F from Equation 7 to: ascend on F), using the Newton-Gauss update scheme:
1 1 1
F =− ε˜TΠ˜ε˜+ ln|Π˜|− s2. (9) s(t+dt)=s(t)+ds,
2 2 2 (15)
The last term in Equation 9 is the novel term that we have ds=(eFss| s=s(t) dt−1)(F ss | s=s(t) )−1F s | s=s(t) ,
introduced for optimizing smoothness, and doesn’t appear wheres(t)isthesmoothnessattimet,anddsisthesmooth-
in FEP literature. Using this, we propose an online noise ness increment for a time increment of dt. We combine
smoothness estimation algorithm which estimates s through this observer design with the standard DEM observer design
the gradient ascend (maximization) of F, where ∂ ∂ F s | s=so =0 for state estimation [7], where the update equation in the
and
∂2F|
<0, with s being the smoothness value that continuous time is given by:
∂s2 s=so o
maximizes F. The free energy gradients necessary for this (cid:20) (cid:21)
y˜
scheme are obtained by differentiating Equation 9: x˙˜=A x˜+B (16)
1 1 v˜
∂F 1 ∂Π˜ 1∂ln|Π˜|
=− ε˜T ε˜+ −s whereA =[Dx−kxC˜TΠ˜zC˜−kx(Dx−A˜)TΠ˜w(Dx−A˜)],B =
∂ ∂ 2F s 1 2 ∂ ∂ 2 s Π˜ 2 1∂ ∂ 2l s n|Π˜| (10) kx(cid:2) C˜TΠ˜z 1 (Dx−A˜)TΠ˜wB˜(cid:3) ,andkx isthelearningratewh 1 ich
=− ε˜T ε˜+ −1, issetto1throughoutthispaper.SinceEquation16isalinear
∂s2 2 ∂s2 2 ∂s2
differentialequation,anexactalgebraicdiscretizationcanbe
where the gradients of ln|Π˜| can be computed as (refer performed for the observer as:
Appendix A) :
(cid:20) (cid:21)
y˜(t)
∂ln|Π˜| =42(n+m) 1 , ∂2ln|Π˜| =−42(n+m) 1 . (11) x˜(t+dt)=eA1dtx˜(t)+A− 1 1(eA1dt−I)B 1 v˜(t) (17)
∂s s ∂s2 s2
Equations 15 and 17 together complete our observer design.
Theusageofgradientascentoffreeenergyfortheestimation
Note that A and B are nonlinear functions of s due
of s is motivated by the proof for the existence of a unique 1 1
to the presence of Π˜w and Π˜z in it. Moreover, the state
maximum for F under practical bounds as follows.
updates enter Equation 15 through the F terms. Therefore,
Proposition V.1. The free energy F defined by Equation 9 theupdateequationsofstateandnoisesmoothnessobservers
has a unique maximum with respect to noise smoothness s, arecoupled.Sincethisheavilycomplicatesthestabilityproof
under the practical range of noise smoothness (0<s<1). of the joint estimator, we leave it for future research.
Proof. Considerallthesmoothnessvaluesofswithzerofree
VII. WORKINGEXAMPLE
energy gradients (∂F| =0). Substituting Equation 11 in
∂s s=so This section aims to provide a working example in sim-
10andusing ∂F| =0yieldstheconditionsatisfiedbyall
∂s s=so ulation to show the capabilities of our observer design. We
maximum and minimum points:
use simulation data at different s levels to show that DEMs
1 (ε˜TΠ˜ ε˜)| = 21(n+m) −s (12) can accurately estimate x˜ and s.
2
s s=so
s
o
o
A. Simulation settings
where we use the shorthand Π˜ = ∂Π˜ . Since 0<s<1, we (cid:20) (cid:21)
s ∂s 0.0484 0.7535
have from Equation 12 that: A random system with A= , B=
−0.7617 −0.2187
 
(ε˜TΠ˜ ε˜)| >0. (13) 0.2265 −0.4786
s s=so (cid:20) (cid:21)
0.3604  0.4066 −0.2641
Theprooffortheexistenceofauniquemaximumiscomplete , and C =   was used to
if we prove that
∂2F|
<0, for all s satisfying Equation
0.0776  0.3871 0.3817 
∂s2 s=so o −0.1630 −0.9290
13. The curvature of F at s=s o is calculated from Equation generate the synthetic data for a total time of T = 32s
10 using Equation 11 as: with increments dt = 0.1s, and a Gaussian bump input
1(cid:16) 1 (cid:17) v = e−0.25(t−12)2 . The colored noise was generated using
F | =− (ε˜TΠ˜ ε˜)| +42(n+m) +1 (14)
ss s=so 2 ss s=so s2 o Πw =e6I 2 and Πz =e6I 4 . This simulation setting will be
1890
Authorized licensed use limited to: TU Delft Library. Downloaded on January 23,2023 at 11:50:14 UTC from IEEE Xplore. Restrictions apply.
0.8
0.6
0.4
0.2
0
0 5 10 15 20 25 30
Time (s)
s detamitsE
s real
Fig. 1: The maximization of F successfully estimates s for 8
simulationswithdifferents .Thecoloredsolidlinesrepresentthe
real
onlineestimationofs,whereasthedottedlinesrepresents .The
real
estimation starts from ηs=0.001 at timet=0 for all simulations
and converges close to s with a bias, within a few samples.
real
used throughout the paper, unless mentioned otherwise. We
generate eight such time series data using different levels of
noise smoothness s, ranging from 0.1 to 0.8 and use it for
the analysis in this section.
300
200
100
0
-100
-200
0 0.2 0.4 0.6 0.8 1
s
F
ygrene
eerF
4
3.5
3
2.5
2
1.5
1
0.1 0.2 0.3 0.4 0.5
simulated s
s =0.1 s =0.5
real real
s =0.2 s =0.6
real real s =0.3 s =0.7
real real
s =0.4 s =0.8 real real
Fig. 2: Free energy vs s plot for 8 different simulations (with 8
different real s values) from Figure 1 at t=5s. All 8 free energy
curvesshowaclearmaximumaroundtherealsvalues.Thisshows
the effectiveness of our noise smoothness observer.
B. Test example
Figure 1 shows the results of our noise smoothness es-
timator for all eight simulations. All simulations start with
thepriorηs=0.001andquicklystabilisesaroundthecorrect
smoothnessvalue(s indashedblack),showingthesuccess
real
of our estimator for a range of noise smoothness values.
Figure 2 shows the free energy vs s curve at t =5s for all
eight simulations. The clear peaks of the free energy curve
around the correct noise smoothness value (s ) shows that
real
free energy could be used as the objective function for noise
estimation for the operational ranges of s. The importance
of estimating the correct s is shown in Figure 3, where the
minimum state estimation error is achieved when s is
real
known. Therefore, Figure 3, 1 and 2, together demonstrates
the validity of our observer design in simulation. In the next
section, we will benchmark our observer against the state-
of-the-art observers.
noitamitse
etats
fo
ESS
DEM, s =0.1 KF, s =0.1 real real
DEM, s =0.2 KF, s =0.2 real real
DEM s =0.3 KF, s =0.3
real real
DEM s =0.4 KF, s =0.4 real real
Fig.3:Thesumofsquarederror(SSE)instateestimationofDEM
deteriorateswhenthenoisesmoothnesssusedisdifferentfromthe
real noise smoothness s . The solid and dotted lines denote the
real
SSE of DEM and KF for different simulated s. The SSE for DEM
takes a minimum when s≈s . For lower s (0.1 for example),
real
KF outperforms DEM if s is not close to s , emphasizing the
real
importance of an online noise smoothness observer.
VIII. BENCHMARKING
This section aims to benchmark the performance of
our smoothness estimator for a state estimation problem.
Through rigorous simulations, we show that our observer
providescompetitiveperformanceduringhighcolorednoise.
A. Embedding order of states
In this section, we use rigorous simulations to show that
our observer design can enable state estimation under a
wide range of noises – at different embedding orders and
smoothness levels. We manipulate on the dimension and
component values of the S matrix in Equation 4 through
different p and s values, under the same simulation setup
described in Section VII-A with dt =0.05s. The size of S
matrix increases with increasing p, whereas the components
inside it increases with increasing s. Figure 4 shows the
resultsofstateestimationusing150experiments(5randomly
generated noises each for five s values and six p values).
Theestimationerrordecreaseswithincreasing pfordifferent
noise smoothness values, highlighting the importance of us-
ing higher order generalized coordination during estimation.
Thisshowstheapplicabilityofourobserverforawiderange
of noise smoothness, embedding orders and noises.
6
5
4
3
2
1
0
s=0.1 s=0.3 s=0.5 s=0.7 s=0.9
noitamitse
etats
fo ESS
p=1 p=3 p=5
p=2 p=4 p=6
Fig. 4: The error in state estimation decreases as the embedding
order of states p increases, for a range of noise smoothness s.
This shows that our smoothness estimation aids an accurate state
estimation till an embedding order of p=4 for a wide range of s.
1891
Authorized licensed use limited to: TU Delft Library. Downloaded on January 23,2023 at 11:50:14 UTC from IEEE Xplore. Restrictions apply.
B. Benchmark state observer
In this section, we benchmark our observer against other
state-of-the-art observers like KF, SA and SMIKF, to show
its competitiveness. 50 time series data (10 each for 5
smoothness values with dt =0.05s) were generated using
the simulation setup in Section VII-A and the SSE in state
estimation was computed for KF, SA, SMIFK and DEMs.
The SMIKF and SA implementation accommodated an AR
model of order 1 and 6 respectively for the noise modelling,
whereas the DEM implementation used an embedding order
of p=6 for states and d =2 for inputs. Figure 5 shows
the results, clearly indicating the superior performance of
DEMs with minimum error in state estimation for higher
s. DEMs outperforms other observers for a wide range of
s values. However, for low noise color (s=0.1), SA and
SMIKFoutperformsDEMs.Inallcases,DEMsoutperforms
KF in the presence of colored noise.
10
8
6
4
2
0
s=0.1 s=0.3 s=0.5 s=0.7 s=0.9
noitamitse
etats
fo
ESS
that models the relation between the PWM values and the
thrust generated by the quadcopter rotors. φ was recorded
using the Optitrack system, and was used for the state
estimationforatimesequenceofT =15swithdt=0.0083s.
The influence of wind dynamics on the quadrotor states
(φ and φ˙) is unmodelled in Equation 18. Therefore, the
wind dynamics induces strong colored noise (w) in the
data [18]. The higher process noise (Πw=e4), and a lower
measurement noise (Πz =e10) were used to represent high
unmodelledwindnoiseandlowOptitracknoiserespectively.
p=2 and d=2 were used to capture the noise color.
0.1
0.05
0
-0.05
-0.1
-0.15
KF -0.2
SA
SMIKF
DEMs 0 5 10 15
Time (s)
Fig. 5: DEMs outperform KF, SA and SMIKF with minimal
estimation error during state estimation under high colored noise
(s>0.1).Forlowcolorednoise(saround0.1),DEMsoutperforms
KF,butSAandSMIKFperformsbetter.SolutionsofSAisunstable
for higher s.
IX. PROOFOFCONCEPT-QUADROTORFLIGHT
This section aims to provide a proof of concept for our
observer design by employing it for the state estimation of
a real quadrotor flying under wind conditions. We use the
experimental design from [8] to obtain the quadrotor flight
data. The experiment consist of a quadrotor hovering at a
fixed location, under the strong influence of wind generated
by a blower. The linearized quadrotor model relating the
input motor signals to the output roll angle (φ) of the
quadcopter, without accounting for the wind dynamics is
given by [8]:
(cid:20) φ φ ˙ ¨ (cid:21) = (cid:20) 0 0 1 0 (cid:21)(cid:20) φ φ˙ (cid:21) + (cid:20) c 0 Bφ − 0 cBφ − 0 cBφ c 0 Bφ (cid:21)(cid:34) p p p w w w m m m 1 2 3 (cid:35) ,
Ixx Ixx Ixx Ixx pwm4
(cid:20) (cid:21)
(cid:2) (cid:3) φ
y= 1 0 ,
φ˙
(18)
where pwm is the Pulse Width Modulation signal provided
i
to the ith motor by the controller for stable hovering, I =
xx
3.4·10−3kgm2 is the quadcopter’s moment of inertia around
thex-axis,andc =1.274·10−3Nmisthethrustcoefficient
Bφ
fo
etamitse
etats
Ideal KF
DEMs SA
SMIKF
Fig. 6: DEMs outperforms other benchmarks in state estimation
on the quadrotor flight data where it hovers under the influence of
wind, introducing colored noise into the system. DEMs (in red) is
closer to the ground truth Optitrack measurement (ideal in blue),
when compared to other benchmarks. KF, SA and SMIKF shows
coinciding estimation plots.
-100
-150
-200
-250
-300
0.5 1 1.5 2
s 10-5
F
ygrene
eerF t = 3s
t = 6s
t = 9s
t = 12s
t = 15s
Fig.7:Thefreeenergyvssplotfordifferenttimeinstancesduring
the quadrotor flight (data from Figure 6). The curves show a clear
maximum, similar to the simulation results from Figure 2. This
provides an experimental validation for using the gradient ascend
over free energy for smoothness estimation.
Figure 6 shows the superior state estimation capabilities
of DEMs. DEMs (in red) is closer to the ground truth (in
blue) when compared to other benchmarks. KF, SMIKF and SA have coinciding state estimation curves. Figure 7 shows
the free energy vs s curve at different time instances t of
the quadrotor flight, showing a clear maximum, similar to
the simulation results in Figure 2, validating the practical
application of our estimator.
X. CONCLUSION
A novel observer (DEMs) for the joint state and noise
smoothness estimation of linear systems with colored noise
1892
Authorized licensed use limited to: TU Delft Library. Downloaded on January 23,2023 at 11:50:14 UTC from IEEE Xplore. Restrictions apply.
was introduced. Through rigorous simulations, DEMs was [18] A.A.MeeraandM.Wisse,“Abraininspiredlearningalgorithmforthe
shown to outperform the benchmarks like KF, SMIKF and perceptionofaquadrotorinwind,”arXivpreprintarXiv:2109.11971,
2021.
SA in state estimation under colored noise with minimum
[19] O. C¸atal, T. Verbelen, T. Van de Maele, B. Dhoedt, and A. Safron,
estimationerror.Theobserverwasfacevalidatedbyapplying “Robotnavigationashierarchicalactiveinference,”NeuralNetworks,
itonapracticalroboticsapplication-thestateestimationofa vol.142,pp.192–204,2021.
[20] M. Baltieri and C. L. Buckley, “Pid control as a process of active
quadrotor hovering in unmodelled wind conditions, to show
inference with linear generative models,” Entropy, vol. 21, no. 3, p.
that DEMs is a competitive observer. The main limitation 257,2019.
of this work is the absence of a stability proof for the joint [21] M. Baltieri and T. Isomura, “Kalman filters as the steady-state so-
lution of gradient descent on variational free energy,” arXiv preprint
state andnoise smoothness observer,which can bethe focus
arXiv:2111.10530,2021.
of future research. The estimator can be extended for a [22] C. L. Buckley, C. S. Kim, S. McGregor, and A. K. Seth, “The free
confident smoothness estimation with precision updates for energy principle for action and perception: A mathematical review,”
Πs. It can also be extended to solve the active inference JournalofMathematicalPsychology,vol.81,pp.55–79,2017.
[23] K.Friston,J.Mattout,N.Trujillo-Barreto,J.Ashburner,andW.Penny,
problem for the control of systems with colored noise. “Variationalfreeenergyandthelaplaceapproximation,”Neuroimage,
vol.34,no.1,pp.220–234,2007.
ACKNOWLEDGMENT [24] A.AnilMeeraandM.Wisse,“Dynamicexpectationmaximizational-
gorithmforestimationoflinearsystemswithcolorednoise,”Entropy,
We would like to thank Peyman Mohajerin Esfahani for vol.23,no.10,p.1306,2021.
his valuable insights on joint observer design. APPENDIX
REFERENCES A. Gradients of ln|Π˜|
ThelogdeterminantofΠ˜ canbecalculatedusingEquations4and5as:
[1] J. L. Crassidis and J. L. Junkins, Optimal estimation of dynamic
systems. ChapmanandHall/CRC,2004. ln|Π˜|=ln|S⊗Πz|+ln|S⊗Πw|
[2] Z.Zhou,J.Wu,Y.Li,C.Fu,andH.Fourati,“Criticalissuesonkalman =ln(|S|m|Πz|(p+1))+ln(|S|n|Πw|(p+1)) (19)
filter with colored and correlated system noises,” Asian Journal of
Control,vol.19,no.6,pp.1905–1919,2017.
=(p+1)(ln|Πz|+ln|Πw|)+(n+m)ln|S|.
[3] A.BrysonandD.Johansen,“Linearfilteringfortime-varyingsystems Thederivativeofln|Π˜|withrespecttosbecomes:
usingmeasurementscontainingcolorednoise,”IEEETransactionson
AutomaticControl,vol.10,no.1,pp.4–10,1965. ∂ln|Π˜| ∂ln|S| ∂2ln|Π˜| ∂2ln|S|
[4] A. Bryson Jr and L. Henrikson, “Estimation using sampled data ∂s =(n+m) ∂s , ∂s2 =(n+m) ∂s2 . (20)
containing sequentially correlated noise.” Journal of Spacecraft and
Rockets,vol.5,no.6,pp.662–665,1968. FromEquation4,|S|= 512s42,resultingin ∂ln|S|=42 and ∂2ln|S|=−42.
6075 ∂s s ∂s2 s2
[5] K. J. Friston, N. Trujillo-Barreto, and J. Daunizeau, “Dem: a varia- ThissimplifiesEquation20to:
tionaltreatmentofdynamicsystems,”Neuroimage,vol.41,no.3,pp.
849–885,2008.
∂ln|Π˜|
=42(n+m)
1
,
∂2ln|Π˜|
=−42(n+m)
1
. (21)
[6] K.Friston,“Thefree-energyprinciple:aunifiedbraintheory?”Nature ∂s s ∂s2 s2
reviewsneuroscience,vol.11,no.2,pp.127–138,2010. B. Numerical analysis on the nature of ε˜TΠ˜ε˜
[7] A. A. Meera and M. Wisse, “Free energy principle based state and
inputobserverdesignforlinearsystemswithcolorednoise,”in2020 Werecordedthefirsttwogradientsofthepolynomialε˜TΠ˜ε˜ withrespect
AmericanControlConference(ACC). IEEE,2020,pp.5052–5058. to s for 20,000 combinations of randomly sampled ε˜ and s such that
[8] F.Bas,A.A.Meera,D.Benders,andM.Wisse,“Freeenergyprinciple |ε˜|<1 and s∈(0,1]. From the results shown in Figure 8, the data points
forstateandinputestimationofaquadcopterflyinginwind,”in2022 predominantly lie on the first quadrant, suggesting that the function has
InternationalConferenceonRoboticsandAutomation(ICRA). IEEE, positive gradients, which is a sign of monotonically increasing function.
2022,pp.5389–5395. Theabsenceofanypointsonthefourthquadrantmotivatestheconclusion:
[9] K. Friston, “The free-energy principle: a rough guide to the brain?” if ε˜TΠ˜ sε˜>0 then ε˜TΠ˜ ssε˜>0. The results remain the same for different
Trendsincognitivesciences,vol.13,no.7,pp.293–301,2009.
normlengthsofε˜.
[10] K. J. Friston, J. Daunizeau, J. Kilner, and S. J. Kiebel, “Action and
behavior:afree-energyformulation,”Biologicalcybernetics,vol.102,
no.3,pp.227–260,2010.
[11] R. L. Carhart-Harris and K. J. Friston, “The default-mode, ego-
functions and free-energy: a neurobiological account of freudian
ideas,”Brain,vol.133,no.4,pp.1265–1283,2010.
[12] K. Friston, K. Stephan, B. Li, and J. Daunizeau, “Generalised filter-
ing,”MathematicalProblemsinEngineering,vol.2010,2010.
[13] B.Li,J.Daunizeau,K.E.Stephan,W.Penny,D.Hu,andK.Friston,
“Generalised filtering and stochastic dcm for fmri,” neuroimage,
vol.58,no.2,pp.442–457,2011.
[14] J.-J. Xiong and E.-H. Zheng, “Optimal kalman filter for state esti-
mation of a quadrotor uav,” Optik, vol. 126, no. 21, pp. 2862–2868,
2015.
[15] P.Lanillos,C.Meo,C.Pezzato,A.A.Meera,M.Baioumy,W.Ohata,
A. Tschantz, B. Millidge, M. Wisse, C. L. Buckley et al., “Active
inference in robotics and artificial agents: Survey and challenges,”
arXivpreprintarXiv:2112.01871,2021.
[16] G. Oliver, P. Lanillos, and G. Cheng, “Active inference body
perception and action for humanoid robots,” arXiv preprint Fig. 8: The plot demonstrating that the function ε˜TΠ˜ε˜ is mostly
arXiv:1906.03022,2019. monotonically increasing with respect to s in the domain (0,1] for
[17]
i
M
nf
.
er
B
en
a
c
io
e
um
fo
y
r
,
i
P
n
.
te
D
gr
u
a
c
te
k
d
wo
s
r
t
t
a
h
te
,
-e
B
s
.
tim
L
a
a
t
c
i
e
o
r
n
d
,
a,
co
a
n
n
t
d
rol
N
,
.
an
H
d
aw
le
e
a
s
r
,
ni
“
n
A
g,
c
”
tiv
in
e |ε˜|<1. Moreover, when ε˜TΠ˜ sε˜ >0, ε˜TΠ˜ ssε˜ <0, since there are
nodatapointsonthefourthquadrantasshowninthezoomedplot.
2021 IEEE International Conference on Robotics and Automation
(ICRA). IEEE,2021,pp.4665–4671.
1893
Authorized licensed use limited to: TU Delft Library. Downloaded on January 23,2023 at 11:50:14 UTC from IEEE Xplore. Restrictions apply.